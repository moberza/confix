<html lang="en">
<head>
<title>Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p><hr>
<a name="Top"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">Confix</h2>

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>
<li><a accesskey="2" href="#An-Example">An Example</a>
<li><a accesskey="3" href="#How-Confix-Works">How Confix Works</a>
<li><a accesskey="4" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>
<li><a accesskey="5" href="#The-Users-Role-in-the-Build-Process">The Users Role in the Build Process</a>
<li><a accesskey="6" href="#Options-and-Parameters">Options and Parameters</a>
<li><a accesskey="7" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>
<li><a accesskey="8" href="#The-Configuration-File">The Configuration File</a>
<li><a accesskey="9" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>
<li><a href="#The-Sample-Utilities-Package">The Sample Utilities Package</a>
<li><a href="#Concept-Index">Concept Index</a>
<li><a href="#Function-Index">Function Index</a>
<li><a href="#Variable-Index">Variable Index</a>
</ul>

   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Confix</a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<ul>
<li><a href="#Prerequisites">1.1 Prerequisites</a>
<li><a href="#How-To-Get-It">1.2 How To Get It</a>
<li><a href="#Installation">1.3 Installation</a>
<ul>
<li><a href="#Source-Distribution">1.3.1 Source Distribution</a>
<li><a href="#RPM-distribution">1.3.2 RPM distribution</a>
<li><a href="#Dumb-binary-distribution">1.3.3 Dumb binary distribution</a>
</li></ul>
<li><a href="#A-Short-Autotools-Introduction">1.4 A Short Autotools Introduction</a>
<li><a href="#What-Confix-Adds-to-the-Autotools">1.5 What Confix Adds to the Autotools</a>
</li></ul>
<li><a name="toc_An-Example" href="#An-Example">2 An Example</a>
<ul>
<li><a href="#The-Raw-Source">2.1 The Raw Source</a>
<li><a href="#Instrumenting-the-Package">2.2 Instrumenting the Package</a>
<li><a href="#Bootstrapping-the-Package">2.3 Bootstrapping the Package</a>
<li><a href="#The-Configuration-File-_0028Short-Introduction_0029">2.4 The Configuration File (Short Introduction)</a>
<li><a href="#Building-the-Package">2.5 Building the Package</a>
<li><a href="#Installing-the-Package">2.6 Installing the Package</a>
<li><a href="#Distributing-the-Package">2.7 Distributing the Package</a>
<li><a href="#Summary">2.8 Summary</a>
</li></ul>
<li><a name="toc_How-Confix-Works" href="#How-Confix-Works">3 How Confix Works</a>
<ul>
<li><a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">3.1 Scanning &mdash; Gathering the Pieces</a>
<li><a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">3.2 Resolving &mdash; Determining the Build Order</a>
<li><a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">3.3 Checks &mdash; The Autoconf Way of Portability</a>
<li><a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">3.4 Module Repository &mdash; Inter-Package Knowledge Transfer</a>
</li></ul>
<li><a name="toc_The-Coders-Role-in-the-Build-Process" href="#The-Coders-Role-in-the-Build-Process">4 The Coder's Role in the Build Process</a>
<ul>
<li><a href="#What-Will-Be-Built">4.1 What Will Be Built, and How</a>
<ul>
<li><a href="#Building-Source-Files">4.1.1 Building Source Files</a>
<li><a href="#Library-or-Executables_003f">4.1.2 Library or Executables?</a>
<li><a href="#Generated-and-Explicit-Names">4.1.3 Generated and Explicit Names</a>
</li></ul>
<li><a href="#Installation-_002d_002d_002d-Going-Public">4.2 Installation &mdash; Going Public</a>
<ul>
<li><a href="#What-Goes-Public">4.2.1 What Goes Public</a>
<li><a href="#Namespaces">4.2.2 Namespaces and <code>#include</code></a>
<li><a href="#Installation-_002d_002d_002d-A-Short-Example">4.2.3 Installation &mdash; A Short Example</a>
<li><a href="#Restrictions">4.2.4 Restrictions</a>
</li></ul>
<li><a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">4.3 Build Order &mdash; How Things Can Easily Go Wrong</a>
<li><a href="#Explicitly-Adding-Checks">4.4 Explicitly Adding Checks (and Programming with Them)</a>
<li><a href="#Performing-Automatic-Tests">4.5 Performing Automatic Tests</a>
<li><a href="#Using-Third-Party-Libraries">4.6 Using Third Party Libraries</a>
<ul>
<li><a href="#A-Simple-External-Module">4.6.1 A Simple External Module</a>
<li><a href="#A-More-Complicated-External-Module">4.6.2 A More Complicated External Module</a>
</li></ul>
<li><a href="#Restrictions-Imposed-on-the-Package-Structure">4.7 Restrictions Imposed on the Package Structure</a>
<li><a href="#Using-GNU-Libtool">4.8 Using GNU Libtool</a>
<ul>
<li><a href="#Objections-Against-Shared-Libraries">4.8.1 Objections Against Shared Libraries</a>
</li></ul>
<li><a href="#Summary-of-Rules-and-Restrictions">4.9 Summary of Rules and Restrictions</a>
</li></ul>
<li><a name="toc_The-Users-Role-in-the-Build-Process" href="#The-Users-Role-in-the-Build-Process">5 The User's Role in the Build Process</a>
<ul>
<li><a href="#Optionally-Building-and-Using-Modules">5.1 Optionally Building and Using Modules</a>
</li></ul>
<li><a name="toc_Options-and-Parameters" href="#Options-and-Parameters">Appendix A Options and Parameters</a>
<ul>
<li><a href="#Actions">A.1 Actions</a>
<li><a href="#Parameters">A.2 Parameters</a>
</li></ul>
<li><a name="toc_Interfaces-for-Coder-and-Maintainer" href="#Interfaces-for-Coder-and-Maintainer">Appendix B Interfaces for Coder and Maintainer</a>
<ul>
<li><a href="#The-Module-Makefile_002epy-Interface">B.1 The Module <samp><span class="file">Makefile.py</span></samp> Interface</a>
<li><a href="#The-Buildable-Interface">B.2 The Buildable Interface</a>
<li><a href="#The-Toplevel-Makefile_002epy-Interface">B.3 The Toplevel (Package) <samp><span class="file">Makefile.py</span></samp> Interface</a>
</li></ul>
<li><a name="toc_The-Configuration-File" href="#The-Configuration-File">Appendix C The Configuration File</a>
<li><a name="toc_Frequently-Asked-Questions" href="#Frequently-Asked-Questions">Appendix D Frequently Asked Questions</a>
<ul>
<li><a href="#When-should-I-bootstrap-my-package_003f">D.1 When should I bootstrap my package?</a>
<li><a href="#What-should-I-do-when-the-Autotools-bail-out_003f">D.2 What should I do when the Autotools bail out?</a>
</li></ul>
<li><a name="toc_The-Sample-Utilities-Package" href="#The-Sample-Utilities-Package">Appendix E The Sample Utilities Package</a>
<li><a name="toc_Concept-Index" href="#Concept-Index">Concept Index</a>
<li><a name="toc_Function-Index" href="#Function-Index">Function Index</a>
<li><a name="toc_Variable-Index" href="#Variable-Index">Variable Index</a>
</li></ul>
</div>

<div class="node">
<p><hr>
<a name="Introduction"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#An-Example">An Example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction</h2>

<!-- NOTE: this is also in the index.html. Be sure to update it there if you modify it here. -->
<p>Confix is a build tool for source code packages. It doesn't require
the package maintainer to write any build instructions by hand at
all. Instead, it examines the source code, <em>guesses</em> what's to be
done and writes the build instructions for the
maintainer<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>. Another important feature &mdash;
perhaps the most important &mdash; is the ability of Confix to recognize
and compute dependencies. That is, it relieves the package maintainer
of the task of manually keeping track of the order in which libraries
appear on the link line of an executable, for example, or of the build
order inside the package.

   <p>Confix is built on top of the standard open source tool Automake,
<a href="http://www.gnu.org/software/automake/">http://www.gnu.org/software/automake/</a><a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a>. That is, the build
instructions generated by Confix are in fact Automake input
files. This way one uses the whole infrastructure supplied by
Automake, involving such things as the well-known <samp><span class="command">configure;
make; make install</span></samp> sequence, or automatically building source
distributions by simply saying <samp><span class="command">make dist</span></samp>, just to mention a
few.

<ul class="menu">
<li><a accesskey="1" href="#Prerequisites">Prerequisites</a>
<li><a accesskey="2" href="#How-To-Get-It">How To Get It</a>
<li><a accesskey="3" href="#Installation">Installation</a>
<li><a accesskey="4" href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a>
<li><a accesskey="5" href="#What-Confix-Adds-to-the-Autotools">What Confix Adds to the Autotools</a>
</ul>

<div class="node">
<p><hr>
<a name="Prerequisites"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-To-Get-It">How To Get It</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.1 Prerequisites</h3>

<p><a name="index-g_t_0040code_007bautoconf_007d-1"></a><a name="index-g_t_0040code_007bautomake_007d-2"></a><a name="index-Python-3"></a>
     <ul>
<li>Python, at least version 2.3.

     <li>Automake, at least version 1.7.

     <li>Autoconf, at least version 2.58.

     <li>Libtool. Support for Libtool is optional in Confix, so you may leave
it out entirely. Best to use version 1.5 because older versions had
buggy C++ support. If you are building C libraries, older versions may
or may not work.

   </ul>

<div class="node">
<p><hr>
<a name="How-To-Get-It"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installation">Installation</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Prerequisites">Prerequisites</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.2 How To Get It</h3>

<p>The project's homepage it hosted on Sourceforge,
<a href="http://confix.sourceforge.net">http://confix.sourceforge.net</a>. See there for releases,
announcements et cetera.

   <p>Throughout this document we will occasionally refer to an example
source code package which is also available from this site. You may
dowload it as a tarball or check it out from
source<a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a>

<div class="node">
<p><hr>
<a name="Installation"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-To-Get-It">How To Get It</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.3 Installation</h3>

<p>Confix packaging and installation is done using the Python Distutils
package. So far I managed to do a source distribution, both in
<samp><span class="file">.tar.gz</span></samp> and <samp><span class="file">.zip</span></samp>, a RPM package, and a &ldquo;dumb binary
distribution&rdquo;. The easiest to use however is the source distribution,
mainly because Confix cannot use the RedHat 7.3 default Python which
is 1.5 (can anybody use it?).

<ul class="menu">
<li><a accesskey="1" href="#Source-Distribution">Source Distribution</a>
<li><a accesskey="2" href="#RPM-distribution">RPM distribution</a>
<li><a accesskey="3" href="#Dumb-binary-distribution">Dumb binary distribution</a>
</ul>

<div class="node">
<p><hr>
<a name="Source-Distribution"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#RPM-distribution">RPM distribution</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation">Installation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">1.3.1 Source Distribution</h4>

<p>Unpack the file, point the <var>PYTHONPATH</var> environment variable into
the root directory of the Confix package, and your <var>PATH</var>
environment variable into the <samp><span class="file">scripts</span></samp> subdirectory thereof. For
example,

<pre class="example">     $ pwd
     /home/jfasch
     $ tar zxplf Confix-1.0.1.tar.gz
</pre>
   <p>Then make a call to Distutils to build and install the source.

<pre class="example">     $ cd Confix-1.0.1
     $ pwd
     /home/jfasch/Confix-1.0.1
     $ python setup.py install --prefix=${HOME}/sandbox
</pre>
   <p>Then, provided the prefix you gave wasn't a standard one like
<samp><span class="file">/usr</span></samp> or <samp><span class="file">/usr/local</span></samp>, you should update your environment
accordingly. For example, you could add the following lines to your
<samp><span class="file">~/.bashrc</span></samp>,

<pre class="example">     PREFIX=${HOME}/sandbox
     export PYTHONPATH=${PYTHONPATH}:${PREFIX}/lib/pythonA.B/site-packages
     export PATH=${PATH}:${PREFIX}/bin
</pre>
   <p>Make sure A.B corresponds to the version of Python that you use, such
as 2.1 or 2.2.

<div class="node">
<p><hr>
<a name="RPM-distribution"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Dumb-binary-distribution">Dumb binary distribution</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Source-Distribution">Source Distribution</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">1.3.2 RPM distribution</h4>

<p>Ideally, one would just say

<pre class="example">     rpm -Uvh Confix-&lt;version&gt;.noarch.rpm
</pre>
   <p>However, Confix requires at least Python 2.1.3, and I built the RPM
using the Python binary <samp><span class="file">/usr/local/Python-2.1.3/bin/python</span></samp>
(which I compiled myself). Unfortunately, the RPM package generated by
Distutils is not relocatable, so the user is required to have Python
installed in /usr/local/Python-2.1.3.

   <p>I could have built the RPM with the <samp><span class="command">python2</span></samp> interpreter
which comes with RedHat 7.3, but, then again, this wouldn't help
because then I'd have to write <code>#!/usr/bin/env python2</code> in the
first line of the <samp><span class="command">confix.py</span></samp> script. This would break Confix
for configurations which don't have <samp><span class="command">python2</span></samp>.

   <p>What I want to say: since Confix requires Python 2.1.3 or higher, it
is not easy to generate RPM for RedHat 7.3 whose default Python is
1.5<a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a>. Better to use the &ldquo;dumb binary distribution&rdquo; instead.

<div class="node">
<p><hr>
<a name="Dumb-binary-distribution"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#RPM-distribution">RPM distribution</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation">Installation</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">1.3.3 Dumb binary distribution</h4>

<p>A &ldquo;dumb binary distribution&rdquo; is simply a <samp><span class="file">.tar.gz</span></samp> or
<samp><span class="file">.zip</span></samp> file containing the tree fit for installation. Unpack it,
chdir to the implicitly contained prefix directory (for example
<samp><span class="file">./usr/local/Python-2.1.3</span></samp>, note the leading <samp><span class="file">.</span></samp>, which
means the current directory), and copy everthing contained therein
into your favourite Python root.

<div class="node">
<p><hr>
<a name="A-Short-Autotools-Introduction"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-Confix-Adds-to-the-Autotools">What Confix Adds to the Autotools</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation">Installation</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.4 A Short Autotools Introduction</h3>

<p><a name="index-g_t_0040code_007bmake_007d-4"></a><a name="index-distribution_002c-source-5"></a><a name="index-source-distribution-6"></a>If you ever compiled a GNU source package, you probably have enjoyed
the convenience of saying <code>configure; make; make install</code>,
without having to manually adjust <samp><span class="file">Makefile</span></samp>s and source
code. The tools which make this possible are <code>automake</code> and
<code>autoconf</code>. They implement one part of the GNU Coding Standards,
namely the part which specifies which <samp><span class="command">make</span></samp> targets must be
available to the user who compiles the package. Among these targets
are <code>install</code>, <code>clean</code>, <code>info</code> (to generate emacs info
files from Texinfo documentation), <code>check</code> (to perform tests),
<code>dist</code> (to automatically generate a source distribution in a
.tar.gz file), and many others.

   <p><a name="index-g_t_0040code_007bconfigure_007d-7"></a><a name="index-M4-8"></a><samp><span class="command">configure</span></samp> is a Bourne shell script which performs checks
specified by the maintainer. It is not a hand-written script - as you
can see from looking at it. Rather, it is "compiled" from several input
files written by the maintainer, mostly in the macro language M4. For
example, if the package contains C code, <samp><span class="command">configure</span></samp> will search
for available C compilers on the user's machine (the <em>host</em>
machine), and pick one which is then used to compile the package. Also,
it checks for the availability of certain functions or libraries on
demand of the maintainer. Based on the results of these checks,
<samp><span class="command">configure</span></samp> creates <samp><span class="file">Makefile</span></samp>s in the package
subdirectories which have to be built.

   <p><a name="index-g_t_0040option_007b_002d_002dprefix_007d-9"></a><samp><span class="command">configure</span></samp> supports a great wealth of commandline options
which parameterize the package build process. One of the most widely
used options is <code>--prefix=&lt;prefix&gt;</code>. You use this option when you
don't want the package installed at the default location
<samp><span class="file">/usr/local</span></samp> (e.g. if you don't have write permissions there),
but rather want it installed at
<samp><span class="file">$HOME/my-private-packages</span></samp>. (<code>--prefix</code> is the only
standard option we use in this manual, so we don't mention the others
here.)

   <p><samp><span class="command">make install</span></samp> installs the package into subdirectories of
<samp><span class="file">$(prefix)</span></samp>. If you haven't passed any other options than
<code>--prefix</code> to <samp><span class="command">configure</span></samp>, the header files of the
package will be installed under <samp><span class="file">$(prefix)/include</span></samp>, the
executables under <samp><span class="file">$(prefix)/bin</span></samp>, and the libraries under
<samp><span class="file">$(prefix)/lib</span></samp>. You can explicitly specify locations for each of
these by passing specific options to <samp><span class="command">configure</span></samp>; see the
<samp><span class="command">autoconf</span></samp> manual for more information.

<div class="node">
<p><hr>
<a name="What-Confix-Adds-to-the-Autotools"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">1.5 What Confix Adds to the Autotools</h3>

<p><a name="index-maintainer_002c-of-a-package-10"></a><a name="index-package-maintainer-11"></a><a name="index-build-process-12"></a>As you have noticed, a package maintainer is responsible for at least
two things. On one side, the maintainer hacks the code, a job which
can be quite creative and is fun most of the time. On the other side,
there is the task of crafting the build process. This job is annoying,
it involves such things as keeping track of include paths, library
names, checking for external packages, cross platform portability
issues, etc. The GNU tools Automake and Autoconf largely automate the
build process, but there is still a non-trivial amount of work left.

   <p>Confix's goal is to make build maintenance <em>part</em> of source code
maintenance. The maintainer is not required to write lengthy
<samp><span class="file">configure.in</span></samp> and <samp><span class="file">Makefile.am</span></samp> like he had to when using
plain Automake. Rather, from the content of the package's directories
and files, Confix guesses what has to be built and how.

   <p>Clearly Confix imposes a few restrictions (features) on the maintainer
in order for it to be able to correctly guess. This manual goes to
great lengths at explaining what these restrictions are, and how to
live with them. <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a> has been
written solely for this purpose.

<div class="node">
<p><hr>
<a name="An-Example"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-Confix-Works">How Confix Works</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">2 An Example</h2>

<p>Let's start out with a concrete example; it's easier to follow the
explanations this way. If you want to immediately try out what's
written in this chapter, I recommend you download the companion
<code>wx-utils</code> package from the Confix web site (see <a href="#How-To-Get-It">How To Get It</a>), unpack it, and warm up your fingers. <a href="#The-Sample-Utilities-Package">The Sample Utilities Package</a> contains a brief description of what's in that
package. Throughout this manual, we will refer to source files of the
package as examples.

   <p>What we will be doing in this chapter is to play through the different
stages of a package,

     <ul>
<li>Raw source code: pure source code, as written by the developer.

     <li>Instrumented: instrumented package; files generated by Confix suitable
for input to Automake and Autoconf.

     <li>Bootstrapped: prepared by Automake and Autoconf, ready for the user to
call <samp><span class="command">configure</span></samp> and <samp><span class="command">make</span></samp>.

     <li>Built: configured and compiled by the user.

     <li>Installed: made public by calling <samp><span class="command">make install</span></samp>.

   </ul>

   <p>Note that this chapter is about calling Confix to manage your build
process. It is not about crafting the source code itself. For this we
have a separate chapter, <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>. There we describe in detail what you have to bear in mind
when writing code that you intend to manage with Confix. I suggest you
read that chapter before you actually start out with your own package.

<ul class="menu">
<li><a accesskey="1" href="#The-Raw-Source">The Raw Source</a>
<li><a accesskey="2" href="#Instrumenting-the-Package">Instrumenting the Package</a>
<li><a accesskey="3" href="#Bootstrapping-the-Package">Bootstrapping the Package</a>
<li><a accesskey="4" href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a>
<li><a accesskey="5" href="#Building-the-Package">Building the Package</a>
<li><a accesskey="6" href="#Installing-the-Package">Installing the Package</a>
<li><a accesskey="7" href="#Distributing-the-Package">Distributing the Package</a>
<li><a accesskey="8" href="#Summary">Summary</a>
</ul>

<div class="node">
<p><hr>
<a name="The-Raw-Source"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Instrumenting-the-Package">Instrumenting the Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#An-Example">An Example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.1 The Raw Source</h3>

<p><a name="index-package_002c-raw-source-13"></a>Here's the structure of the package as the maintainer hand-crafted it,
with a few directories and files omitted to make it fit on a
page<a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a>.

<pre class="example">     wx-utils
     |-- Makefile.py
     |-- bin
     |   |-- Makefile.py
     |   `-- crypt.cc
     |-- check
     |   |-- Makefile.py
     |   `-- _check_debug_parse_levels.cc
     |-- code
     |   |-- Makefile.py
     |   |-- debug.cc
     |   |-- debug.h
     |   `-- linkassert.h
     |-- crypt
     |   |-- Makefile.py
     |   |-- crypt.cc
     |   `-- crypt.h
     |-- error
     |   |-- Makefile.py
     |   |-- error.cc
     |   `-- error.h
     `-- ext-crypt
         `-- Makefile.py
</pre>
   <p><a name="index-g_t_0040file_007bMakefile_002epy_007d-14"></a><a name="index-directory_002c-instrumenting-15"></a><a name="index-instrumenting-16"></a>What strikes are the occurrences of <samp><span class="file">Makefile.py</span></samp> in every
directory. The meaning of this file is twofold. First, all directories
in the package that do not have a <samp><span class="file">Makefile.py</span></samp> are ignored by
Confix. In other words, you have to place a <samp><span class="file">Makefile.py</span></samp> in
every directory that you want Confix to instrument.

   <p>Second, that file may contain explicit instructions for Confix on how
to instrument that particular directory. But this is more advanced
stuff; suffice it for now to say that this file is usually empty and
only serves as a reminder for Confix to not overlook that
directory. If you do feel the need to write something there - such as
CVS keyword substitutions in a comment - be sure to use Python syntax
for this. See <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a> for information
about what can be written in <samp><span class="file">Makefile.py</span></samp>. If you are curious, I
suggest you take a look at <samp><span class="file">Makefile.py</span></samp> in
<samp><span class="file">ext-crypt</span></samp>. This directory does not contain any real code;
rather, its <samp><span class="file">Makefile.py</span></samp> contains information on how to use the
standard UNIX crypt library. You'll find a explanation in <a href="#A-Simple-External-Module">A Simple External Module</a>.

   <p><strong>A few words on terminology.</strong> Throughout this manual we will
use certain terms over and over again. Now's the right time to
formally introduce two of them.

     <ul>
<li><a name="index-package-17"></a><a name="index-package-root-18"></a><a name="index-package-name-19"></a><em>Package:</em> a package is an entity which is subject to be
instrumented by Confix. In our example, the tree beginning at the
<samp><span class="file">wx-utils</span></samp> directory is a package, and <samp><span class="file">wx-utils</span></samp> is the
<em>package root</em>.

     <li><a name="index-module-20"></a><em>Module:</em> a module is a subdirectory of the package root. A
package is said to contain modules. A module normally contains
buildable things such as C and C++ files and the like (more on that
later). The outcome of a module, after the package has been built, is
something like a C or C++ library, an executable, or whatnot.

   </ul>

<div class="node">
<p><hr>
<a name="Instrumenting-the-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Bootstrapping-the-Package">Bootstrapping the Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Raw-Source">The Raw Source</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.2 Instrumenting the Package</h3>

<p><a name="index-instrumented-package-21"></a>The first step on the way to a successful build (apart from writing
correct code and spreading <samp><span class="file">Makefile.py</span></samp> files all over the
package tree) is to have Confix examine the package and generate input
for the Autotools.

<pre class="example">     
     $ pwd
     /home/jfasch/work/wx-utils
     $ confix.py --prefix=/home/jfasch/installed-packages --output
     scanning package (wx-utils) ...
     done with wx-utils
     resolving dependencies ...
     done resolving
</pre>
   <p>Now see what has happened. (See below what the <samp><span class="option">--prefix</span></samp>
option is for.)

<pre class="example">     
     wx-utils
     |-- configure.in
     |-- Makefile.am
     |-- Makefile.py
     |-- depcomp
     |-- bin
     |   |-- Makefile.am
     |   |-- Makefile.py
     |   |-- crypt.cc
     |   `-- wx-utils_bin.py
     |-- check
     |   |-- Makefile.am
     |   |-- Makefile.py
     |   |-- _check_debug_parse_levels.cc
     |   `-- wx-utils_check.py
     |-- code
     |   |-- Makefile.am
     |   |-- Makefile.py
     |   |-- debug.cc
     |   |-- debug.h
     |   |-- linkassert.h
     |   `-- wx-utils_code.py
     |-- crypt
     |   |-- Makefile.am
     |   |-- Makefile.py
     |   |-- crypt.cc
     |   |-- crypt.h
     |   `-- wx-utils_crypt.py
     |-- error
     |   |-- Makefile.am
     |   |-- Makefile.py
     |   |-- error.cc
     |   |-- error.h
     |   `-- wx-utils_error.py
     `-- ext-crypt
         |-- Makefile.am
         |-- Makefile.py
         `-- wx-utils_ext-crypt.py
</pre>
   <p><a name="index-g_t_0040file_007bconfigure_002ein_007d-22"></a><a name="index-g_t_0040file_007bMakefile_002eam_007d-23"></a>Confix created a couple of files in the tree. <samp><span class="file">configure.in</span></samp> is
the input for the Autoconf tool. It contains M4 code which will be
expanded to bourne shell code by Autoconf in the next step. The
various <samp><span class="file">Makefile.am</span></samp> files, in the package root directory and
its module directories are input for Automake and will be expanded to
Autoconf input in the next step. It does not matter if you do not
understand what is going on here. You do not normally need to. If you
do want to understand it, we refer you to the Autoconf and Automake
documentation. Also, there is a
<a href="http://sources.redhat.com/autobook/">good book</a> about both of
them, written by some of the maintainers. Suffice it to say that
Confix just did what is otherwise the package maintainer's job: it
wrote input files for the Autotools. This is the state of a package as
you would check it out from anonymous CVS if it were a regular open
source project on the Internet.

   <p><a name="index-module-description-file-24"></a><a name="index-description-file_002c-of-a-module-25"></a><a name="index-properties-of-a-module-26"></a><a name="index-module-properties-27"></a><a name="index-Python-28"></a>There are a few files I did not mention: <samp><span class="file">wx-utils_bin.py</span></samp>,
<samp><span class="file">wx-utils_check.py</span></samp>, <samp><span class="file">wx-utils_code.py</span></samp>, <samp><span class="file">wx-utils_crypt.py</span></samp>,
<samp><span class="file">wx-utils_error.py</span></samp>, and <samp><span class="file">wx-utils_ext-crypt.py</span></samp>. They contain
pickled<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a> Python objects whose purpose is to describe the
properties of the respective module. When the package is installed,
these description files are installed along with the other content of
the package and made available for other packages that use this
package. When Confix instruments that other package, it uses these
description files to calculate inter-package dependencies (see
<a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository &mdash; Inter-Package Knowledge Transfer</a>).

   <p><a name="index-dependencies_002c-inter_002dpackage-29"></a><a name="index-inter_002dpackage-dependencies-30"></a>Inter-package dependencies are the reason why one must use the
<samp><span class="option">--prefix</span></samp> option when instrumenting a package. Strictly
speaking, it is not necessary to specify <samp><span class="option">--prefix</span></samp> when
instrumenting the <code>wx-utils</code> package since it does not depend on any
other package. Nevertheless, we use it for clarity because our example
package could just as well depend on another package.

<div class="node">
<p><hr>
<a name="Bootstrapping-the-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Instrumenting-the-Package">Instrumenting the Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.3 Bootstrapping the Package</h3>

<p><a name="index-bootstrapping-31"></a><a name="index-g_t_0040file_007bconfigure_002ein_007d-32"></a><a name="index-g_t_0040command_007bconfigure_007d-33"></a><a name="index-g_t_0040file_007bMakefile_002eam_007d-34"></a><a name="index-g_t_0040file_007bMakefile_002ein_007d-35"></a><a name="index-portability_002c-Bourne-shell-36"></a><a name="index-portability_002c-_0040command_007bmake_007d-37"></a><a name="index-Bourne-shell-38"></a><a name="index-g_t_0040command_007bmake_007d-39"></a>In Autotools talk, the term <em>bootstrapping</em> refers to the process
of converting the input files, <samp><span class="file">configure.in</span></samp> and
<samp><span class="file">Makefile.am</span></samp>, to the files the end user sees, primarily
<samp><span class="file">configure</span></samp> and <samp><span class="file">Makefile.in</span></samp>. The Autotools are
<em>maintainer</em> tools and require the presence of other tools such
as Perl and M4 which the user may not have installed at his
site. <samp><span class="file">configure.in</span></samp>, for example, is a bunch of M4 macro
invocations which, when expanded by Autoconf, turn into an even
greater (and even more unreadable) bunch of Bourne shell code, the
<samp><span class="file">configure</span></samp> script. Likewise, <samp><span class="file">Makefile.am</span></samp> is a bunch of
bells and whistles, subject to be parsed and interpreted by the Perl
program Automake. The outcome of a <samp><span class="file">Makefile.am</span></samp> is a file
<samp><span class="file">Makefile.in</span></samp> which looks like an ordinary <samp><span class="file">Makefile</span></samp>, only
with some placeholders to be substituted by the user, by calling
<samp><span class="command">configure</span></samp> (but more on that later).

   <p>You see what the whole story adds up to: bootstrapping is using the
Autotools to convert the non-portable input files into an equivalent
portable form. The only two things that the user is required to have
are a Bourne shell, some associated programs like <samp><span class="command">sed</span></samp>, and a
reasonable incantation of the <samp><span class="command">make</span></samp> program. All these are
available on every Unix or Unix-like system since about 20 years now.

   <p>Having all that said, here's how we bootstrap.

<pre class="example">     
     $ pwd
     /home/jfasch/work/wx-utils
     $ aclocal -I /home/jfasch/confix/ac-m4 \
               -I /home/jfasch/confix/ac-m4/autoconf-archive/C++_Support
     $ autoheader
     $ automake --foreign --add-missing --copy
</pre>
   <p>An alternative (and more comfortable) way of bootstrapping a package
is integrated into Confix. The following command does exactly the
steps we have performed so far - instrumenting and bootstrapping.

<pre class="example">     $ confix.py --prefix=/home/jfasch/installed-packages --bootstrap
</pre>
   <p>By the way, the Python <code>getopt</code> module recognizes option
prefixes, as long as the prefix is unique. <samp><span class="option">boo</span></samp> is a unique
prefix of <samp><span class="option">bootstrap</span></samp>, so you can save keystrokes and just yell

<pre class="example">     $ confix.py --prefix=/home/jfasch/installed-packages --boo
</pre>
   <p><a name="index-g_t_0040command_007bconfigure_007d-40"></a>Here's how the package looks like after bootstrapping, with some
irrelevant parts omitted (Autoconf maintains some cache structures in
the hierachy, but these add nothing to the big picture). As explained
above, what's new is the shell script <samp><span class="file">configure</span></samp> and the
<samp><span class="file">Makefile.in</span></samp> files in the package root and the module
subdirectories. Apart from these primary files, Autoconf created a few
other files which are used during the build process in the next
section.

<pre class="example">     wx-utils
     |-- Makefile.am
     |-- Makefile.in
     |-- Makefile.py
     |-- aclocal.m4
     |-- config.guess
     |-- config.h.in
     |-- config.sub
     |-- configure
     |-- configure.in
     |-- depcomp
     |-- install-sh
     |-- ltmain.sh
     |-- missing
     |-- mkinstalldirs
     |-- stamp-h.in
     |-- bin
     |   |-- Makefile.am
     |   |-- Makefile.in
     |   |-- Makefile.py
     |   |-- crypt.cc
     |   `-- wx-utils_bin.py
     |-- check
     |   |-- Makefile.am
     |   |-- Makefile.in
     |   |-- Makefile.py
     |   |-- _check_debug_parse_levels.cc
     |   `-- wx-utils_check.py
     |-- code
     |   |-- Makefile.am
     |   |-- Makefile.in
     |   |-- Makefile.py
     |   |-- debug.cc
     |   |-- debug.h
     |   |-- linkassert.h
     |   `-- wx-utils_code.py
     |-- crypt
     |   |-- Makefile.am
     |   |-- Makefile.in
     |   |-- Makefile.py
     |   |-- crypt.cc
     |   |-- crypt.h
     |   `-- wx-utils_crypt.py
     |-- error
     |   |-- Makefile.am
     |   |-- Makefile.in
     |   |-- Makefile.py
     |   |-- error.cc
     |   |-- error.h
     |   `-- wx-utils_error.py
     `-- ext-crypt
         |-- Makefile.am
         |-- Makefile.in
         |-- Makefile.py
         `-- wx-utils_ext-crypt.py
</pre>
   <div class="node">
<p><hr>
<a name="The-Configuration-File-(Short-Introduction)"></a>
<a name="The-Configuration-File-_0028Short-Introduction_0029"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Building-the-Package">Building the Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Bootstrapping-the-Package">Bootstrapping the Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.4 The Configuration File (Short Introduction)</h3>

<p><a name="index-configuration-file-41"></a><a name="index-g_t_0040file_007b_002econfix_007d-42"></a>We noticed (at least) one annoying thing. Everytime we called Confix
we had to specify that <samp><span class="option">--prefix</span></samp> option. You will be using
Confix more than once during package maintenance, and I bet you will
want to have a way to get around this. This is the time to give a
short introduction to the configuration file. (See <a href="#The-Configuration-File">The Configuration File</a> for a more thorough explanation of the
configuration file and a list of all the settings available.)

   <p>At startup, Confix reads a file called <samp><span class="file">.confix</span></samp> in your home
directory<a rel="footnote" href="#fn-7" name="fnd-7"><sup>7</sup></a>. For our purposes the following simple
configuration file suffices.

<pre class="example">     
     myconfig = {
         'PREFIX': '/home/jfasch/installed-packages',
         'BUILDROOT': '/home/jfasch/tmp/build'
     }
     
     PROFILES = {
         'default': myconfig,
         'myownconfig': myconfig
     }
</pre>
   <p><a name="index-Python-43"></a><a name="index-profile_002c-configuration-44"></a><a name="index-configuration-profile-45"></a><a name="index-g_t_0040var_007bPROFILES_007d_002c-_0040file_007b_002econfix_007d-46"></a><a name="index-g_t_0040var_007bBUILDROOT_007d_002c-_0040file_007b_002econfix_007d-47"></a><a name="index-g_t_0040var_007bPREFIX_007d_002c-_0040file_007b_002econfix_007d-48"></a>This file is nothing but a Python script, it's just that it is not
executed by the Python interpreter directly, but rather by Confix
itself. You can put any code you like in it, but most of the time it
will be enough to define one or more <em>profiles</em>. A profile is a
set of parameters and settings which are valid for one Confix
session. Profiles are made visible to Confix through the global
<code>PROFILES</code> dictionary. The user selects a particular profile
through the <samp><span class="option">--profile</span></samp> option, for example

<pre class="example">     confix.py --profile=myownconfig --boo
</pre>
   <p>or just

<pre class="example">     confix.py --boo
</pre>
   <p>because '<code>default</code>' is the name of the default profile, and that
entry in the <code>PROFILES</code> dictionary is set up to point to the same
profile as '<code>myownconfig</code>'.

   <p>That's enough explanation for the time being. The only settings we are
interested in so far are '<code>PREFIX</code>' and '<code>BUILDROOT</code>'. (We
haven't got around to using '<code>BUILDROOT</code>' yet, but we will so
soon.)

   <p>Now that we have got rid of the <samp><span class="option">--prefix</span></samp> parameter, let's
continue with our package.

<div class="node">
<p><hr>
<a name="Building-the-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-the-Package">Installing the Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.5 Building the Package</h3>

<p><a name="index-building-a-package-49"></a><a name="index-package-maintainer-50"></a><a name="index-package-user-51"></a>So far, until now, we have performed the job of the package
<em>maintainer</em>. We used Confix to write Autotools input for us, and
used the Autotools to create a <samp><span class="command">configure</span></samp> script for the
user. Now let's switch our mode and become the <em>user</em> of our own
package. You probably have compiled an open source package before and
have already performed the <samp><span class="command">configure; make; make install</span></samp>
dance. That's what we will be doing in this section.

   <p>Before we begin, let us state one important issue: <em>we never
build in the source directory</em>. Rather, the build directory is a
distinct directory. Through this policy we can place the sources in a
directory which is subject to nightly backup, or on a RAID system, or
both, for example, whereas the build directory can be placed in a
location which is much cheaper. The build directory contains only data
which are easily reconstructed from the source, so it is unnecessary
to have it backed up.

   <p><a name="index-g_t_0040command_007bconfigure_007d-52"></a>Now here we go. We create the build directory, chdir to that
directory, call <samp><span class="command">configure</span></samp> (in the package root), and then
<samp><span class="command">make</span></samp>.

<pre class="example">     
     $ mkdir -p ~/tmp/build/wx-utils
     $ cd ~/tmp/build/wx-utils
     $ /home/jfasch/work/wx-utils/configure \
              --prefix=/home/jfasch/installed-packages
     $ make
</pre>
   <p>(<samp><span class="command">configure</span></samp> and <samp><span class="command">make</span></samp> generate lots of messages to
standard error, we omit them for clarity.)

   <p><a name="index-g_t_0040option_007b_002d_002dprefix_007d-53"></a><a name="index-module-description-file-54"></a><a name="index-description-file_002c-module-55"></a><a name="index-repository_002c-of-module-description-files-56"></a>Notice the usage of the <samp><span class="option">--prefix</span></samp> option here. We passed that
option to Confix when we were instrumenting the package; its purpose
there was to point Confix to module description file of other packages
that the <code>wx-utils</code> packages eventually depends on. The meaning of
the <samp><span class="option">--prefix</span></samp> option with <samp><span class="command">configure</span></samp> is a bit
different, albeit related. The prefix is the location the package will
get installed to (we will cover installation in the next section). The
relation to the module description files is that installing a package
involves installing the module description files into a location
called the <em>module description repository</em>. (Remember how we
generated the module description files in <a href="#Instrumenting-the-Package">Instrumenting the Package</a>.) Finally, installed module description files are used by
Confix when it instruments a package.

   <p>As always, there is a simpler way to do this. Confix can start
<samp><span class="command">configure</span></samp> and <samp><span class="command">make</span></samp> for you. From the package root,
call

<pre class="example">     $ pwd
     /home/jfasch/work/wx-utils
     $ confix.py --builddir=/home/jfasch/tmp/build/wx-utils --configure
</pre>
   <p>or alternatively, from anywhere you want,

<pre class="example">     $ confix.py --packageroot=/home/jfasch/work/wx-utils \
              --builddir=/home/jfasch/tmp/build/wx-utils \
              --configure
</pre>
   <p><a name="index-g_t_0040var_007bBUILDROOT_007d_002c-_0040file_007b_002econfix_007d-57"></a>I admit that this is not much simpler than calling <samp><span class="command">configure</span></samp>
by hand. But recall that we have set the '<code>BUILDROOT</code>' variable
in the configuration file to <samp><span class="file">/home/jfasch/tmp/build</span></samp>. The effect
of this setting is that Confix assumes the package's build directory
is a subdirectory <samp><span class="file">wx-utils</span></samp> of <samp><span class="file">/home/jfasch/tmp/build</span></samp>
(<samp><span class="file">wx-utils</span></samp> is the basename of the package root, that's how Confix
determines the name).

   <p>With this you can say,

<pre class="example">     $ confix.py --configure
</pre>
   <p>It's exactly the same with <samp><span class="command">make</span></samp>, you just say

<pre class="example">     $ confix.py --make
</pre>
   <p>or eventually, the equivalent of calling <samp><span class="command">make -k</span></samp>,

   <p><a name="index-g_t_0040option_007b_002d_002dtargets_007d-58"></a>
<pre class="example">     $ confix.py --make --targets=-k
</pre>
   <p>Put realistically, after a while of using Confix you will just end up
using the following power user composite command,

<pre class="example">     $ confix.py --boo --configu --make --targ=-k
</pre>
   <p><a name="index-Emacs_002c-_0040var_007bcompile_002dcommand_007d-59"></a><a name="index-g_t_0040var_007bcompile_002dcommand_007d_002c-in-Emacs-60"></a>which instruments the package, bootstraps it, configures and builds it
in one big swoop. You will even set your Emacs <var>compile-command</var>
variable to something like

<pre class="example">     $ confix.py --packageroot=/home/jfasch/work/wx-utils \
                 --boo --configu --make --targ=-k
</pre>
   <p>(Note that it is not necessary to re-bootstrap and re-configure a
package if you only want to compile it. Emacs gives you a chance to
edit the command before it is executed, and remembers the last billion
or so of commands you executed. So what I do at this point is to
remove <code>--boo</code> and <code>--configu</code> if I only want to compile.)

<div class="node">
<p><hr>
<a name="Installing-the-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Distributing-the-Package">Distributing the Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Building-the-Package">Building the Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.6 Installing the Package</h3>

<p>Package installation is simple,

<pre class="example">     $ pwd
     /home/jfasch/tmp/build/wx-utils
     $ make install
</pre>
   <p>or, alternatively, with the current working directory anywhere you
want,

<pre class="example">     $ confix.py --packageroot=/home/jfasch/work/wx-utils \
                 --make --targets=install
</pre>
   <p><a name="index-installation_002c-of-header-files-61"></a><a name="index-installation_002c-of-libraries-62"></a><a name="index-header-files-63"></a>This copies all files which should be visible to other code to the
installation directory under <samp><span class="file">$(prefix)</span></samp> (as given by
<samp><span class="command">configure --prefix=&lt;prefix&gt;</span></samp>). Which files are visible after
installation is determined by Confix according to several rules which
are explained in <a href="#Installation-_002d_002d_002d-Going-Public">Installation &mdash; Going Public</a>. For example, if
a particular module is a C or C++ library, then that library is be
installed into <samp><span class="file">$(prefix)/lib</span></samp>. Typically, a library is
accompanied by one or more header files; these are installed into
<samp><span class="file">$(prefix)/include</span></samp>, or subdirectories thereof.

   <p><a name="index-module-description-file-64"></a><a name="index-description-file_002c-module-65"></a><a name="index-repository_002c-of-module-description-files-66"></a>One point to note here, again, is that installation covers module
description files as well. These files are installed in a subdirectory
<samp><span class="file">repo</span></samp> of the installation directory, the module description
repository. (It is important that Confix users be aware of that fact
because the repository is a concept which is central to the inner
workings of Confix, as will be explained in <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository &mdash; Inter-Package Knowledge Transfer</a>.)

<div class="node">
<p><hr>
<a name="Distributing-the-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Summary">Summary</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-the-Package">Installing the Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.7 Distributing the Package</h3>

<p>So far we covered the life cycle of our test package from its raw
source form to its installed incarnation. However this is not the only
way a package can be treated. Rather, this is only the way the
package's maintainer uses to write, build and test his package.

   <p><a name="index-open-source-67"></a>If you ever compiled an open source package, then you probably have
taken the following steps.

     <ol type=1 start=1>

     <li>Download the source distribution from the Internet, likely in
compressed form, as a <samp><span class="file">.tar.gz</span></samp> file.

     <li>Unpack it, thereby creating the source tree rooted by the
<em>package root</em>.

     <li>Create a separate package build directory, chdir to that directory,
and call <samp><span class="command">configure</span></samp>, <samp><span class="command">make</span></samp>, and <samp><span class="command">make
install</span></samp>.

        </ol>

   <p>So how do these steps correspond to the maintainer's steps which were
described in this chapter? Actually, the package user performs a
subset of the maintainer's work. Remember the explanation in
<a href="#Bootstrapping-the-Package">Bootstrapping the Package</a>, where we pointed out that the user is
by no means required to have the Autotools available. Bootstrapping is
the point after which the package user's work and the maintainer's
work are the same. <samp><span class="command">configure; make; make install</span></samp>.

   <p>What is still unclear is how the source distribution is made. Clearly
this is not done by hand, as this job is tedious and error
prone. Automake implements a set of makefile targets for this,

     <ul>
<li><code>dist</code> creates a <samp><span class="file">.tar.gz</span></samp> distribution.

     <li><code>dist-bzip2</code> creates a <samp><span class="file">.tar.bz2</span></samp> distribution.

     <li><code>dist-shar</code> creates a shell archive distribution.

     <li><code>dist-zip</code> create a zip file (popular on Windows).

     <li><code>dist-tarZ</code> creates an old-style <samp><span class="file">.tar.Z</span></samp> distribution.

   </ul>

   <p><a name="index-g_t_0040command_007bmake-dist_007d-68"></a>Consult the Automake documentation for details about the various dist
targets and how they work in detail. For example, to create a source
distribution of our <code>wx-utils</code> package, we call

<pre class="example">     $ pwd
     /home/jfasch/tmp/build/wx-utils
     $ make dist
</pre>
   <p>or, through Confix,

<pre class="example">     $ confix.py --make --targets=dist
</pre>
   <p><a name="index-package-name-69"></a>This will create the distribution tar file in the package's build
directory. The resulting distribution file's name has the form
<samp><span class="file">&lt;packagename&gt;-&lt;packageversion&gt;.tar.gz</span></samp>. Unless otherwise
specified, <samp><span class="file">&lt;packagename&gt;</span></samp> is the name of the package root
directory, and <samp><span class="file">&lt;packageversion&gt;</span></samp> is 0.0.0. For example, if we
made a source distribution from our <samp><span class="file">wx-utils</span></samp> package, the file
name would be <samp><span class="file">wx-utils-0.0.0.tar.gz</span></samp>. See <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a> for ways to specify the package name and
version.

<div class="node">
<p><hr>
<a name="Summary"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Distributing-the-Package">Distributing the Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#An-Example">An Example</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">2.8 Summary</h3>

<p>In this chapter we have primarily learned about what you have to do
when you are a <em>package maintainer</em>, and how Confix helps you do
your job. We also covered shortly the role of the <em>package
user</em>. We also touched a few concepts involved: <em>dependency
calculation</em> and the <em>module description files</em>.

   <p>We presented lots of command lines as well as one helpful feature, the
configuration file. Here's a recap of the most important commands we
saw. (We assume a <samp><span class="file">.confix</span></samp> file with contents about as in
<a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a>.)

     <ul>
<li><em>Bootstrap.</em> This is the process of instrumenting the package and
generating all the files which are necessary for the end user.

     <pre class="example">          $ confix.py --bootstrap
     </pre>
     <p>in the package root directory, or, as always,

     <pre class="example">          $ confix.py --packageroot=/home/jfasch/work/wx-utils \
                  --bootstrap
     </pre>
     <p>in any directory.

     <li><em>Configure.</em> Preparing the package for the ultimate
build. Performing checks and creating a <samp><span class="file">Makefile</span></samp> in every
directory of the package.

     <pre class="example">          $ confix.py --configure
     </pre>
     <li><em>Make, Install.</em> Compiling the package and installing it.

     <pre class="example">          $ confix.py --make
     </pre>
     <p>or

     <pre class="example">          $ confix.py --make --targets=-k
     </pre>
     <p>or

     <pre class="example">          $ confix.py --make --targets='-k install'
     </pre>
     <p>or, without Confix, in the package build directory,

     <pre class="example">          $ make install
     </pre>
     </ul>

<div class="node">
<p><hr>
<a name="How-Confix-Works"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#An-Example">An Example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">3 How Confix Works</h2>

<p>This chapter gives an overview of the concepts involved. It describes
each step Confix takes when it instruments a package. The description
may look more technical than necessary to you. But, on the other hand,
I am quite certain that it is easier for the user to understand the
rest of the manual if the concepts are clear from the
beginning. Confix offers an increasing range of possibilities where
the user can hook in to influence the build process. To fully utilize
this flexibility, it is crucial to understand how Confix works.

   <p>Don't be scared though, we only scratch the surface here. The details
are buried in the appendixes which you can consult if there is need
to. (If the appendixes do not contain enough material to satisfy you,
then I haven't yet found time to do it right. Complain to me, or
continue to ask questions, in either case the probability increases
that I write it down.)

<ul class="menu">
<li><a accesskey="1" href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a>
<li><a accesskey="2" href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a>
<li><a accesskey="3" href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks --- The Autoconf Way of Portability</a>
<li><a accesskey="4" href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a>
</ul>

<div class="node">
<p><hr>
<a name="Scanning-----Gathering-the-Pieces"></a>
<a name="Scanning-_002d_002d_002d-Gathering-the-Pieces"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-Confix-Works">How Confix Works</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#How-Confix-Works">How Confix Works</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">3.1 Scanning &mdash; Gathering the Pieces</h3>

<p>Before Confix can instrument a package it must first determine the
modules which have to be instrumented, and the <em>properties</em> of
these modules.

   <p>We saw in the example in the preceding chapter that Confix traverses
the package beginning at the package root. It examines every directory
on the way, and if that directory contains a <samp><span class="file">Makefile.py</span></samp> file,
the directory is considered a module of the package and is remembered
for later instrumentation. (See <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>
for a detailed explanation of what that file can contain.)

   <p>Once <samp><span class="file">Makefile.py</span></samp> is found in a directory, Confix further
examines this directory by interpreting its <samp><span class="file">Makefile.py</span></samp>, and by
examining the directory at the file system level (i.e., looking what
files it contains). From this, the module's properties are
determined. Properties include such things as

     <ul>
<li><a name="index-buildable-70"></a><em>Buildable</em> objects. Confix uses these to generate build
instructions for anything that can be built. For example, there is one
buildable object for every C++ source file in a module; the same holds
for other file types, such as C source files, C header files, and Lex
and Yacc files. Apart from these buildable types that comprise single
source files, there are more complicated <em>composite</em> buildable
types &mdash; a library of compiled object files, for example, or an
executable.

     <p>Confix uses a great deal of heuristics to determine what has to be
built, and how<a rel="footnote" href="#fn-8" name="fnd-8"><sup>8</sup></a>. For
example, if it finds out that a C or C++ source file contains the
<code>main()</code> function, then it concludes that the package maintainer
wants this file to become an executable, and links it with all other
files in the module that do not contain the <code>main()</code>
function. Contrariwise, if it finds that no source file of a module
contains <code>main()</code>, then it decides to build a library
instead. However, some of Confix's heuristics are a bit, well,
simplistic, and you need to help it a bit. See <a href="#What-Will-Be-Built">What Will Be Built</a> for a more detailed explanation of Confix's heuristics, and how
to help out if something goes wrong.

     <li><a name="index-require-71"></a><a name="index-provide-72"></a><em>Provide</em> and <em>Require</em> objects. These important concepts
are central to computing the inter-module dependencies. A module A is
said to depend on another module B if module B <em>provides</em>
something that module A <em>requires</em>. For example, consider a file
<samp><span class="file">a.c</span></samp> in module A which <code>#include</code>s a file <samp><span class="file">b.h</span></samp> which
is located in module B. This is a situation where module A
<em>requires</em> (through the <code>#include &lt;b.h&gt;</code> directive in its
<em>buildable</em> file <samp><span class="file">a.c</span></samp>) a file <samp><span class="file">b.h</span></samp> which is
<em>provided</em> by module B.

     <p><br>

     <div class="block-image"><img src="prov-req.png" alt="prov-req.png"></div>

     <p>In the remainder of this document, the words <em>provide</em> and
<em>require</em> will often be used as a noun. This is to clarify that
we mean the properties of a module which are the fundamentals of the
resolving process (which will be explained in the next section).

     <p>The fact that a buildable in module A contains <code>#include &lt;b.h&gt;</code>
is said to be <em>a require</em>, whereas the fact that module B
contains <samp><span class="file">b.h</span></samp> is said to be <em>a provide</em>. The latter
satisfies &mdash; <em>resolves</em> &mdash; the former, and thus module A is
said to <em>depend</em> on module B.

     <li><a name="index-checks_002c-Autoconf-73"></a><a name="index-Autoconf-checks-74"></a><a name="index-contributing_002c-to-a-module_0027s-properties-75"></a><a name="index-contributing-checks-76"></a><em>Checks</em>. One of the most basic albeit powerful features of
Autoconf is its ability to check the availability of certain features,
and to provide that information (available yes/no/what/how) to the
build process. Without Confix, these checks have to specified in the
<samp><span class="file">configure.in</span></samp> file by the maintainer. With Confix, checks are
properties of modules and are mostly determined by the module's
buildable objects. See <a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks &mdash; The Autoconf Way of Portability</a>
further down in this chapter for more about checks, and <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository &mdash; Inter-Package Knowledge Transfer</a> for how Confix carries
checks across package boundaries.

     <li><em>Module content</em>. A module content is an object that describes
what another module has to do if it uses this module. For example, the
<em>content</em> of a module whose outcome is a C library describes to a
using module what the name of the library is and what include path
must be set to find the library's accompanying header files.

   </ul>

   <p>So much for the internal structures of Confix. Sure there is more to
it, but this is beyond the scope of this manual. However, if you are
interested: it is actually implemented this way, and you should easily
be able to find the associated Python classes by using something like
<samp><span class="command">grep -i</span></samp> in the source code.

<div class="node">
<p><hr>
<a name="Resolving-----Determining-the-Build-Order"></a>
<a name="Resolving-_002d_002d_002d-Determining-the-Build-Order"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks --- The Autoconf Way of Portability</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#How-Confix-Works">How Confix Works</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">3.2 Resolving &mdash; Determining the Build Order</h3>

<p><a name="index-dependency-graph-77"></a><a name="index-dependency-resolving-78"></a><a name="index-resolving_002c-dependencies-79"></a>Resolving is the task of building a directed acyclic graph of modules,
the <em>dependency graph</em>. In the preceding section we saw an
example which detailed the concept of <em>provide</em> and
<em>require</em> and what these have to do with module
dependencies. According to this example, if the modules A and B are
nodes in the dependency graph, then a graph edge leads from A to B if
(and only if) A depends on B.

   <p>Confix builds this dependency graph by matching the <em>requires</em> of
all modules against the <em>provides</em> of all modules. If a require
of module A is matched (resolved) by a provide of module B, then we
have an edge from A to B in the graph.

   <p><a name="index-module-description-file-80"></a><a name="index-description-file_002c-module-81"></a><a name="index-repository_002c-of-module-description-files-82"></a>Note that the resolving process is not local to the package that is
being instrumented. A module of the package may require something that
is not provided locally, but rather by a module of another
package. How can this dependency be resolved? Recall how we came
across the module description files and the module repository multiple
times in this manual (an indication that it must somehow be central to
Confix). It's these repository files that carry the information what
items an installed module provides and requires. When Confix builds
the dependency graph, it not only determines the properties of the
modules in this package, but also reads the module description
repository<a rel="footnote" href="#fn-9" name="fnd-9"><sup>9</sup></a> to determine the properties of installed modules.

   <p>Now what has a dependency graph to do with building a package? The
answer is <em>build order</em>. For example, consider our example
<samp><span class="file">wx-utils</span></samp> package from the preceding chapter. There is a module
called <samp><span class="file">bin</span></samp> which contains executables. On of these, built from
the source file <samp><span class="file">crypt.cc</span></samp>, is a simple program which accept two
arguments from the commandline and passes these to the
<code>WX::Utils::Crypt::crypt()</code> method, which is defined in the
<samp><span class="file">crypt</span></samp> module of the <samp><span class="file">wx-utils</span></samp> package. Through this
relationship, we say that module <samp><span class="file">bin</span></samp> depends on module
<samp><span class="file">crypt</span></samp>.

   <p>Confix sees dependencies through the occurence of include directives
in source files. <samp><span class="file">bin/crypt.cc</span></samp> contains a line <code>#include
&lt;WX/Utils/crypt.h&gt;</code> &mdash; in other words, module <samp><span class="file">bin</span></samp>
<em>requires</em> a file <samp><span class="file">WX/Utils/indent.h</span></samp>. On the other hand,
the module <code>crypt</code> contains a file <samp><span class="file">crypt.h</span></samp> which is
<em>provided</em> as <samp><span class="file">WX/Utils/crypt.h</span></samp><a rel="footnote" href="#fn-10" name="fnd-10"><sup>10</sup></a>

   <p>Now consider what happens if module <samp><span class="file">bin</span></samp> was built before module
<samp><span class="file">crypt</span></samp>. <samp><span class="file">bin</span></samp> contains a C++ executable, with the
<code>main()</code> routine in <samp><span class="file">bin/crypt.cc</span></samp>. This executable contains
a reference to a routine <code>WX::Utils::Crypt::crypt()</code> which is
defined in <samp><span class="file">crypt/crypt.cc</span></samp>. When it comes to linking the
executable, the linker will try to satisfy that reference, which it
cannot because module <samp><span class="file">crypt</span></samp> has not yet been built.

   <p>Hence, module <samp><span class="file">crypt</span></samp> must be built before <samp><span class="file">bin</span></samp>. Confix
ensures this by examining the dependency graph and calculating a
correct build order from it<a rel="footnote" href="#fn-11" name="fnd-11"><sup>11</sup></a>. Dependency cycles (see <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order &mdash; How Things Can Easily Go Wrong</a>) are clearly an error; this error is
detected by Confix, and reasonable messages are output so that the
user will be able to break up the cycle.

<div class="node">
<p><hr>
<a name="Checks-----The-Autoconf-Way-of-Portability"></a>
<a name="Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#How-Confix-Works">How Confix Works</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">3.3 Checks &mdash; The Autoconf Way of Portability</h3>

<p>One approach to cross-platform portability is to wrap platform
dependent code in <code>#ifdef</code>s, and to create an if-then-else ladder
where you switch across architectures like this,

<pre class="example">     #ifdef Solaris
     // Solaris code here
     #elif (defined Linux)
     // Linux code here
     #elif
     // blah
     #endif
</pre>
   <p>Autoconf's (and, as Confix sits on top of it, Confix's) approach to
portability is a bit different. It checks for features instead of for
architectures, so that you do not anymore switch across architectures,
but rather react on the presence or non-presence of features. Autoconf
and Automake provide a bunch of so-called <em>checks</em>: M4 macros
which expand to Bourne shell code. What they do is best explained with
an example.

   <p>A C++ file (which is buildable object) certainly requires the
availability of a C++ compiler. So, the buildable automatically
contributes the appropriate Autoconf check to its enclosing
module. Confix takes care that all checks gathered this way be written
to the <samp><span class="file">configure.in</span></samp> file in the package root, as if the
maintainer had written them.

   <p>The effect of this check is seen when the user calls
<samp><span class="command">configure</span></samp>. The <samp><span class="command">configure</span></samp> script executes code that
tries out several things, such as looking if the <samp><span class="env">CXX</span></samp> environment
variable is set, checking if it points to a valid executable, checking
if that executable can be used as a C++ compiler, what the flags and
options are that have to be passed to that compiler to function
properly, and so on. The effect of this particular check is that some
well-defined <samp><span class="command">sh</span></samp> variables are set for further use in
<samp><span class="command">configure</span></samp>, that code is generated to substitute specific
patterns in the various <samp><span class="file">Makefile.in</span></samp>'s in the package tree, and
so on. As for <samp><span class="command">sh</span></samp> variables: C++ specific checks need them to
be able to call the appopriate compiler to perform their work. For
example, a check that determines if <code>stringstream</code> is available
and works correctly (sigh!) needs to generate code that uses
<code>stringstream</code>, and then call the C++ compiler to compile and
eventually link the program.

   <p><a name="index-ordering_002c-of-Autoconf-checks-83"></a><a name="index-checks_002c-ordering-of-84"></a>This leads us to another feature of Confix<a rel="footnote" href="#fn-12" name="fnd-12"><sup>12</sup></a> associated with Autoconf checks: it respects
ordering of checks. For example, the check for the C++ compiler has to
be performed before a check for a particular language feature, such as
the <code>stringstream</code> class.

   <p>Checks are not only contributed implicitly. There are several ways
that checks can be contributed explicitly by the maintainer. See
<a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>, <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a>, <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>, and <a href="#The-Buildable-Interface">The Buildable Interface</a> for various ways to explicitly add
checks<a rel="footnote" href="#fn-13" name="fnd-13"><sup>13</sup></a>.

   <p>See also <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository &mdash; Inter-Package Knowledge Transfer</a> how
the build process of one module is automatically crafted to perform
all checks of all installed modules it uses.

<div class="node">
<p><hr>
<a name="Module-Repository-----Inter-Package-Knowledge-Transfer"></a>
<a name="Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks --- The Autoconf Way of Portability</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#How-Confix-Works">How Confix Works</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">3.4 Module Repository &mdash; Inter-Package Knowledge Transfer</h3>

<p>Suppose that you are in the situation where you have, say, ten
installed packages which amount to twenty or so libraries. You are
writing an executable which directly uses features from three of these
libraries, and carefully craft your link line to contain these three
libraries. Most likely this is not enough because one of these
libraries is not self-contained &mdash; it depends on another four
libraries. And so on.

   <p><a name="index-module-description-file-85"></a><a name="index-description-file_002c-module-86"></a><a name="index-repository_002c-of-module-description-files-87"></a>Without Confix, you'd have to explicitly know about these
dependencies, and hand-craft your link lines and include paths
accordingly. Confix's process of computing a correct build order has
already been outlined in <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving &mdash; Determining the Build Order</a>. There we pointed out that computing the build order involves
topologically sorting the dependency graph. Now, that graph does not
only contain modules which are local to the package, but also those
modules which have been installed &mdash; whose module description files
are available in the module repository. In other words, the graph
presents a global view of module dependencies.

   <p><a name="index-include-path-88"></a><a name="index-link-line-89"></a><a name="index-build-order-90"></a>So, a topologically sorted list of the graph's nodes (the modules)
gives enough information to compute the following important items.

     <ul>
<li>A correct build order. Only the modules of the current package must be
taken, of course, as it doesn't make any sense to build an installed
module.

     <li>A correct include path.

     <li>A correct link line.

   </ul>

   <p>This is only one example (although the most important) of how Confix
coordinates packages and their modules. Autoconf checks are another
example.

   <p><a name="index-Autoconf-checks-91"></a><a name="index-checks_002c-Autoconf-92"></a>Say one module (a C or C++ library, as always) performs a check for,
say, the availability of the JPEG library. That library is not
maintained by Confix, but rather part of the Linux distribution (they
don't manage their stuff with Confix yet). This check succeeds, and
the module ends up referencing a function which is defined in the JPEG
library. The check not only checked for the availability, but also set
a <samp><span class="command">sh</span></samp> variable that contains the name of the library. This
variable normally has to be put on the link line of an executable so
that the library is seen by the linker and the symbol can be resolved.

   <p>Now, sadly, the check is only performed locally, in the package that
contains the module that directly uses the JPEG library. Any
executable, of another package, that uses that module will get a
linker error because it does not perform the same check (and thus does
not add the JPEG library to the link line).

   <p><a name="index-module-description-file-93"></a><a name="index-description-file_002c-module-94"></a><a name="index-repository_002c-of-module-description-files-95"></a>Here's where Confix and its module description repository helps
again. Autoconf checks are <em>properties of the module</em> and thus
show up in the module description file which is read by
Confix. Whenever a module uses another module, Confix automatically
arranges that it performs all the checks of that module.

<div class="node">
<p><hr>
<a name="The-Coders-Role-in-the-Build-Process"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Users-Role-in-the-Build-Process">The Users Role in the Build Process</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-Confix-Works">How Confix Works</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">4 The Coder's Role in the Build Process</h2>

<p><a name="index-automatisms_002c-and-flexibility-96"></a><a name="index-rule_002c-restrictions_002c-for-the-maintainer-97"></a><a name="index-restrictions_002c-imposed-on-the-maintainer-98"></a>One of the advantages of Confix is that you are not required to write
any explicit build instructions to control the build process of a
package and its modules. Confix tries to determine everything it needs
to know from the files it has to write build instructions
for. However, nothing is for free. Automatisms generally tend to cut
down flexibility of the underlying mechanisms, and unfortunately
Confix is not an exception to this. Confix imposes a few rules on the
package maintainer, and for sure you cannot do everything you could do
if you used the Autotools directly<a rel="footnote" href="#fn-14" name="fnd-14"><sup>14</sup></a>. But read on to get a better judgement.

   <p>In this section we will explain basic properties of the build process,
mainly by outlining how Confix works. As opposed to the previous
section, <a href="#How-Confix-Works">How Confix Works</a> (where we explained how Confix works),
in this chapter we will put more focus on the package maintainer. We
will try to make clear what the relevant package properties are, and
how the maintainer can/should direct Confix to best determine
these. Most of the package's build properties can be explicitly
configured by the maintainer. However, this chapter deals with the
properties and the involved automatisms Confix implements, and refers
to <a href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a> otherwise. The chapter is
a bit lengthy as it goes to technical details whenever I feel that I
need to justify why a particular restriction is the way it is. If you
are curious, I suggest you read the chapter. If you are impatient, I
suggest you only read the summary at the end of the chapter
(<a href="#Summary-of-Rules-and-Restrictions">Summary of Rules and Restrictions</a>) and uncritically accept what
is there.

   <p>To get an overview, here are some of the package properties we will be
talking about.

     <ul>
<li><em>What files will be built.</em> Just like the Autotools, Confix uses
file extensions for its decision what is built and how.

     <li><a name="index-installation-location-99"></a><a name="index-install-directory-100"></a><em>Installation locations.</em> It makes sense to install header files
(for example) into subdirectories of the public
<samp><span class="file">$(prefix)/include</span></samp> directory, primarily to prevent file name
clashes when several packages are installed in the same location.

     <li><a name="index-build-order-101"></a><a name="index-order_002c-of-build-102"></a><em>Build order.</em> We have touched this several times &mdash; the
maintainer implicitly specifies the build order through
<em>provides</em> and <em>requires</em>.

     <li><em>What is public, what is private?</em> For example, you may have
header files which are only used during build, whereas others should
be made publicly available by installing them.

     <li><em>Checks.</em> Confix provides various ways for the maintainer to add
Autoconf checks to the build process.

     <!-- FIXME: what else -->
</ul>

   <p>Further, we will mostly be talking about C and C++ in this chapter
because these are the only languages which are supported at the time
of this writing<a rel="footnote" href="#fn-15" name="fnd-15"><sup>15</sup></a>. The chapter will get
deeper structure as other languages arrive.

<ul class="menu">
<li><a accesskey="1" href="#What-Will-Be-Built">What Will Be Built</a>
<li><a accesskey="2" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>
<li><a accesskey="3" href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a>
<li><a accesskey="4" href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>
<li><a accesskey="5" href="#Performing-Automatic-Tests">Performing Automatic Tests</a>
<li><a accesskey="6" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>
<li><a accesskey="7" href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a>
<li><a accesskey="8" href="#Using-GNU-Libtool">Using GNU Libtool</a>
<li><a accesskey="9" href="#Summary-of-Rules-and-Restrictions">Summary of Rules and Restrictions</a>
</ul>

<div class="node">
<p><hr>
<a name="What-Will-Be-Built"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.1 What Will Be Built, and How</h3>

<p><a name="index-compiling-source-files-103"></a><a name="index-archive-104"></a><a name="index-static-library-105"></a><a name="index-shared-library-106"></a><a name="index-library_002c-static-107"></a><a name="index-library_002c-shared-108"></a><a name="index-executable-109"></a>Building C<a rel="footnote" href="#fn-16" name="fnd-16"><sup>16</sup></a> code is usually done in several
steps. First, source files are compiled into object files. Then,
object files are grouped together to form some kind of compound
object. One example of a compound object (the simplest) is an
<em>archive</em>, also known as <em>static library</em>. Another form of a
compound object is a <em>shared library</em>, which is similar to a
static library, but not quite<a rel="footnote" href="#fn-17" name="fnd-17"><sup>17</sup></a>. The incarnation of a compound object that
most computer users know is an <em>executable</em>.

   <p>The following section describes how Confix decides how source code is
built, and how to group the compiled object files into compound
objects.

<ul class="menu">
<li><a accesskey="1" href="#Building-Source-Files">Building Source Files</a>
<li><a accesskey="2" href="#Library-or-Executables_003f">Library or Executables?</a>
<li><a accesskey="3" href="#Generated-and-Explicit-Names">Generated and Explicit Names</a>
</ul>

<div class="node">
<p><hr>
<a name="Building-Source-Files"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Library-or-Executables_003f">Library or Executables?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-Will-Be-Built">What Will Be Built</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#What-Will-Be-Built">What Will Be Built</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.1.1 Building Source Files</h4>

<p><a name="index-filenames-110"></a><a name="index-file-suffixes-111"></a><a name="index-suffixes_002c-of-filenames-112"></a><a name="index-extension_002c-of-filenames-113"></a>From the file names in a directory, Confix determines what source
files should be built. If a directory contains files which boil down
to compiled object code, Confix assumes that either a library or one
or more executables will be built. (See below for heuristics that help
Confix decide which.)  Confix uses much of the Autotools functionality
to accomplish the task of building object code.

   <p>The Autotools recognize several filename extensions and generate
<samp><span class="command">make</span></samp> rules accordingly, and so does Confix. Currently, the
file extensions recognized are

     <ul>
<li><a name="index-C-114"></a><code>.c</code>: Plain C code

     <li><a name="index-C_002b_002b-115"></a><code>.cc</code>,<code>.cpp</code>: C++ code

     <li><a name="index-Lex-116"></a><code>.l</code>: <code>lex</code>, generating C code. Autoconf will determine the
<code>lex</code> derivative, so you may end up compiling with <code>flex</code>
under the hood, for example.

     <li><a name="index-Lex_002c-and-C_002b_002b-117"></a><code>.ll</code>: <code>lex</code>, generating C++ code. <em>Note</em> that you may
encounter portability problems if you are using this feature because
not every <code>lex</code> version on every platform will be capable of
generating C++ output. You will then have to force your users to
install one <code>lex</code> version that is capable of that. The
alternative is to accept that <code>lex</code> is somewhat, well, stupid,
and assume that the user's <code>lex</code> version can do no more than K&amp;R
C, and name your <code>lex</code> files <code>.l</code>. <em>Note</em> also that
there is no general advice as to which <code>lex</code> version or
derivative your code is best compiled with. This topic is completely
left to Autoconf which will determine the version &mdash; proper or
improper.

     <li><a name="index-Yacc-118"></a><code>.y</code>: <code>yacc</code>, generating C code. Again Automake determines
the derivative and reacts properly.

     <li><a name="index-Yacc_002c-and-C_002b_002b-119"></a><code>.yy</code>: generating C++ code. Same problem as with <code>lex</code>.

   </ul>

   <p>By default, unless stated otherwise, Confix tries to build every file
in a directory that it recognizes. Sometimes however you want to keep
source files in a directory that you do not want to have built,
probably because they do not compile yet. You can tell Confix to
ignore these files; see the <code>IGNORE_FILE()</code> function in <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>.

<div class="node">
<p><hr>
<a name="Library-or-Executables%3f"></a>
<a name="Library-or-Executables_003f"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Generated-and-Explicit-Names">Generated and Explicit Names</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Building-Source-Files">Building Source Files</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#What-Will-Be-Built">What Will Be Built</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.1.2 Library or Executables?</h4>

<p><a name="index-properties_002c-of-source-files-120"></a><a name="index-source-file-properties-121"></a>Before Confix can generate build instructions for compound objects, it
has to decide which compound object(s) should be built. Recall section
<a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning &mdash; Gathering the Pieces</a> where we explained the concept
of <em>buildable objects</em> for single files.  Internally, every
source file is wrapped into a (Python language) object which is
responsible for generating build instructions for that file. Another
responsibility of a single-file buildable object of C language type is
to maintain a certain property that tells Confix whether the source
file contains the <code>main()</code> function.

   <p><a name="index-static-library-122"></a><a name="index-shared-library-123"></a><a name="index-Libtool-124"></a>
     <ul>
<li><em>Library</em>. Confix puts all compiled files of the module together
into a library if none of the source files has the <code>main()</code>
funtion defined. By default, Confix generates a static library; see
<a href="#Using-GNU-Libtool">Using GNU Libtool</a> for explanation of how to build shared
libraries.

     <li><em>Executable(s)</em>. If any of the files has <code>main()</code> defined,
Confix divides the files of the module in two groups: those which have
<code>main()</code> and those which don't. Every file that has <code>main()</code>
becomes an executable, and it is linked together with those files that
don't have <code>main()</code>.

   </ul>

   <p><a name="index-MAIN_002c-source-file-property-125"></a><a name="index-MAIN_002c-buildable-interface-126"></a><a name="index-FILE_005fPROPERTIES-127"></a>So how does Confix determine this &ldquo;have the <code>main()</code> function&rdquo;
property? It scans every source file and employs a simple minded
parser to search for patterns that look like as if they were the
definition of <code>main()</code>. But this parser is not a real C/C++
parser, and it is likely to produce false results. Mostly it will see
a <code>main()</code> definition where there is none, rather than the other
way around. If this is the case, you'll probably see a linker error
message that tries to tell you that linking failed because <code>main</code>
is undefined. You then have two choices; either search in the
offending source file for occurences of <code>main</code> and change them to
<code>primary</code> or something; or you use one of the Confix interfaces
to explicitly set the source file's <code>'MAIN'</code> property to tell
Confix that there's no <code>main()</code> in the file<a rel="footnote" href="#fn-18" name="fnd-18"><sup>18</sup></a>. See the
<code>MAIN()</code> and <code>FILE_PROPERTIES()</code> functions described in
<a href="#The-Buildable-Interface">The Buildable Interface</a>, or the <code>FILE_PROPERTIES()</code>
function described in <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a> for ways
to influence Confix in this respect.

<ul class="menu">
<li><a accesskey="1" href="#Generated-and-Explicit-Names">Generated and Explicit Names</a>
</ul>

<div class="node">
<p><hr>
<a name="Generated-and-Explicit-Names"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Library-or-Executables_003f">Library or Executables?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#What-Will-Be-Built">What Will Be Built</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.1.3 Generated and Explicit Names</h4>

<p><a name="index-name_002c-of-an-executable-128"></a><a name="index-executable-name-129"></a><a name="index-EXENAME_002c-source-file-property-130"></a><a name="index-EXENAME_002c-buildable-interface-131"></a><a name="index-FILE_005fPROPERTIES-132"></a><a name="index-name_002c-of-a-library-133"></a><a name="index-library-name-134"></a><a name="index-LIBNAME_002c-module-property-135"></a><a name="index-LIBNAME_002c-module-interface-136"></a><a name="index-MODULE_005fPROPERTIES-137"></a><a name="index-module-properties-138"></a><a name="index-properties_002c-of-modules-139"></a>Confix tries to generate instructions to successfully build a package,
ideally without any input from the package's maintainer. However, in
doing so, Confix tries to not bring the package in conflict with other
packages. It is likely that more than one package is installed in the
same location &mdash; this is the common case (the default installation
prefix is <samp><span class="file">/usr/local</span></samp>). Now, for example, consider that two
packages build executables, and that the names of two different
executables are equal. These two executables would overwrite each
other.

   <p>To prevent this situation, Confix does not simply take the name of the
source file that has the <code>main()</code> function defined, as this would
easily lead to the situation deescribed above. Rather, Confix
&ldquo;mangles&rdquo; the name from the package name, the module name, and the
source file name. While this is ok for test programs that are run
automatically (see <a href="#Performing-Automatic-Tests">Performing Automatic Tests</a> for more), you
probably want to explicitly specify a name for these executables that
you want to make visible to users. To do this, you set the
<code>'EXENAME'</code> source file property; see the <code>EXENAME()</code> and
<code>FILE_PROPERTIES()</code> functions described in <a href="#The-Buildable-Interface">The Buildable Interface</a>, or the <code>FILE_PROPERTIES()</code> function described in
<a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>.

   <p><a name="index-module-properties-140"></a><a name="index-properties_002c-of-modules-141"></a><a name="index-LIBNAME-142"></a><a name="index-LIBNAME-143"></a><a name="index-MODULE_005fPROPERTIES-144"></a>A similar conflict could happen with libraries, and Confix solves this
problem the same way. Mangled library names are not normally a problem
for the user because Confix recognizes module dependencies and
generates link lines automatically. However, until Confix achieves
world domination, it is likely that the libraries that are built by
Confix are used by code that is not built by Confix<a rel="footnote" href="#fn-19" name="fnd-19"><sup>19</sup></a>. In this case you have to give your library a
publicly understandable name by using the <code>MODULE_PROPERTIES()</code>
or <code>LIBNAME()</code> functions described in <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>.

<div class="node">
<p><hr>
<a name="Installation-----Going-Public"></a>
<a name="Installation-_002d_002d_002d-Going-Public"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-Will-Be-Built">What Will Be Built</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.2 Installation &mdash; Going Public</h3>

<p><a name="index-installation-location-145"></a><a name="index-install-directory-146"></a>One important part of build management is the installation
location. The Autotools are pretty clear about what goes where; they
state, for example, that header files go into
<samp><span class="file">$(prefix)/include</span></samp>, libraries go into <samp><span class="file">$(prefix)/lib</span></samp>,
executables go into <samp><span class="file">$(prefix)/bin</span></samp>, and so on.

   <p>There are more aspects of installation, two of which we will cover in
this section. First, you need a way to differentiate between files
which will go public and files which won't. Second, you may want to
put your header files into subdirectories of <samp><span class="file">$(prefix)/include</span></samp>.

<ul class="menu">
<li><a accesskey="1" href="#What-Goes-Public">What Goes Public</a>
<li><a accesskey="2" href="#Namespaces">Namespaces</a>
<li><a accesskey="3" href="#Installation-_002d_002d_002d-A-Short-Example">Installation --- A Short Example</a>
<li><a accesskey="4" href="#Restrictions">Restrictions</a>
</ul>

<div class="node">
<p><hr>
<a name="What-Goes-Public"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Namespaces">Namespaces</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.2.1 What Goes Public</h4>

<p>When you are building a library, you will most likely have header
files which you want to install along with that library. But, on the
other hand, you will likely have header files whose purpose is an
internal one, and which no-one needs anymore once the library is
built. You do not want these to be installed.

   <p><a name="index-header-files_002c-installing-147"></a><a name="index-installing-header-files-148"></a><a name="index-header-files_002c-public-149"></a><a name="index-header-files_002c-private-150"></a><a name="index-public-header-files-151"></a><a name="index-private-header-files-152"></a>To have Confix automatically differentiate between public and private
header files, you simply prefix the private files with an
underscore. Private files are then visible to modules within the same
package, but they don't get installed and thus are not visible to
modules from other packages.

<div class="node">
<p><hr>
<a name="Namespaces"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installation-_002d_002d_002d-A-Short-Example">Installation --- A Short Example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-Goes-Public">What Goes Public</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.2.2 Namespaces and <code>#include</code></h4>

<p><a name="index-namespaces_002c-and-_0040code_007b_0023include_007d-153"></a><a name="index-guessing_002c-installation-directories-from-namespaces-154"></a>In C and C++, one often has the problem that certain symbols in one
module conflict with symbols in modules of fellow developers. People
end up adding prefixes to their symbol names to make them unique,
which works but makes typing the names rather annoying. To help with
this, C++ namespaces were invented. You put all the names which would
otherwise have a common prefix into a namespace with that name
instead. This way you only need to keep namespace names unique which
is much easier.

   <p>A similar problem arises when all developers install their header
files to a common location. People have to keep header file names
unique, much like they have to keep symbol names unique in C.

   <p>While the former problem can be solved using namespaces, the latter
problem lacks a standard solution. Confix tries to solve it by
installing header files into <em>subdirectories of</em> that common
location. These subdirectories are determined from namespaces that
occur in the file. For example, if a file <samp><span class="file">public.h</span></samp> contains the
following,

<pre class="example">     namespace MyOwnCode {
     namespace MyLibrary {
     
     // ...
     
     } // /namespace
     } // /namespace
</pre>
   <p>then Confix guesses that the file should be installed as
<samp><span class="file">MyOwnCode/MyLibrary/public.h</span></samp>. <em>Note</em> the terminating
comments which are vital to Confix as it is not a C++ parser. Other
modules will have to include this file with <code>#include
&lt;MyOwnCode/MyLibrary/public.h&gt;</code>. <em>Note</em> that files in the same
directory still must include it with <code>#include "public.h"</code>
because at this time the file is not yet installed.

<div class="node">
<p><hr>
<a name="Installation-----A-Short-Example"></a>
<a name="Installation-_002d_002d_002d-A-Short-Example"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Restrictions">Restrictions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Namespaces">Namespaces</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.2.3 Installation &mdash; A Short Example</h4>

<p>Here's a little example that demonstrates the issues outlined
above. The package contains a module <code>my_library</code> which builds a
library. The library's interface is inside the C++ namespace
<code>MyLibrary</code> which is itself inside a namespace <code>MyOwnCode</code>,
and it is defined in a public header file <samp><span class="file">public.h</span></samp>. During the
build process of the module a second header file <samp><span class="file">_private.h</span></samp> is
used, but this header file is not part of the interface and thus must
not be installed.

   <p>The source tree layout is as follows.

<pre class="example">     &lt;packageroot&gt;
     `-- my_library
         |-- Makefile.py
         |-- _private.h
         |-- impl.cc
         `-- public.h
</pre>
   <p>The content of <samp><span class="file">public.h</span></samp> is (note the <code>/namespace</code> marker)

<pre class="example">     #ifndef my_library_public_h
     #define my_library_public_h
     
     namespace MyOwnCode {
     namespace MyLibrary {
     
     // whatever interface definition
     
     } // /namespace
     } // /namespace
     
     #endif
</pre>
   <p>After bootstrapping, configuring, and installing the package, the
<samp><span class="file">$(prefix)</span></samp> directory looks as follows,

<pre class="example">     $(prefix)
     |-- include
     |   `-- MyOwnCode
     |       `-- MyLibrary
     |           `-- public.h
     |-- lib
     |   `-- lib&lt;packageroot&gt;_my_library.a
     `-- repo
         `-- &lt;packageroot&gt;_my_library.py
</pre>
   <p>Note how the library interface <samp><span class="file">public.h</span></samp> has been installed in a
hierarchy <samp><span class="file">MyOwnCode/MyLibrary</span></samp> under the include directory. The
directory hierachy an exact mirror of the namespace hierarchy which is
defined in the module. Foreign code (and other modules from the same
package) that uses our library generally pulls in the definitions like
this

<pre class="example">     #include &lt;MyOwnCode/MyLibrary/public.h&gt;
</pre>
   <div class="node">
<p><hr>
<a name="Restrictions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation-_002d_002d_002d-A-Short-Example">Installation --- A Short Example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.2.4 Restrictions</h4>

<p><a name="index-restriction_002c-namespace-155"></a>One important restriction is imposed through this (and through the way
Automake lets the maintainer hook into the build process): <strong>you
can have only one namespace per directory</strong>.

   <p>Why is this? Say you have a second interface definition for the
library, in a file <samp><span class="file">public2.h</span></samp> in the same directory, which looks
as follows.

<pre class="example">     #ifndef my_library_public2_h
     #define my_library_public2_h
     
     #include "public.h"
     
     namespace MyOwnCode {
     namespace MyLibrarySecond {
     
     // second interface definition
     
     } // /namespace
     } // /namespace
     
     #endif
</pre>
   <p>This file includes <samp><span class="file">public.h</span></samp>. As that file is in the same
directory as <samp><span class="file">public2.h</span></samp>, <samp><span class="file">public2.h</span></samp> includes
<samp><span class="file">public.h</span></samp> like <code>#include "public.h"</code>. However, due to the
different namespace hierarchies, the installed incarnation of the
interface definitions is spread into two directories, like

<pre class="example">     $(prefix)
     `-- include
         `-- MyOwnCode
             |-- MyLibrary
             |   `-- public.h
             `-- MyLibrarySecond
                 `-- public2.h
</pre>
   <p>Now, consider user code that says,

<pre class="example">     #include &lt;MyOwnCode/MyLibrarySecond/public2.h&gt;
</pre>
   <p>This code will get a compilation error. The C preprocessor will
complain about the <code>#include "public.h"</code> in <samp><span class="file">public2.h</span></samp>
which cannot be found. The include path generally only points in
<samp><span class="file">$(prefix)/include</span></samp>, and never in any subdirectories
thereof. Hence, what works during compilation of the package, where
<samp><span class="file">public.h</span></samp> and <samp><span class="file">public2.h</span></samp> are in the same directory (even
with different namespaces), will cease to work for the installed case.

   <p><a name="index-INSTALLDIR_005fH-156"></a>This restriction is not that stringent though. If for some reason you
are forced to have different namespaces in files that are in the same
directory, you can always disable the offending automatism. Edit the
<samp><span class="file">Makefile.py</span></samp> in that directory, and specify the installation
location for all headerfiles in that directory. Say you want both
<samp><span class="file">public.h</span></samp> and <samp><span class="file">public2.h</span></samp> installed into the directory
<samp><span class="file">MyOwnCode/MyLibrary</span></samp>, then you add the following to
<samp><span class="file">Makefile.py</span></samp>.

<pre class="example">     INSTALLDIR_H('MyOwnCode/MyLibrary')
</pre>
   <div class="node">
<p><hr>
<a name="Build-Order-----How-Things-Can-Easily-Go-Wrong"></a>
<a name="Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.3 Build Order &mdash; How Things Can Easily Go Wrong</h3>

<p><a name="index-build-order-157"></a><a name="index-order_002c-of-build-158"></a>Confix uses requires and provides to match modules against each other,
and to compute a correct build order. Now what is a correct build
order? A formal definition could be, for example, &ldquo;If module A
depends on module B, then module B <em>must not use any bit</em> of
module A&rdquo;.

   <p>This may seem trivial, but if you think of it more deeply, you'd come
to the question, &ldquo;Why shouldn't module B <code>#include</code> header files
from module A? They are present all the time, even if module A is not
yet built.&rdquo;. The latter is not quite true. Remember that we said
above that even modules within the same package must include another
module's include files as if they were foreign code. They have to
apply the full namespace-to-include-directory mapping, simply because
they must compile even after they have been installed (see the example
above, where <samp><span class="file">public.h</span></samp> was included from another public header
file, <samp><span class="file">public2.h</span></samp>). In the local case, however, this hierarchy is
not present, and big tricks are applied by Confix to to make that
constellation compile happily. These tricks are outside the scope of
this manual<a rel="footnote" href="#fn-20" name="fnd-20"><sup>20</sup></a>,
suffice it to say that <em>the include files are not present all the
time for all modules in a package</em>. Rather, a module has to be built
before its header files can be correctly included.

   <p><a name="index-restriction_002c-build-order-159"></a><a name="index-build-order_002c-restriction-160"></a>What follows is the restriction as stated above: <strong>If module A
depends on module B, then module B must not use any bit of module A</strong>.

<div class="node">
<p><hr>
<a name="Explicitly-Adding-Checks"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Performing-Automatic-Tests">Performing Automatic Tests</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.4 Explicitly Adding Checks (and Programming with Them)</h3>

<p><a name="index-Autoconf-checks-161"></a><a name="index-checks_002c-Autoconf-162"></a><a name="index-checks_002c-programming-with-163"></a>With stock Autoconf, you normally list checks in
<samp><span class="file">configure.in</span></samp>. For example, if your code were using C++ string
streams, you'd run into problems getting it to compile with both a
pre-standard and a standard C++ compiler. To get around this, you'd
have to use conditional code. The Autoconf way for this is to check
for availability of one or the other, and to define the neessary
preprocessor macro accordingly. In our case, the check is is
<code>AC_CXX_HAVE_SSTREAM</code> (from the Autoconf macro archive which you
get with Confix), and the macro it defines is <code>HAVE_SSTREAM</code>.

   <p>With stock Autoconf, you'd write the check in <code>configure.in</code>,

<pre class="example">     ...
     AC_CXX_HAVE_SSTREAM
     ...
</pre>
   <p>Then, in the code, you react on what the check determined for you. In
particular, <code>AC_CXX_HAVE_SSTREAM</code> sets the HAVE_SSTREAM macro to
<code>1</code> if the standard C++ header file <samp><span class="file">&lt;sstream&gt;</span></samp> is available
and defines <code>std::stringstream</code>, else the macro is left
undefined. Your code looks as follows<a rel="footnote" href="#fn-21" name="fnd-21"><sup>21</sup></a>,

<pre class="example">     #ifdef HAVE_CONFIG_H
     # include &lt;config.h&gt;
     #endif
     
     #ifdef HAVE_SSTREAM
     # include &lt;sstream&gt;
     #else
     # include &lt;strstream.h&gt;
     #endif
</pre>
   <p><a name="index-checks_002c-and-Confix-164"></a>One problem with this approach is that the check is placed in
<samp><span class="file">configure.in</span></samp>, whereas the results of the check (in this case,
the <code>HAVE_SSTREAM</code> macro) are used in the various source files of
the package. You do not automatically correlate between these
locations. For example, if you change the source to not check
<code>HAVE_SSTREAM</code> for some reason (e.g., you do not use
<code>stringstream</code> anymore), you might want to consider removing the
check from <samp><span class="file">configure.in</span></samp>. However, you cannot be sure that no
other source file in the package uses <code>HAVE_SSTREAM</code>, so you have
to grep over the package source to be sure. Or the other way around:
you remove your usage of <code>HAVE_SSTREAM</code> and don't care about the
check. The result is a bloated <samp><span class="file">configure.in</span></samp> file with lots of
unnecessary checks, slowing down the build process.

   <p>The Confix approach, as always, is to determine from the source what
checks have to be applied. However, it cannot, for example, guess from
your usage of <code>HAVE_SSTREAM</code> that it must apply the check
<code>AC_CXX_HAVE_SSTREAM</code> &mdash; this is, well, impossible. Confix
simply cannot know that <code>HAVE_SSTREAM</code> is the result of the check
<code>AC_CXX_HAVE_SSTREAM</code><a rel="footnote" href="#fn-22" name="fnd-22"><sup>22</sup></a>. The maintainer must direct
Confix to apply the right check. This is ok because the maintainer
usually knows about the effects of checks.

   <p>So, with Confix, you write code similar to above, but with one comment
line more.

<pre class="example">     #ifdef HAVE_CONFIG_H
     # include &lt;config.h&gt;
     #endif
     
     // CONFIX:CHECK(AC_CXX_HAVE_SSTREAM())
     #ifdef HAVE_SSTREAM
     # include &lt;sstream&gt;
     #else
     # include &lt;strstream.h&gt;
     #endif
</pre>
   <p><a name="index-interface_002c-_0040emph_007bbuildable_007d-165"></a><a name="index-g_t_0040emph_007bbuildable_007d-interface-166"></a>Note the comment line: it starts with <code>CONFIX:</code>, followed by an
instruction which adds the check <code>AC_CXX_HAVE_SSTREAM</code> to the
containing package<a rel="footnote" href="#fn-23" name="fnd-23"><sup>23</sup></a>. Remember how we saw in
<a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks &mdash; The Autoconf Way of Portability</a> that Confix takes
care of the check's correct placement in <samp><span class="file">configure.in</span></samp>, and of
its uniqueness there.

   <p><a name="index-checks_002c-and-source-code-167"></a><a name="index-source-code_002c-and-checks-168"></a>So much for adding checks in the source code. Generally, these comment
things are the <em>interface</em> to the buildable objects which
resemble the respective source file. The part of the comment line
which reads &ldquo;<code>CHECK(AC_CXX_HAVE_SSTREAM())</code>&rdquo; is actually
nothing but Python code which calls a function <code>CHECK()</code> which is
defined as part of that interface, and which expects a check object as
a parameter. The &ldquo;<code>CONFIX:</code>&rdquo; prefix is C++ specific and marks
occurences of such interface utilization. See <a href="#The-Buildable-Interface">The Buildable Interface</a> for a detailed description of the interface and a list of
what else you can write in source files.

<div class="node">
<p><hr>
<a name="Performing-Automatic-Tests"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.5 Performing Automatic Tests</h3>

<p><a name="index-testing_002c-with-Confix-169"></a><a name="index-automatic-testing_002c-with-Confix-170"></a>Automake provides support for automatically testing your code. All you
have to do is to write test programs (of arbitrary complexity) which
take no arguments, and which return a zero exit status on success and
non-zero exit status on failure. Confix recognizes test programs by
their filename prefix: you prefix the files containing the
<code>main()</code> routine with <samp><span class="file">_check</span></samp>.

   <p>Once you have bootstrapped, configured and built your package, you run
the test suite by simply saying,

<pre class="example">     $ pwd
     /home/jfasch/tmp/build/wx-utils
     $ make check
</pre>
   <p>or, as we all know,

<pre class="example">     $ confix.py --packageroot=/home/jfasch/work/wx-utils \
                 --make --targets=check
</pre>
   <p>When the tests are finished, a statistic is given about the number of
tests passed and tests failed.

   <p>The <samp><span class="file">wx-utils</span></samp> package contains a growing number of self-tests, they
are part of the <samp><span class="file">check</span></samp> module<a rel="footnote" href="#fn-24" name="fnd-24"><sup>24</sup></a>.

<div class="node">
<p><hr>
<a name="Using-Third-Party-Libraries"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Performing-Automatic-Tests">Performing Automatic Tests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.6 Using Third Party Libraries</h3>

<p><a name="index-third-party-libraries-171"></a><a name="index-libraries_002c-third-party-172"></a><a name="index-external-libraries-173"></a><a name="index-libraries_002c-external-174"></a><a name="index-module-description-file-175"></a><a name="index-description-file_002c-module-176"></a><a name="index-repository_002c-of-module-description-files-177"></a>So far we have only talked about instrumenting source code packages
with Confix. We have heard about the module description repository and
its role in building relationships between the packages that are
maintained with Confix. This is fine if all of the software in a
project is built using Confix. While this would be nice, it is not
quite realistic. For example, you would not easily convince the
maintainers of the GNU Readline library to convert their build to
Confix<a rel="footnote" href="#fn-25" name="fnd-25"><sup>25</sup></a>.

   <p>We heard that the module description repository contains information
about every module that was built (and installed) using Confix. This
information consists of things like

     <ul>
<li>Provides and requires: these are the basic building blocks of module
dependencies. We have learned about them already.

     <li>Checks: a collection of Autoconf checks that were performed when the
respective module was built. As we heard in <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository &mdash; Inter-Package Knowledge Transfer</a>, any module that uses another module
should perform the checks of that module, and this is what the module
description repository ensures.

     <li>Instructions on how the module will participate in the build process
of a module that uses it. For example, if the module is a C/C++
library, then it will have to appear on the link line of the using
module at a certain position. Confix does this by calculating the
dependencies and sorting the modules accordingly, thereby getting a
correct link line.

   </ul>

   <p>Note that the module description does not contain build instructions
itself &mdash; these are only of interest while building the modules of a
package. In the end, we do not need anything more than the three items
listed above to hook a third party library into one package's
dependency graph and build process.

   <p><a name="index-provide-178"></a>For Confix, an external module behaves exactly like a &ldquo;native&rdquo;
module that has been built by Confix &mdash; it's just that a bit of
handwork is necessary in that you'll have to write a few lines in the
module's <samp><span class="file">Makefile.py</span></samp>. As opposed to a native module, you have
to at least manually <em>provide</em> the module somehow. Else the
module will not get a chance to get into the dependency graph, and
thus it will not contribute to the link line or the include path of
other modules. Remember, a module provides itself through
<em>provide</em> objects which you manually add to the module. The
remainder of this section consists of examples, accompanied with
explanations of what's going on.

<ul class="menu">
<li><a accesskey="1" href="#A-Simple-External-Module">A Simple External Module</a>
<li><a accesskey="2" href="#A-More-Complicated-External-Module">A More Complicated External Module</a>
</ul>

<div class="node">
<p><hr>
<a name="A-Simple-External-Module"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#A-More-Complicated-External-Module">A More Complicated External Module</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.6.1 A Simple External Module</h4>

<p>With stock Autoconf, you'll link in the Unix <em>crypt</em> library like
so,

<pre class="example">     AC_CHECK_LIB(crypt,crypt)
</pre>
   <p>The M4 macro <code>AC_CHECK_LIB</code> will check if passing <code>-lcrypt</code>
on a program's link line will make the <code>crypt()</code> function
available, and add <code>-lcrypt</code> to the link line of the programs
that are built in the respective package. Furthermore, it will define
the C preprocessor macro <code>HAVE_LIBCRYPT</code> if <code>crypt()</code> is
available.

   <p>Without Confix it is the package maintainer's responsibility to place
<code>AC_CHECK_LIB</code> in <samp><span class="file">configure.in</span></samp>. The Confix way is to
provide a &ldquo;library&rdquo; of external modules that provide appropriate
external module definitions. User code then refers to modules from
that library by &mdash; either implicitly or explicitly &mdash;
<em>requiring</em> them.

   <p>The <samp><span class="file">wx-utils</span></samp> package that accompanies Confix contains an external
module definition for the <code>crypt</code> library in the subdirectory
<samp><span class="file">ext-crypt</span></samp>. A native module, in the <samp><span class="file">crypt</span></samp> subdirectory of
that package contains a small C++ wrapper around the <code>crypt()</code>
function. The advantage of this constellation is that the native
module can serve as an automatic entry point into the external
library. The native module <em>provides</em> a header file which is
included (<em>required</em>) by other modules, with Confix taking care
of the dependencies automatically. The native module, in the
subdirectory <samp><span class="file">crypt</span></samp>, manually requires the external module.

   <p>But first, let's see how the external module is defined in
<samp><span class="file">ext-crypt/Makefile.py</span></samp>.

   <p><a name="index-provide-object_002c-symbolic-179"></a><a name="index-symbolic-provide-object-180"></a><a name="index-PROVIDE_005fSYMBOL-181"></a>
<pre class="example">     PROVIDE_SYMBOL(symbol='crypt')
     
     CONFIGURE_IN(
         lines=['AC_CHECK_LIB(crypt,crypt)'],
         order=AC_LIBRARIES)
</pre>
   <p>The first line adds a <em>provide</em> object to the module. So far we
have only seen header files that act as provide objects. However the
<code>crypt</code> library has no header file of its own that declares the
<code>crypt()</code> function. Rather, <code>crypt()</code> is declared in the
standard C library header file <code>unistd.h</code> which declares zillions
of other symbols as well, and which is likely to be required by code
that does not want to make use of <code>crypt()</code>. So we have to use an
artificial provide object to announce our <samp><span class="file">ext-crypt</span></samp> module. The
drawback to this is that we must also <em>require</em> it artificially,
which is what we do in the native <code>crypt</code> module<a rel="footnote" href="#fn-26" name="fnd-26"><sup>26</sup></a>.

   <p><a name="index-CONFIGURE_005fIN-182"></a>The call to <code>CONFIGURE_IN()</code> adds our <code>AC_CHECK_LIB</code> macro
invocation to <samp><span class="file">configure.in</span></samp>. See <a href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a> for an explanation of the parameters.

   <p><a name="index-require-object_002c-symbolic-183"></a><a name="index-symbolic-require-object-184"></a>Now how's that module being used? The native module, <code>crypt</code>,
that we've been talking about, has to reference it somehow. Normally
this is done implicitly by <code>#include</code>ing a header file. However,
we have no header file to include, so we have to manually require the
external module. This is easiest done in source file,
<samp><span class="file">crypt/crypt.cc</span></samp>, using the <code>REQUIRE_SYMBOL()</code> from <a href="#The-Buildable-Interface">The Buildable Interface</a>, like so,

<pre class="example">     // CONFIX:REQUIRE_SYMBOL('crypt')
</pre>
   <p>That symbolic <em>require</em> object added to the <code>crypt</code> module
will match the symbolic <em>provide</em> object we have used to announce
the external <samp><span class="file">ext-crypt</span></samp> module, and thus introduce an edge in
the dependency graph. Every module that has a source file with the
line <code>#include &lt;WX/Utils/crypt.h&gt;</code> (this is what the native
<code>crypt</code> module provides) will link in the <code>crypt</code>
module. That module has a (symbolic) dependency on <code>ext-crypt</code>,
which leads to <code>ext-crypt</code> (the Unix <code>crypt</code> library) to be
linked in as well.

   <p>But that's nothing special to external modules, that's how Confix
works. What's new here is that we've manually added provide ad require
objects, and that we have added Autoconf code.

   <p>In your C/C++ code you should react on the outcome of the check, of
course. This is nothing special to Confix, it applies to all coders
who manage their packages with Autoconf. In our case, the
<code>crypt()</code> function may or may not be
available. <code>AC_CHECK_LIB</code> defines the preprocessor macro
<code>HAVE_LIBCRYPT</code> if it is available, else the macro is
undefined. The code will look about like this (see
<samp><span class="file">crypt/crypt.cc</span></samp> for the complete code),

<pre class="example">     #ifdef HAVE_CONFIG_H
     #  include &lt;config.h&gt;
     #endif
     
     std::string
     Crypt::crypt(
        const std::string&amp; key,
        const std::string&amp; salt)
     {
     #ifdef HAVE_LIBCRYPT
        return ::crypt(key.c_str(), salt.c_str());
     #else
        THROW_ERROR_MSG(Error, "crypt(3) not available (HAVE_LIBCRYPT not defined)");
     #endif
     }
</pre>
   <div class="node">
<p><hr>
<a name="A-More-Complicated-External-Module"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#A-Simple-External-Module">A Simple External Module</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.6.2 A More Complicated External Module</h4>

<p><a name="index-Python-185"></a>Not all third party code is as easy to integrate as the <em>crypt</em>
library. If you want to, for example, embed the Python interpreter,
you'd have to set the include and library path to somewhere inside the
Python installation directory. Furthermore, you'd have to find out
which libraries you have to link in order to get the necessary symbols
defined, and then add these libraries to your link lines, at the
correct position.

   <p>The <samp><span class="file">wx-utils</span></samp> package contains a module, <samp><span class="file">ext-python</span></samp>, which
has all necessary magic for you to use the Python interpreter
library. There is also a simple test program available,
<samp><span class="file">check/_check_python.cc</span></samp>, which demonstrates &mdash; quite
rudimentarily though &mdash; usage of the Python interpreter.

   <p>Before we dissect <samp><span class="file">ext-python/Makefile.py</span></samp>, let's do a little
background first. Confix's main task in generating build instructions
is to get link lines and include paths right. For this, it builds a
dependency graph of modules, and then topologically sorts the
graph. The outcome is a list of modules from which Confix computes
link lines and include paths.

   <p>To participate in the build of another module, a module must
contribute certain things such as the base names of the libraries it
offers, or the include path which has to be set. For example, the
<samp><span class="file">error</span></samp> module of the <samp><span class="file">wx-utils</span></samp> package offers the library
<samp><span class="file">libwx-utils_error.a</span></samp> (or similar, the actual name depends on the
operating system, and Libtool usage). If an executable depends on that
module, then <code>-lwx-utils_error</code> &mdash; the library's base name,
prepended with <code>-l</code> &mdash; will have to appear on the linker
commandline that builds that executable, on the correct position.

   <p><a name="index-checks_002c-Autoconf-186"></a><a name="index-Autoconf-checks-187"></a><a name="index-Autoconf_002c-and-third-party-code-188"></a>Normally, when you build all of your source code with Confix, you
don't have to care about all this. Anyway, this is what's going on
under the hood, and you have to know this when you are going to write
Autoconf code to glue together third party software with your own
code. Basically, what has to be done is always the same,

     <ul>
<li>Find out where the header files are that users of the third party
software include. You then pass it to the compiler. Take as a concrete
example our usage of the Python interpreter. If the Python
installation prefix was <samp><span class="file">/usr/local/Python-2.1.3</span></samp>, then you'd
have to pass <code>-I/usr/local/Python-2.1.3/include</code> to the compiler.

     <li>Find out what libraries you have to link executables with, and where
they are. With our Python example, the base names of the libraries are
<samp><span class="file">python2.1</span></samp> (for Python itself), <samp><span class="file">pthread</span></samp> (because the
interpreter happens to have been built with multithreading support
switched on), <samp><span class="file">dl</span></samp> (the dynamic loader; Python uses to
<code>dlopen()</code> its C modules), and <samp><span class="file">util</span></samp> (whatever that is, I
found it in <samp><span class="file">/usr/lib</span></samp> on my Linux system). <samp><span class="file">libpython2.1.a</span></samp>
is in <samp><span class="file">/usr/local/Python-2.1.3/lib/python2.1/config</span></samp>, the rest is
in standard library directories which we don't have to care
about. With this, you'd have to pass
<code>-L/usr/local/Python-2.1.3/lib/python2.1/config -lpython2.1
-lpthread -ldl -lutil</code> to the linker.

   </ul>

   <p>This is what Autoconf is all about: finding out things. And this is
what most of the <samp><span class="file">ext-python/Makefile.py</span></samp> is all about: define
Autoconf checks that have to be performed by every package that uses
<samp><span class="file">ext-python</span></samp>.

   <p>At this point, you'll probably begin to suspect that you have to
become an Autoconf expert if you want to add third party software to
your projects. That's only halfway true. You sure have to have a basic
understanding of how Autoconf and Automake <em>work</em>, and sure it's
helpful to be able to grasp how the macros that you use
work<a rel="footnote" href="#fn-27" name="fnd-27"><sup>27</sup></a>. Probably you will
get into the situation where you really have to write Autoconf code
yourself. But most of the time you will find yourself googling and
copying the pieces you found, just as I did with the Python stuff. But
anyway, I recommend reading the manuals and/or the
<a href="http://sources.redhat.com/autobook/">Autobook</a>; it's an
experience.

   <p><a name="index-EXTERNAL_005fLIBRARY2-189"></a>Now that we found out the pieces which are necessary to use the Python
interpreter library, we have to hook these things into Confix. In our
case, the external module contributes link line fragments and include
directories to the rest of the world. For this, you use the
<code>EXTERNAL_LIBRARY2()</code> function of <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>. But let's dive into <samp><span class="file">ext-python/Makefile.py</span></samp>
now. We'll examine it piece by piece, commenting it as we go.

<pre class="example">     PROVIDE_H('Python.h')
</pre>
   <p><a name="index-PROVIDE_005fH-190"></a>Ah yes, I forgot to mention that we have to offer the module to
Confix's dependency resolution machinery somehow. Here we add a
provide object to our module, so that our module will be required by
every module where <code>#include &lt;Python.h&gt;</code> appears in one of its
source files.

   <p>Next, we define a few strings which contain Autoconf code, and which
we will add to the module later on. As you read this, you will
probably see the <code>r</code> in front of the string constants. This is
short for <em>raw</em>, and it keeps Python<a rel="footnote" href="#fn-28" name="fnd-28"><sup>28</sup></a> from collapsing backslashes in the strings.

<pre class="example">     python_check = "AM_PATH_PYTHON"
</pre>
   <p><a name="index-AM_005fPATH_005fPYTHON-191"></a><code>AM_PATH_PYTHON</code> is a macro that comes with Automake. It checks
for availability of the Python interpreter executable. If the
interpreter is found, certain shell variables will be set, such as
<code>$PYTHON</code> (the name of the Python executable),
<code>$PYTHON_VERSION</code>, and so on. The remainder of our checks will
use some of these variables.

<pre class="example">     header_check = r"""
     AC_MSG_CHECKING(for headers required to compile python extensions)
     dnl deduce PYTHON_INCLUDES
     py_prefix=`$PYTHON -c "import sys; print sys.prefix"`
     py_exec_prefix=`$PYTHON -c "import sys; print sys.exec_prefix"`
     PYTHON_INCLUDES="-I${py_prefix}/include/python${PYTHON_VERSION}"
     if test "$py_prefix" != "$py_exec_prefix"; then
       PYTHON_INCLUDES="$PYTHON_INCLUDES -I${py_exec_prefix}/include/python${PYTHON_VERSION}"
     fi
     AC_SUBST(PYTHON_INCLUDES)
     dnl check if the headers exist:
     save_CPPFLAGS="$CPPFLAGS"
     CPPFLAGS="$CPPFLAGS $PYTHON_INCLUDES"
     AC_TRY_CPP([#include &lt;Python.h&gt;],dnl
     [AC_MSG_RESULT(found)],dnl
     [AC_MSG_RESULT(not found)
     PYTHON_INCLUDES=
     ])
     CPPFLAGS="$save_CPPFLAGS"
     """
</pre>
   <p><a name="index-AC_005fSUBST-192"></a>The above code fragment looks for Python's include directory. If one
is found, it sets the <code>$PYTHON_INCLUDES</code> variable, which is also
<code>AC_SUBST</code>'ed. We will explain below what this means, and why it
is important to us.

<pre class="example">     lib_check = r"""
     AC_MSG_CHECKING(for libpython${PYTHON_VERSION}.a)
     
     py_exec_prefix=`$PYTHON -c "import sys; print sys.exec_prefix"`
     
     py_makefile="${py_exec_prefix}/lib/python${PYTHON_VERSION}/config/Makefile"
     if test -f "$py_makefile"; then
     dnl extra required libs
       py_localmodlibs=`sed -n -e 's/^LOCALMODLIBS=\(.*\)/\1/p' $py_makefile`
       py_basemodlibs=`sed -n -e 's/^BASEMODLIBS=\(.*\)/\1/p' $py_makefile`
       py_other_libs=`sed -n -e 's/^LIBS=\(.*\)/\1/p' $py_makefile`
     
     dnl now the actual libpython
       if test -e "${py_exec_prefix}/lib/python${PYTHON_VERSION}/config/libpython${PYTHON_VERSION}.a"; then
         PYTHON_LIBS="-L${py_exec_prefix}/lib/python${PYTHON_VERSION}/config -lpython${PYTHON_VERSION} $py_localmodlibs $py_basemodlibs $py_other_libs"
         AC_MSG_RESULT(found)
       else
         AC_MSG_RESULT(not found)
       fi
     else
       AC_MSG_RESULT(not found)
     fi
     
     AC_SUBST(PYTHON_LIBS)
     """
</pre>
   <p>This does the same for the link line fragment we need. It sets and
<code>AC_SUBST</code>s the <code>$PYTHON_LIBS</code> shell variable. It is a bit
more complicated than the fragment that checks for the include
directory: it searches the <samp><span class="file">Makefile</span></samp> in Python's <samp><span class="file">config</span></samp>
directory for certain variables, and builds a list of libraries from
these. This is characteristic for this kind of checks &mdash; the check
implementor knows about the structure of the installed package, and
writes shell code that examines that structure.

<pre class="example">     macro = r"""
     if test -n "$PYTHON_LIBS" -a -n "$PYTHON_INCLUDES"; then
        AC_DEFINE(HAVE_PYTHON_LIB, 1, [We can use the Python library])
     fi
     """
</pre>
   <p>Here we see if anyone defined <code>$PYTHON_LIBS</code> and
<code>$PYTHON_INCLUDES</code>, and if so, define the C preprocessor macro
<code>HAVE_PYTHON_LIB</code>. This way user code can check at compile time
whether Python is available or not, and use it conditionally. See a
test program, <samp><span class="file">check/_check_python.cc</span></samp>, for a simple yet stupid
and meaningless usage.

   <p><a name="index-CONFIGURE_005fIN-193"></a><a name="index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-194"></a>Next, we call the <code>CONFIGURE_IN()</code> repeatedly to add these strings
to our enclosing module, as Autoconf fragments, in the appropriate
categories. This is, we add the check for the Python interpreter
executable in the category <code>AC_PROGRAMS</code>, the header check in
<code>AC_HEADERS</code>, the library check in <code>AC_LIBRARIES</code>, and the
macro definition <em>after</em> <code>AC_HEADERS</code> and
<code>AC_LIBRARIES</code>. These constants are integer values which are far
enough apart so that <code>max(AC_LIBRARIES,AC_HEADERS)+1</code> won't overlap
into the next category. See <a href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>
for more about the <code>CONFIGURE_IN()</code> function.

<pre class="example">     CONFIGURE_IN(
         lines=[python_check],
         order=AC_PROGRAMS)
     
     CONFIGURE_IN(
         lines=[header_check],
         order=AC_HEADERS)
     
     CONFIGURE_IN(
         lines=[lib_check],
         order=AC_LIBRARIES)
     
     CONFIGURE_IN(
         lines=[macro],
         order=max(AC_LIBRARIES,AC_HEADERS)+1)
</pre>
   <p><a name="index-EXTERNAL_005fLIBRARY2-195"></a>Now we have made sure that any module that declares (through
<code>#include &lt;Python.h&gt;</code>) to use the Python interpreter library
applies these checks. The last thing we have to do is to contribute to
that module's build. For this, we use another function,
<code>EXTERNAL_LIBRARY2()</code> from <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>.

<pre class="example">     EXTERNAL_LIBRARY2(
         inc='@PYTHON_INCLUDES@',
         lib='@PYTHON_LIBS@')
</pre>
   <p>With this, we contribute include paths (the <code>inc</code> parameter) to
the compiler command line, and a link line fragment (the <code>lib</code>
parameter) to the linker command line. According to the module
dependency graph that Confix calculates, these will be placed at the
right position.

   <p>What's interesting here is that we only contribute
<em>placeholders</em>, <code>@PYTHON_INCLUDES@</code> and
<code>@PYTHON_LIBS@</code>. That's the Autoconf way. We have the configure
script determine things &mdash; in our case, we apply shell and M4 code to
set or unset the shell variables <code>$PYTHON_INCLUDES</code> and
<code>$PYTHON_LIBS</code>. Then, we call the <code>AC_SUBST</code> macro with
these variables. This macro takes care to substitute all occurences of
the equally named placeholders with the values of these variables &mdash;
<em>at </em><code>configure</code><em> time</em>.

   <p>In the end, what Confix does is to generate a <samp><span class="file">Makefile.am</span></samp> only
with these placeholders at the compiler and linker command
lines. Additionally, checks are added that take care that the
placeholders will be filled in when the user calls
<code>configure</code>. That's exactly what an Automake or Autoconf user
would do: write the checks into the <samp><span class="file">configure.in</span></samp> in the package
root directory, and put the placeholders in the various locations
where they are needed. It's just that Confix gives you the possibility
to have the placeholders and the checks together in one place, without
having to keep them consistent among many files, and that Confix takes
care of their correct placement.

<div class="node">
<p><hr>
<a name="Restrictions-Imposed-on-the-Package-Structure"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Using-GNU-Libtool">Using GNU Libtool</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-Third-Party-Libraries">Using Third Party Libraries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.7 Restrictions Imposed on the Package Structure</h3>

<p><a name="index-structure_002c-of-the-package-196"></a><a name="index-package-structure_002c-restriction-197"></a><a name="index-restriction_002c-package-structure-198"></a><a name="index-package-depth-199"></a><a name="index-depth-first-traversal_002c-build-order-200"></a><a name="index-build-order_002c-and-depth-first-traversal-201"></a>As we saw in previous sections, with stock Autotools the maintainer
has to specify the build order in his package <em>by hand</em>. For a
package tree with multiple levels of depth, like this one,

<pre class="example">     packageroot/
     |-- mod1
     |   |-- mod1.1
     |   `-- mod1.2
     `-- mod2
         |-- mod2.1
         `-- mod2.2
</pre>
   <p>the maintainer may want specify a build order <samp><span class="file">mod1.1, mod1.2,
mod2.1, mod2.2</span></samp> in the <samp><span class="file">Makefile.am</span></samp> files as follows,

     <ul>
<li>In the toplevel <samp><span class="file">Makefile.am</span></samp>: <code>SUBDIRS = mod1 mod2</code>

     <li>In <samp><span class="file">mod1/Makefile.am</span></samp>: <code>SUBDIRS = mod1.1 mod1.2</code>

     <li>In <samp><span class="file">mod2/Makefile.am</span></samp>: <code>SUBDIRS = mod2.1 mod2.2</code>

   </ul>

   <p>In other words, the maintainer explicitly specifies a <em>depth
first traversal</em> through the package tree, thereby explicitly
specifying a <em>build order</em>.

   <p>As Confix automatically determines the build order, the maintainer
need not (must not, and cannot) influence the build order except
through his placement of <em>provides</em> and <em>requires</em>. With the
right (wrong) placement of <em>provides</em> and <em>requires</em> it
could easily happen that Confix calculates a build order about as
<samp><span class="file">mod1.1, mod2.1, mod1.2, mod2.2</span></samp> which is clearly no DFS
traversal. Confix would then generate a toplevel <samp><span class="file">Makefile.am</span></samp>
which contains

<pre class="example">     SUBDIRS = mod1/mod1.1 mod2/mod2.1 mod1/mod1.2 mod2/mod2.2
</pre>
   <p><a name="index-g_t_0040command_007bmake-dist_007d-202"></a>This is fine in principle. There are probably no problems while
building the package. It's just that <samp><span class="command">make dist</span></samp> and friends
(see <a href="#Distributing-the-Package">Distributing the Package</a>) will not work correctly when the
toplevel <samp><span class="file">Makefile.am</span></samp> spans more than one level of the package
hierarchy. Moreover, the Automake 1.7 documentation states that,

   <p>&ldquo;The directories mentioned in <code>SUBDIRS</code> must be direct children
of the current directory.  For instance, you cannot put
`<samp><span class="samp">src/subdir</span></samp>' into <code>SUBDIRS</code>.  Instead you should put
<code>SUBDIRS = subdir</code> into <samp><span class="file">src/Makefile.am</span></samp>.  Automake can be
used to construct packages of arbitrary depth this way.&rdquo;

   <p>So, now's the time to put another burden on the Confix user:
<strong>Packages must have flat hierarchies of only one level deep.</strong>
In other words, the above package must be restructured to

<pre class="example">     packageroot/
     |-- mod1.1
     |-- mod1.2
     |-- mod2.1
     `-- mod2.2
</pre>
   <div class="node">
<p><hr>
<a name="Using-GNU-Libtool"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Summary-of-Rules-and-Restrictions">Summary of Rules and Restrictions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.8 Using GNU Libtool</h3>

<p><a name="index-Libtool-203"></a><a name="index-shared-library_002c-and-Libtool-204"></a>Confix provides optional support for GNU Libtool. That is, the
maintainer has to decide whether he wants to use Libtool to build the
package's libraries or not. See <a href="#Options-and-Parameters">Options and Parameters</a> for the
<samp><span class="option">--use-libtool</span></samp> option, and <a href="#The-Configuration-File">The Configuration File</a> for
the corresponding variable in the configuration file.

   <p>GNU Libtool is used to build shared libraries in a portable manner. It
introduces an abstraction layer, the <em>libtool archive</em>, to hide
the differences between shared and static libraries. When it cannot
build shared libraries on a certain operating system or architecture,
it builds static libraries only, and everything continues to
work<a rel="footnote" href="#fn-29" name="fnd-29"><sup>29</sup></a>. It also adds a few
commandline options to the <code>configure</code> script; for example, you
may specify <samp><span class="option">--disable-shared</span></samp> suppress building of shared
libraries and to only build static libraries. See
<a href="http://www.gnu.org/software/libtool/manual.html">the Libtool manual</a> if you want to know more. The remainder of this section is
about Libtool usage with Confix.

   <p><a name="index-C_002b_002b_002c-and-Libtool-205"></a>Historically, shared library implementations on the various operating
systems have been working with C for a long time. A major challenge is
building shared libraries (let alone running programs with them) with
C++. Several features of C++ do not work right out of the box with
shared libraries. For example, global initializers must be run when
the library is loaded - a task which has been mastered by Libtool in
the meantime<a rel="footnote" href="#fn-30" name="fnd-30"><sup>30</sup></a>.

   <p>In short, Libtool is now (as of version 1.5) in the shape to generate
C++ shared libraries correctly. As long as certain preconditions are
met. One precondition is that all code is compiled with the same
compiler<a rel="footnote" href="#fn-31" name="fnd-31"><sup>31</sup></a>.

   <p>Another, more serious, restriction is exception handling. When an
exception is thrown by a function, all stack frames have to be unwound
(destructors have to be called) up to the point where the exception is
caught. This means that the C++ compiler has to generate code for
every stack frame that registers the frame with a common &mdash; global
&mdash; data structure, a list of active stack frames. The exception
handling code, also generated by the compiler, then traverses that
list and unwinds the stack.

   <p><a name="index-C_002b_002b_002c-GCC_002c-and-Libtool-206"></a>The problem here is that certain compilers have problems with making
that global list truly global. (I'm going to outline the problem for
GCC under Linux, as I don't yet have experiences with other
combinations. As I gain experience, I'll write it down here. I'm also
glad to receive contributions.)

   <p>When you have several shared libraries that work together inside a
program, then only one of them should own the stack frame list. Else,
when the libraries are loaded, confusion occurs if more or all of the
libraries have that symbol, and the results are funny when an
exception is actually thrown. Usually, the symptom is that the
exception cannot cross the boundary between two shared
libraries<a rel="footnote" href="#fn-32" name="fnd-32"><sup>32</sup></a>. The solution is to put the frame list in a single shared
library, and to have the others only depend on that library.

   <p>GCC has always put it support routines and data structures in a single
support library. Unfortunately, before version 3 of GCC, this library
was a static library, <samp><span class="file">libgcc.a</span></samp>. Even more unfortunately, GCC
built shared libraries in a way that attached the code in
<samp><span class="file">libgcc.a</span></samp> to it. The outcome was the scenario explained above:
multiple overriding definitions of the frame list.

   <p>GCC 3 does the right thing &mdash; <samp><span class="file">libgcc</span></samp> is a shared library. This
means that exception handling can work with GCC 3, and it really does
work. Unfortunately, most current Linux distributions come with a GCC
that is far from version 3<a rel="footnote" href="#fn-33" name="fnd-33"><sup>33</sup></a> (today is September 19, 2003), so you probably have to compile
your own compiler. How to do this is out of the scope of Confix;
suffice it to give a few hints and warns.

     <ul>
<li>Do not install your custom compiler in a place where it could conflict
with the compiler that comes with the system. Certain activities
require the system's compiler to work as expected by the distributor;
kernel compilation is an example.

     <p>Pass the <samp><span class="option">--prefix</span></samp> option to GCC's configure script to install
your own GCC in a different location.

     <li>You need to tell the dynamic loader where GCC's shared libraries can
be found. Under Linux, you do this by adding GCC's library directory,
<samp><em>prefix</em><span class="file">/lib</span></samp>, to <samp><span class="file">/etc/ld.so.conf</span></samp>, and then calling
<samp><span class="command">ldconfig</span></samp>.

   </ul>

   <p>Confix does not do really much to build shared libraries. All it does
is try to generate correct input for Automake and Libtool, and we even
managed to build shared libraries that can be <code>dlopen()</code>'ed
without problems, at least under Linux. However, despite its
untestedness on other systems, this is how it's supposed to work, and
everything else is either a bug or has to be documented
explicitly. Dear reader, please be kind and give input.

<ul class="menu">
<li><a accesskey="1" href="#Objections-Against-Shared-Libraries">Objections Against Shared Libraries </a>
</ul>

<div class="node">
<p><hr>
<a name="Objections-Against-Shared-Libraries"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-GNU-Libtool">Using GNU Libtool</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Using-GNU-Libtool">Using GNU Libtool</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h4 class="subsection">4.8.1 Objections Against Shared Libraries</h4>

<p>Shared libraries are a great feature of modern operating
systems<a rel="footnote" href="#fn-34" name="fnd-34"><sup>34</sup></a>. They
dramatically reduce the sizes of executables because common code is
kept externally. When two or more executables use the same shared
library, only one instance of the code has to be physically present in
memory.

   <p>There is a big disadvantage however. Your executables are not self
contained anymore, but rather depend on external factors. Shared
libraries themselves are only the tip of the iceberg. Another
important factor is that there can be more than one version of a
shared library around. Changing the interface of a shared library
without changing its version will wreak havoc on all executables that
are linked against that library. Despite these difficulties, lots of
projects have managed to get it right &mdash; after all, it's mainly a
matter of discipline, and programmers tend to be disciplined if not
paranoid.

   <p>C++ is the final tidbit in this area. As described above, C++
compilers usually come with one or more shared libraries which contain
necessary data structures to ensure that certain C++ features work
correctly in the presence of shared linraries. While this is
desirable, it introduces one more dependency. You have to ensure that
the version of the installed compiler matches the version of the
compiler that you built your shared libraries with.

<div class="node">
<p><hr>
<a name="Summary-of-Rules-and-Restrictions"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Using-GNU-Libtool">Using GNU Libtool</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">4.9 Summary of Rules and Restrictions</h3>

<p>This chapter explained how Confix guesses build instructions from the
package's content, and what restrictions it imposes on the package
maintainer. The explanations have been a bit technical and lengthy,
however, so here's a short summary.

     <ul>
<li>In a module's directory, buildable files are determined by their
extensions. See <a href="#What-Will-Be-Built">What Will Be Built</a>.

     <li>Header files which begin with an underline are only visible to modules
inside the same package, during the build process. They are not
installed during <samp><span class="command">make install</span></samp>. All other header files are
installed. See <a href="#What-Goes-Public">What Goes Public</a>.

     <li>C++ header files which have a namespace declared, say <samp><span class="file">A/B</span></samp>, are
installed in a directory
<samp><span class="file">$(prefix)/include/A/B/headerfile.h</span></samp>. They should be included by
foreign code like <code>#include
&lt;A/B/headerfile.h&gt;</code>. See <a href="#Namespaces">Namespaces</a>.

     <p><strong>Restrictions:</strong> Within a module, you can only have either no
namespace, or you can have only one namespace. In other words, you
cannot have

          <ul>
<li>Files with no namespace and files with a namespace besides each other
in a module

          <li>Files with different namespaces besides each other in a module

     </ul>

     <li>As for module dependencies: If module A depends on module B, then
module B <em>must not use any bit</em> of module A. See <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order &mdash; How Things Can Easily Go Wrong</a>.

     <li>You can add Autoconf checks in the source code, right where you use
the results of that check. See <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>.

     <li>Your package's directory hierarchy must be flat &mdash; this is, every
directory which contains a module must be a direct descendant of the
package root. See <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a>.

   </ul>

<div class="node">
<p><hr>
<a name="The-Users-Role-in-the-Build-Process"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Options-and-Parameters">Options and Parameters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">5 The User's Role in the Build Process</h2>

<ul class="menu">
<li><a accesskey="1" href="#Optionally-Building-and-Using-Modules">Optionally Building and Using Modules</a>
</ul>

<div class="node">
<p><hr>
<a name="Optionally-Building-and-Using-Modules"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Users-Role-in-the-Build-Process">The Users Role in the Build Process</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#The-Users-Role-in-the-Build-Process">The Users Role in the Build Process</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="section">5.1 Optionally Building and Using Modules</h3>

<p>Blah &ndash;enable-..., &ndash;with-... (local modules and installed modules,
resp.)

   <p>Blah feature macros; references to the interface documentation
appendixes.

   <p>Examples using the <samp><span class="file">wx-utils</span></samp> package, plus one package that uses the <samp><span class="file">wx-utils</span></samp>
package. configure &ndash;help output.

<div class="node">
<p><hr>
<a name="Options-and-Parameters"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Users-Role-in-the-Build-Process">The Users Role in the Build Process</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix A Options and Parameters</h2>

<p><a name="index-commandline-arguments-207"></a><a name="index-action-names-208"></a>The Confix commandline is composed of <em>action names</em> and
<em>parameters</em>. Action names are used to tell Confix what to do;
for example, the key feature of Confix - instrumenting a source tree
by creating <samp><span class="file">configure.in</span></samp> and <samp><span class="file">Makefile.am</span></samp> - is specified
by the commandline argument <samp><span class="option">--output</span></samp>.

   <p><a name="index-action_002c-dependency-209"></a><a name="index-dependent-actions-210"></a><a name="index-g_t_0040option_007b_002d_002doutput_007d-211"></a><a name="index-g_t_0040option_007b_002d_002dbootstrap_007d-212"></a>Some actions implicitly invoke other actions. For example,
<samp><span class="option">--bootstrap</span></samp> invokes the <var>output</var> action although
<samp><span class="option">--output</span></samp> was not specified on the commandline. If the user does
specify these actions on the commandline, the ordering does not
matter. If you say, for example, <code>confix.py --bootstrap --output</code>,
this does not mean that the <var>output</var> action is performed twice - the
first time implicitly through <samp><span class="option">--bootstrap</span></samp>, and the second time
explicitly through <samp><span class="option">--output</span></samp>. Rather, the explicit
<samp><span class="option">--output</span></samp> takes no effect because it has already been performed.

   <p>Independent actions are performed in the order they are specified on
the commandline.

   <p>Some of the parameters are configurable in the configuration
file. This saves you from typing. See <a href="#The-Configuration-File">The Configuration File</a> for
more information.

<ul class="menu">
<li><a accesskey="1" href="#Actions">Actions</a>
<li><a accesskey="2" href="#Parameters">Parameters</a>
</ul>

<div class="node">
<p><hr>
<a name="Actions"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Parameters">Parameters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Options-and-Parameters">Options and Parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Options-and-Parameters">Options and Parameters</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">A.1 Actions</h3>

     <ul>
<li><samp><span class="option">--help</span></samp>
<a name="index-g_t_0040option_007b_002d_002dhelp_007d-213"></a>
Writes to stderr a more or less detailed list of available commandline
options. The list is less detailed than the list you are currently
starting to read, but should suffice as a quick reference.

     <li><samp><span class="option">--resolve</span></samp>
<a name="index-g_t_0040option_007b_002d_002dresolve_007d-214"></a>
<a name="index-provide-215"></a><a name="index-require-216"></a>Examine the package tree. Scan for files that have to be built and
installed. Determine <em>provides</em> and <em>requires</em>. Read the
module descriptions from the module description respository. Try to
resolve the package's <em>requires</em> against the <em>provides</em>
available from either

          <ul>
<li>The package's other modules (the subdirectories of the package root
which is just being scanned). Dependencies among the package's modules
influence their build order, by the way.

     </ul>

     <p>or from

          <ul>
<li><a name="index-repository_002c-of-module-descriptions-217"></a><a name="index-module-description-218"></a>The modules whose descriptions have been read from the module
description respository.

     </ul>

     <p>Parameters:

          <ul>
<li><a name="index-g_t_0040option_007b_002d_002dpackageroot_007d-219"></a><var>packageroot</var>

          <li><a name="index-g_t_0040option_007b_002d_002drepository_007d-220"></a><var>repository</var>: directory where the module descriptions are installed.

     </ul>

     <p>Examples:

          <ul>
<li>From anywhere you want (<samp><span class="option">--packageroot</span></samp> specifies the package)

          <pre class="example">               $ confix.py --resolve --packageroot=$HOME/work/wx-utils
               --repo=$HOME/wxpackages/repo
          </pre>
          <p>(<samp><span class="option">--repo</span></samp> specifies where to get module descriptions from)

          <li>Or equivalently, if the current working directory is
<samp><span class="file">$HOME/work/wx-utils</span></samp>,

          <pre class="example">               $ confix.py --resolve --repo=$HOME/wxpackages/repo
          </pre>
          <li>Or even more equivalently, because the default repository is
<code>$(prefix)/repo</code>,

          <pre class="example">               $ confix.py --resolve --prefix=$HOME/wxpackages
          </pre>
          </ul>

     <li><samp><span class="option">--output</span></samp>
<a name="index-g_t_0040option_007b_002d_002doutput_007d-221"></a>
Instrument a package. This involves scanning the package tree for files
that have to be built and installed, generating <samp><span class="file">configure.in</span></samp> and
<samp><span class="file">Makefile.am</span></samp> in the package root, and a <samp><span class="file">Makefile.am</span></samp> in
every module subdirectory of the package root which contains a
<samp><span class="file">Makefile.am</span></samp>.

     <p>Depends on:

          <ul>
<li><var>resolve</var>

     </ul>

     <p>Parameters:

          <ul>
<li><var>packageroot</var>, through the <var>resolve</var> action.

          <li><var>repository</var>, likewise.

          <li><var>prefix</var>, likewise.

     </ul>

     <p>Example:

          <ul>
<li>In the package root,
          <pre class="example">               $ confix.py --output --prefix=$HOME/wxpackages
          </pre>
          </ul>

     <li><samp><span class="option">--bootstrap</span></samp>
<a name="index-g_t_0040option_007b_002d_002dbootstrap_007d-222"></a>
Bootstraps a package. In Autoconf/Automake terminology, this is the
process of converting the (handwritten, if not generated by Confix)
<samp><span class="file">configure.in</span></samp> and <samp><span class="file">Makefile.am</span></samp> to <code>configure</code> and
<samp><span class="file">Makefile.in</span></samp>, respectively. In Confix terminology, bootstrapping
means creating <samp><span class="file">configure.in</span></samp> and <samp><span class="file">Makefile.am</span></samp> first (which
is done implicitly by the <var>output</var> action), and then doing the
autotools bootstrap.

     <p>Depends on:

          <ul>
<li><var>output</var>

          <li><var>resolve</var> (recursively through output)

     </ul>

     <p>Parameters:

          <ul>
<li>None of its own, only the parameters pulled in by actions which
<var>bootstrap</var> depends upon.

     </ul>

     <p>Examples:

          <ul>
<li>In the package root,
          <pre class="example">               $ confix.py --bootstrap --prefix=$HOME/wxpackages
          </pre>
          <li>Or, from elsewhere
          <pre class="example">               $ confix.py --bootstrap --packageroot=$HOME/work/wx-utils \
                           --prefix=$HOME/wxpackages
          </pre>
          </ul>

     <li><samp><span class="option">--configure</span></samp>
<a name="index-g_t_0040option_007b_002d_002dconfigure_007d-223"></a>
Call the package's <samp><span class="command">configure</span></samp> script in the package's
compilation directory. One might expect that this action implictly
invokes the <var>bootstrap</var> action. This is not the case however,
because it makes sense to configure a package several times. For
example, the compilation directory might have been removed brutally by
an angry user who ran out of disk space. It makes no sense to
re-bootstrap the source then. Moreover, an implicit bootstrap would
violate the separation between maintainer and user as
<samp><span class="option">--configure</span></samp> is a <em>user</em> option. Put shortly,
<var>configure</var> is a standalone action.

     <p><em>Note</em> that the environment variables visible to
<samp><span class="command">configure</span></samp> can considerably influence its behavior. For this
reason a clean environment is passed to the script. Environment
variables can be set via the configuration file on a per-profile basis.

     <p>Parameters:

          <ul>
<li><var>packageroot</var>. We need the package root in order to compute the path
to the <samp><span class="command">configure</span></samp> command.

          <li><var>buildroot</var>, or

          <li><var>builddir</var>

     </ul>

     <p>Examples:

          <ul>
<li>Configure the package located in <samp><span class="file">$HOME/work/wx-utils</span></samp> in the
directory <samp><span class="file">$HOME/build/wx-utils</span></samp>.

          <pre class="example">               $ confix.py --configure --packageroot=$HOME/work/wx-utils
               --builddir=$HOME/build/wx-utils
          </pre>
          <li>Same as above. The <var>builddir</var> parameter is computed from
<var>packageroot</var> and <var>buildroot</var>.

          <pre class="example">               $ confix.py --configure --packageroot=$HOME/work/wx-utils
               --buildroot=$HOME/build
          </pre>
          <li>The same as above, provided that, in your configuration file (see
below), in the '<code>default</code>' profile, you have specified that the
<var>buildroot</var> is <samp><span class="file">$HOME/build</span></samp>.

          <pre class="example">               $ confix.py --configure --packageroot=$HOME/work/wx-utils
          </pre>
          </ul>

     <li><samp><span class="option">--make</span></samp>
<a name="index-g_t_0040option_007b_002d_002dmake_007d-224"></a>
Call <samp><span class="command">make</span></samp> in the package's compilation directory. The
treatment of <var>buildroot</var>, environment variables, and so on, is
similar to that of the <var>configure</var> action. Note that it is
irrelevant for <samp><span class="command">make</span></samp> where the <var>packageroot</var> is.

     <p>Parameters:

          <ul>
<li><var>targets</var>

     </ul>

     <p>Examples:

          <ul>
<li>In the package root,
          <pre class="example">               $ confix.py --make --targets='all install' \
                   --builddir=$HOME/build/wx-utils
          </pre>
          <p>(or any of the variations of <var>builddir</var> presented above).

          <li><var>bootstrap</var>, <var>configure</var>, and <var>make</var> are independent
actions, although you can meaningfully combine them on the commandline
to do a whole lot of work in one swoop,
          <pre class="example">               $ confix.py --bootstrap --configure --make
               --packageroot=$HOME/work/wx-utils --builddir=$HOME/build/wx-utils
          </pre>
          <p><em>Note</em> that the order in which you specify the actions is
important, as it makes no sense to configure a package unless it has
been bootstrapped before. Likewise, a premature <samp><span class="command">make</span></samp>
invokation will lead to error messages in one way or the other.

     </ul>

</ul>

<div class="node">
<p><hr>
<a name="Parameters"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Actions">Actions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Options-and-Parameters">Options and Parameters</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">A.2 Parameters</h3>

<p><a name="index-parameters-225"></a>
This section lists the parameters which are relevant to most of the
action arguments described above. Although there are reasonable
default values for most of the parameters, it can be tedious if you
have to specify them on the commandline again and again. An easier way
for this is to write a configuration file <samp><span class="file">.confix</span></samp> in your home
directory where you can specify most of these parameters. The relevant
parameters to control the configuration file and how parameters are
selected from it are <samp><span class="option">--configfile</span></samp> and <samp><span class="option">--profile</span></samp>
which are described below. See <a href="#The-Configuration-File">The Configuration File</a> for the
syntax of this file. Suffice it for now to state that parameters
specified on the commandline have precedence over the configuration
file.

     <ul>
<li><samp><span class="option">--advanced</span></samp>
<a name="index-g_t_0040option_007b_002d_002dadvanced_007d-226"></a>
Use Confix in advanced mode, by trying to perform reasonable actions
in some cases instead of displaying errors and stopping. Specifically,
this causes build directories (see the <samp><span class="option">--builddir</span></samp> option) to
be created automatically if they do not exist.

     <p>In the future this behavior might be expanded to included various
automatic repository actions, for example, automatic selection of a
package from multiple conflicting repositories.

     <p>The default is to disable advanced behavior.

     <li><samp><span class="option">--configfile</span></samp>
<a name="index-g_t_0040option_007b_002d_002dconfigfile_007d-227"></a>
The name of extra configuration files to read after loading the
<samp><span class="file">$HOME/.confix</span></samp> personal configuration file.

     <p>The default is to load no extra configuration files.

     <li><samp><span class="option">--profile</span></samp>
<a name="index-g_t_0040option_007b_002d_002dprofile_007d-228"></a>
The name of the configuration profile to be selected from the
configuration file. (See below for a description of what a profile is
and how to use it.)

     <p>The default profile name is '<code>profile</code>'.

     <li><samp><span class="option">--prefix</span></samp>
<a name="index-g_t_0040option_007b_002d_002dprefix_007d-229"></a>
The prefix (a directory) where the package will be installed to, once it
is built. Also, this serves as the default prefix for the
<samp><span class="option">--repository</span></samp> parameter (see there).

     <p>No default available.

     <li><samp><span class="option">--packageroot</span></samp>
<a name="index-g_t_0040option_007b_002d_002dpackageroot_007d-230"></a>
The name of the directory where the package's source tree begins.

     <p>The default is the current working directory.

     <li><samp><span class="option">--packagename</span></samp>
<a name="index-g_t_0040option_007b_002d_002dpackagename_007d-231"></a><a name="index-package-name-232"></a>
The package name. For example, library names are generated automatically
from the package name and the module name, as with
<samp><span class="file">libwx-utils_error.a</span></samp>, where <code>wx-utils</code> is the package name and
<code>error</code> is the module name within the package.

     <p>This option takes precedence over the <code>NAME()</code> package property
written in the package interface file (see <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a>).

     <li><samp><span class="option">--packageversion</span></samp>
<a name="index-g_t_0040option_007b_002d_002dpackageversion_007d-233"></a>
The package version. This really only affects the name of the
resulting distribution tarball.

     <p>The default is 0.0.0.

     <li><samp><span class="option">--repository</span></samp>
<a name="index-g_t_0040option_007b_002d_002drepository_007d-234"></a>
The directory where module descriptions are installed. Remember, module
descriptions are files where an installed module's properties are
recorded. These are the things a module <em>provides</em>, such as include
files <em>required</em> by other modules, and the <em>content</em> of a
module, such as the path to be passed to the compiler to find the
module's include files, the libraries to link, and so on.

     <p>The default repository is <samp><span class="file">$(prefix)/repo</span></samp>.

     <li><samp><span class="option">--buildroot</span></samp>
<a name="index-g_t_0040option_007b_002d_002dbuildroot_007d-235"></a>
The directory where you usually compile your packages in. Every
subdirectory of it corresponds to a compilation tree of one particular
package.

     <p>No default available.

     <li><samp><span class="option">--builddir</span></samp>
<a name="index-g_t_0040option_007b_002d_002dbuilddir_007d-236"></a>
The compilation directory of the current package. This is made the
current working directory during the <var>configure</var> and <var>make</var>
actions.

     <p>The default compilation directory is <samp><span class="file">&lt;buildroot&gt;/&lt;basename of
packageroot&gt;</span></samp>.

     <li><samp><span class="option">--use-libtool</span></samp>
<a name="index-Libtool-237"></a><a name="index-shared-libraries_002c-and-Libtool-238"></a><a name="index-libraries_002c-shared_002c-Libtool-239"></a>
If you specify this flag, output will be generated that makes use of
Libtool. This means that building libraries is done by Libtool, and,
depending on the support of Libtool for the target architecture,
either shared or static libraries, or both, will be built. By default
this is switched off, and output is generated that builds plain
archives, without Libtool.

     <li><samp><span class="option">--targets</span></samp>
<a name="index-g_t_0040option_007b_002d_002dtargets_007d-240"></a>
A string which contains whitespace-separated targets suitable for the
<var>make</var> action.

     <li><samp><span class="option">--trace</span></samp>
<a name="index-g_t_0040option_007b_002d_002dtrace_007d-241"></a>
For debugging. You can specify the following trace levels, which you
separate with a comma. The output goes to standard error.

          <ul>
<li><code>require</code>

          <p>During the package scan process, output what the modules <em>require</em>.

          <li><code>provide</code>

          <p>During the package scan process, output what the modules <em>provide</em>.

          <li><code>resolve</code>

          <p>During the package resolving process (remember, this is where module
dependencies are calculated), output which <em>provide</em>s satisfy which
<em>require</em>s.

          <li><code>repo</code>

          <p>Output information about what is being discovered in the module
description repository.

          <li><code>check</code>

          <p>Output which module demands which <samp><span class="command">autoconf</span></samp> checks.

     </ul>

     <p>Example:

     <p><samp><span class="command">confix.py --output --trace=provide,require</span></samp>

     <li><samp><span class="option">--debug</span></samp>
<a name="index-g_t_0040option_007b_002d_002ddebug_007d-242"></a>
Enable overall debugging messages.

     <p>Example:

     <p><samp><span class="command">confix.py --output --debug=1</span></samp>

   </ul>

<div class="node">
<p><hr>
<a name="Interfaces-for-Coder-and-Maintainer"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Configuration-File">The Configuration File</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Options-and-Parameters">Options and Parameters</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix B Interfaces for Coder and Maintainer</h2>

<p>Before Confix generates Automake and Autoconf input files, it scans
the package for information about what to generate. On one hand, and
that is where most of that information ideally comes from, it reads
the source code of the package and makes wild guesses on what to do
with that source code. On the other hand there is the possibility for
the package maintainer to write explicit instructions for
Confix. There are many reasons why one might want to do that, one
being that Confix simply cannot guess everything only from the source
code and needs help from the maintainer.

   <p>This chapter explains the various places where one can specify build
instructions: the toplevel (package) <samp><span class="file">Makefile.py</span></samp>, a module's
<samp><span class="file">Makefile.py</span></samp>, and the buildables themselves (one can write
explicit build instructions in various kinds of source files &mdash; but
read on). All of the interfaces have a few things in common. First,
since Confix is written in Python, and Python provides very elegant ways
of embedding user code, the interfaces we will be talking about are also
in Python. Generally speaking, you can write arbitrary Python code and
use the Confix interface functions from it.

   <p><a name="index-calling-convention_002c-of-interface-functions-243"></a>Second, the parameter sets of the interface functions are subject to
extension. Although we will try to maintain backwards compatibility as
far as possible, it is quite likely that new parameters are added
under the hood. A consequence of this is that <em>you should not use
positional arguments, but rather use keyword arguments
instead</em><a rel="footnote" href="#fn-35" name="fnd-35"><sup>35</sup></a>.

   <p>Third, the sets of interface functions which are available in the
package, the module, and the buildable are not necessarily disjoint. For
example, all of them allow the maintainer to add code to the
<code>configure.in</code> and <code>acinclude.m4</code> files using the
<code>CONFIGURE_IN()</code> and <code>ACINCLUDE_M4()</code> interface functions,
respectively. For the sake of readablilty, we chose to explain each of
these function in every section, rather than referring to one common
place.

<ul class="menu">
<li><a accesskey="1" href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>
<li><a accesskey="2" href="#The-Buildable-Interface">The Buildable Interface</a>
<li><a accesskey="3" href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a>
</ul>

<!-- WE DUPLICATE TEXT IN THE SUBSEQUENT SECTIONS ABOUT THE PACKAGE-, MODULE, -->
<!-- AND BUILDABLE INTERFACES. WE DON'T DO SO BRUTALLY HOWEVER, BUT RATHER -->
<!-- USE MACROS FOR IT. TAKE CARE TO CROSS CHECK THE THREE SECTIONS IF YOU -->
<!-- CHANGE THE MACRO TEXT. -->
<!-- BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS -->
<!-- BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS -->
<!-- BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS, BEGIN MACROS -->
<!-- END MACRO, END MACRO, END MACRO, END MACRO, END MACRO, END MACRO -->
<!-- END MACRO, END MACRO, END MACRO, END MACRO, END MACRO, END MACRO -->
<!-- END MACRO, END MACRO, END MACRO, END MACRO, END MACRO, END MACRO -->
<div class="node">
<p><hr>
<a name="The-Module-Makefile.py-Interface"></a>
<a name="The-Module-Makefile_002epy-Interface"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Buildable-Interface">The Buildable Interface</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">B.1 The Module <samp><span class="file">Makefile.py</span></samp> Interface</h3>

<p><a name="index-interface-functions_002c-module-244"></a><a name="index-module_002c-interface-functions-245"></a>When Confix sees a <samp><span class="file">Makefile.py</span></samp> file in a package's subdirectory,
it concludes that there's something to build in that directory. It then
examines the directory's content, and generates build instructions for
the files it can handle. Normally, the <samp><span class="file">Makefile.py</span></samp> can be left
empty, it just needs to be there as a marker for Confix. However,
sometimes you may want to provide some explicit build instructions for a
module. For this, Confix provides a couple of functions that you may
invoke in <samp><span class="file">Makefile.py</span></samp>.

     <ul>
<li><a name="index-CONFIGURE_005fIN_002c-module-interface-246"></a><a name="index-CONFIGURE_005fIN-247"></a><strong>CONFIGURE_IN()</strong>. Perhaps the most central part in maintaining a package is crafting M4
and Bourne shell code in <samp><span class="file">configure.in</span></samp>. Confix tries to relieve
you as much as possible from this job. However, at the point where you
are using third party code, you have to dive into it (there are other
situations, but this is the most common). See <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a> for usage examples.

     <p>The module interface offers an interface function, <code>CONFIGURE_IN()</code>, which you
can use to hook arbitrary code fragments into the package's
<samp><span class="file">configure.in</span></samp> file. Its parameters are explained below.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">configure.in</span></samp>.

          <li><code>order</code>.

          <p>Depending on what <code>lines</code> contains, it is important that the lines
do not interfere with other invocations of <code>CONFIGURE_IN()</code>. For
example, it might be important to check for the presence of a particular
program <em>before</em> another check applies that program. That's what
the <code>order</code> parameter is for. There are predefined constants for
<code>order</code> values which you should use for <code>CONFIGURE_IN()</code>, and
which are named according to the &ldquo;Ordering Tests&rdquo; section in the
<a href="http://sources.redhat.com/autobook/">Autotools book</a>. Following is
a description of the meaning of each value, taken literally from the
book.

          <p><a name="index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-248"></a>
               <ol type=1 start=1>

               <li><code>AC_BOILERPLATE</code>. This section should include standard boilerplate
code, such as the call to <code>AC_INIT</code> (which must be first),
<code>AM_INIT_AUTOMAKE</code>, <code>AC_CONFIG_HEADER</code>, and perhaps
<code>AC_REVISION</code><a rel="footnote" href="#fn-36" name="fnd-36"><sup>36</sup></a>.

               <li><code>AC_OPTIONS</code>. The next section should include macros which add
command-line options to configure, such as <code>AC_ARG_ENABLE</code>. It is
typical to put support code for the option in this section as well, if
it is short enough, like this example from libgcj:

               <pre class="example">                    AC_ARG_ENABLE(getenv-properties,
                    [  --disable-getenv-properties
                    don't set system properties from GCJ_PROPERTIES])
                    
                    dnl Whether GCJ_PROPERTIES is used depends on the target.
                    if test -n $enable_getenv_properties; then
                    enable_getenv_properties=${enable_getenv_properties_default-yes}
                    fi
                    if test $enable_getenv_properties = no; then
                    AC_DEFINE(DISABLE_GETENV_PROPERTIES)
                    fi
               </pre>
               <li><code>AC_PROGRAMS</code>. Next it is traditional to check for programs that
are either needed by the configure process, the build process, or by
one of the programs being built. This usually involves calls to macros
like <code>AC_CHECK_PROG</code> and <code>AC_PATH_TOOL</code>.

               <li><code>AC_LIBRARIES</code>. Checks for libraries come before checks for other
objects visible to C (or C++, or anything else). This is necessary
because some other checks work by trying to link or run a program; by
checking for libraries first you ensure that the resulting programs
can be linked.

               <li><code>AC_HEADERS</code>. Next come checks for existence of headers.

               <li><code>AC_TYPEDEFS_AND_STRUCTURES</code>. We do checks for typedefs after
checking for headers for the simple reason that typedefs appear in
headers, and we need to know which headers we can use before we look
inside them.

               <li><code>AC_FUNCTIONS</code>. Finally we check for functions. These come last
because functions have dependencies on the preceding items: when
searching for functions, libraries are needed in order to correctly
link, headers are needed in order to find prototypes (this is
especially important for C++, which has stricter prototyping rules
than C), and typedefs are needed for those functions which use or
return types which are not built in.

               <li><code>AC_OUTPUT</code>. This is done by invoking AC_OUTPUT<a rel="footnote" href="#fn-37" name="fnd-37"><sup>37</sup></a>.

               </ol>

          <li><code>propagate_only</code>. Boolean. By default, a code fragment added to the
module by <code>CONFIGURE_IN()</code> is added to the enclosing package's
<samp><span class="file">configure.in</span></samp> file. This is done regardless if the module is used
by another module in the same package or not, and this has the effect
that <samp><span class="file">configure.in</span></samp> fragments are executed by the <code>configure</code>
script even if nobody in the package uses it. Sometimes one wants to
prepare a package whose sole purpose is to contain definitions of third
party code that can be used by other packages. As that package contains
only third party code definitions and makes no use of them by itself,
one does not want that package's <code>configure</code> script to perform all
these checks. The checks should only be performed by the
<code>configure</code> scripts of those packages that pull them in<a rel="footnote" href="#fn-38" name="fnd-38"><sup>38</sup></a>.

          <p>Anyway, if you want to suppress execution of the code by the enclosing
package's <code>configure</code> script, pass <code>1</code> as the value of this
parameter. It will then only be propagated to outside code that declares
to be using it. The parameter will be ignored if the module happens to
be used in the enclosing package, however, and the check will be
performed anyway.

     </ul>

     <li><a name="index-ACINCLUDE_005fM4_002c-module-interface-249"></a><a name="index-ACINCLUDE_005fM4-250"></a><strong>ACINCLUDE_M4()</strong>. The file <samp><span class="file">acinclude.m4</span></samp> can be thought of as a kind of "library"
where one can place macro definitions that are used from code in
<samp><span class="file">configure.in</span></samp>. Just like the <code>CONFIGUE_IN()</code> interface
function adds code to the <samp><span class="file">configure.in</span></samp> file,
<code>ACINCLUDE_M4()</code> can be used to add code to <samp><span class="file">acinclude.m4</span></samp>.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">acinclude.m4</span></samp>.

          <li><code>id</code>. String; the unique identifier of the code fragment. When Confix
instruments a package, each module contributes its <samp><span class="file">acinclude.m4</span></samp>
fragments to every module that uses it. At the end of the process, each
module contributes its fragments to the enclosing package which finally
writes <samp><span class="file">acinclude.m4</span></samp>. This way it is possible that the fragments
reach the package multiple times. The package sorts these out based on
their unique identifiers.

          <li><code>propagate_only</code>. Boolean. Analogous to <code>propagate_only</code> of
the <code>CONFIGURE_IN()</code> function. See there. 
</ul>

     <li><a name="index-PROVIDE_005fH-251"></a><strong>PROVIDE_H()</strong>. Add a provide object of type &ldquo;C/C++ header
file&rdquo;.

     <p>Parameters:

          <ul>
<li><code>filematch</code>. String; required. A shell-like match expression
which determines which corresponding require objects are matched by
the provide object. The match is evaluated by the Python
<code>fnmatch.fnmatchcase()</code> function.

          <li><code>provide_mode</code>. String; values are either 'public' or 'package'.

     </ul>

     <li><a name="index-provide-object_002c-symbolic-252"></a><a name="index-symbolic-provide-object-253"></a><a name="index-PROVIDE_005fSYMBOL-254"></a><strong>PROVIDE_SYMBOL()</strong>. Add a provide object of type
&ldquo;symbolic&rdquo;. This is not much different from <code>PROVIDE_H()</code>; it
can resolve a require object of type &ldquo;symbolic&rdquo; which can be added
using <code>REQUIRE_SYMBOL()</code>. The only difference is that the symbol
name is a plain string rather than a shell glob<a rel="footnote" href="#fn-39" name="fnd-39"><sup>39</sup></a>.

     <p>Parameters:

          <ul>
<li><code>symbol</code>. String; required. The name of the symbol that is
provided by the module.

          <li><code>provide_mode</code>. String; values are either 'public' or
'package'.

     </ul>

     <p>An example usage of <code>PROVIDE_SYMBOL()</code> and its counterpart
<code>REQUIRE_SYMBOL()</code> (described below) can be found in the
<samp><span class="file">wx-utils</span></samp> package. There, module <samp><span class="file">crypt</span></samp> depends on module
<samp><span class="file">ext-crypt</span></samp> because both of them contain a matching pair of
require and provide objects. <samp><span class="file">crypt/crypt.cc</span></samp> adds a symbolic
require object to its containing module by saying
<code>REQUIRE_SYMBOL('crypt')</code>. Its corresponding provide object is
added to module <samp><span class="file">ext-crypt</span></samp> in the <samp><span class="file">Makefile.py</span></samp> of that
module, by saying <code>PROVIDE_SYMBOL('crypt')</code>.

     <li><a name="index-REQUIRE_005fH-255"></a><strong>REQUIRE_H()</strong>. Add a require object of type &ldquo;C/C++
<code>#include</code> directive&rdquo;.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String; required; A file name as if it were seen in a
C preprocessor <code>#include</code> directive, with the quotes stripped.

     </ul>

     <li><a name="index-require-object_002c-symbolic-256"></a><a name="index-symbolic-require-object-257"></a><a name="index-REQUIRE_005fSYMBOL-258"></a><strong>REQUIRE_SYMBOL()</strong>. Add a require object of type
&ldquo;symbol&rdquo; that can be resolved by a provide object added using
<code>PROVIDE_SYMBOL()</code>. See there for further explanation.

     <p>Parameters:

          <ul>
<li><code>symbol</code>. String; required; the symbol's name.

     </ul>

     <li><a name="index-FEATURE_005fMACRO-259"></a><a name="index-AC_005fDEFINE-260"></a><a name="index-g_t_0040code_007bAC_005fDEFINE_007d-261"></a><a name="index-module-availability-262"></a><a name="index-availability_002c-of-modules-263"></a><strong>FEATURE_MACRO()</strong>. Define a macro (using the
<code>AC_DEFINE</code> Autoconf macro) in <samp><span class="file">config.h</span></samp> when this module
is available during the build of a package. If the macro is defined
(the module is available), then its value is 1. See <a href="#Optionally-Building-and-Using-Modules">Optionally Building and Using Modules</a> for how one can enable and disable either
the build of a module when building the containing package, or build
another package with or without an installed module.

     <p>Parameters:

          <ul>
<li><code>macroname</code>. String; required; the macro.

          <li><code>description</code>. String; required; the description of the
macro. This is put into the generated <code>config.h</code>, right before
the macro definition. <code>description</code> is the third parameter to the
Autoconf <code>AC_DEFINE</code> macro; see there for more detailed
information.

     </ul>

     <li><a name="index-EXTERNAL_005fLIBRARY-264"></a><strong>EXTERNAL_LIBRARY()</strong>. Make the module a wrapper around a
library which is not maintained by Confix. See <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a> for an overall explanation and an example.

     <p>Parameters:

          <ul>
<li><code>name</code>. The name which identifies the library in the
corresponding Autoconf feature test macro as well as in the
corresponding argument to the <samp><span class="command">configure</span></samp> program. The
Autoconf feature test macro's name is
<code>HAVE_CONFIX_EXT_&lt;name&gt;</code>. The <samp><span class="command">configure</span></samp> argument to
switch the library on or off and to specify the path is
<code>--with-ext-&lt;name&gt;</code>. The value can either be 'yes', 'no', or the
prefix (the root) directory where the library and its header files are
installed.

          <li><code>enabled</code>. String; values are either 'yes' or 'no'; defaults to
'yes'. Determines the default value of the <samp><span class="command">configure</span></samp>
argument <code>--with-ext-&lt;name&gt;</code>.

          <li><code>lib_bases</code>. String list; optional; defaults to the empty list. A
list of library base names, each of which will appear on the link line
as <code>-l&lt;each&gt;</code>. If there is no library but rather a set of header
files which you intend to direct the include path to, then you may
safely leave the list empty.

          <li><code>defroot</code>. String; optional; defaults to <samp><span class="file">/usr/local</span></samp>. The
prefix taken if the user does not explicitly specify one using
<code>--with-ext-&lt;name&gt;</code>.

          <li><code>incdir</code>. String; optional; defaults to <code>include</code>. The
relative path inside the library's prefix directory where the header
files are. For example, if the library's prefix were
<code>/usr/local</code>, then the header files would be taken from
<samp><span class="file">/usr/local/include</span></samp>.

          <p><em>Note</em> that the empty string means that there should no include
path be set for this module. If you want the include path for that
module to be the same as the prefix, specify <code>incdir='.'</code>.

          <li><code>libdir</code>. String; optional; defaults to <samp><span class="file">lib</span></samp>. Same
semantics as <code>incdir</code>.

          <li><code>provide</code>. String list; optional; defaults to the empty
list. Shorthand for calling <code>PROVIDE_H(elem, 'public')</code> for each
list element.

          <li><a name="index-provide-object_002c-symbolic-265"></a><a name="index-symbolic-provide-object-266"></a><code>provide_symbols</code>. String list; optional; defaults to the empty
list. Shorthand for calling <code>PROVIDE_SYMBOL(elem, 'public')</code> for
each list element. <em>Note</em> that, while the default values of
<code>provide_symbols</code> and <code>provide</code> are the empty list, it does
not make much sense to leave them both empty &mdash; you want the library
to be linked in, in the end, and that's what provides are for.

          <li><code>require</code>. String list; optional; defaults to the empty
list. Shorthand for calling <code>REQUIRE_H()</code> for each list
element. Specifying require objects for an external library enables
you to build a dependency graph of external libraries. <em>Note</em>
however that you should take care not to introduce dependencies back
into the set of Confix managed modules, unless you know what you are
doing.

          <li><a name="index-require-object_002c-symbolic-267"></a><a name="index-symbolic-require-object-268"></a><code>require_symbols</code>. String list; optional; defaults to the empty
list. Shorthand for calling <code>REQUIRE_SYMBOL(elem)</code> for each list
element. The same notes hold as for the <code>require</code> parameter.

     </ul>

     <li><a name="index-IGNORE_005fFILE-269"></a><strong>IGNORE_FILE()</strong>. Specify a file that must be
ignored. Sometimes you want to keep source files around in a directory
without compiling them, and this is when you use this function. It is
only applicable when Confix guesses the build instruction in that
directory. When you specify build instruction explicitly for that
module, this statement has no effect.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String; required; The file name.

     </ul>

     <li><a name="index-name_002c-of-a-library-270"></a><a name="index-library-name-271"></a><a name="index-LIBNAME_002c-module-property-272"></a><a name="index-LIBNAME_002c-module-interface-273"></a><a name="index-MODULE_005fPROPERTIES-274"></a><strong>MODULE_PROPERTIES()</strong>. Set properties of a module. Can
be called multiple times in the module's <samp><span class="file">Makefile.py</span></samp>. If a
property had already been set, each successive call overrides that
property if the same property is given again.

     <p>Parameters:

          <ul>
<li><code>properties</code>. Dictionary; required. Keys must be strings, the
<em>properties</em>. The values depend on the semantics of the
particular property. Currently, valid properties are,

               <ul>
<li><a name="index-LIBNAME_002c-module-property-275"></a><code>'LIBNAME'</code>. Value is a non-empty string, the base name of the
library built by the module. For example, if you give '<code>foo</code>',
and static libraries (archives) are built, the name of the archive
file will be <code>libfoo.a</code> (at least on most operating systems).

          </ul>

     </ul>

     <li><a name="index-name_002c-of-a-library-276"></a><a name="index-library-name-277"></a><a name="index-LIBNAME_002c-module-property-278"></a><a name="index-LIBNAME_002c-module-interface-279"></a><strong>LIBNAME()</strong>. Set the <code>'LIBNAME'</code> module
property. <code>LIBNAME('foo')</code> is only a shorthand for
<code>MODULE_PROPERTIES({'LIBNAME': 'foo'})</code>.

     <p>Parameters:

          <ul>
<li><code>name</code>. String; required. A non-empty string, the library's base
name.

     </ul>

     <li><a name="index-FILE_005fPROPERTIES_002c-module-interface-280"></a><a name="index-source-file-properties-281"></a><a name="index-properties_002c-of-source-files-282"></a><strong>FILE_PROPERTIES()</strong>. Set properties of a source file.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String; required. A shell-like match expression which
identifies the files to which the given properties should apply. The
match is evaluated by the Python <code>fnmatch.fnmatchcase()</code>
function.

          <li><code>properties</code>. Dictionary; required. See the description of
<code>FILE_PROPERTIES()</code> in <a href="#The-Buildable-Interface">The Buildable Interface</a>, for valid
properties and their meanings. In fact, calling this function in the
module's <samp><span class="file">Makefile.py</span></samp> has just the same effect as calling the
equivalent function in the source file itself, except that the latter
has precedence.

     </ul>

     <li><a name="index-INSTALLDIR_005fH-283"></a><a name="index-header-files_002c-installing-284"></a><a name="index-installation-directory_002c-and-header-files-285"></a><strong>INSTALLDIR_H()</strong>. Specify the directory where this
module's header files will be installed. Normally, when you do not set
this property, the header files will be installed into a directory
that is derived from the C++ namespaces (if any) contained in the
header files. See <a href="#Namespaces">Installation &mdash; A Short Example</a>. This property disables namespace guessing &mdash; all header
files maintained by this module will be installed into the given
directory.

     <p>Parameters:

          <ul>
<li><code>dir</code>. String; required. The header files installation directory,
a path name relative to <code>$(includedir)</code>. An empty string is ok,
in this case the header files will be installed directly into
<code>$(includedir)</code>.

     </ul>

     <li><a name="index-MAKEFILE_005fAM-286"></a><strong>MAKEFILE_AM()</strong>. Add a line to the resulting
<samp><span class="file">Makefile.am</span></samp>. This is used to pass custom build instructions
through to the <samp><span class="file">Makefile.am</span></samp> which is generated by Confix.

     <p>Use this function with care. If you want to, for example, add a file
to the package which is made by <samp><span class="command">make dist</span></samp>, you must not add
a line like

     <pre class="example">          EXTRA_DIST = somefile
     </pre>
     <p>Confix maintains such a list internally; it contains (at least) the
module's <samp><span class="file">Makefile.py</span></samp> file. By adding the above line literally,
you would get in conflict with Confix. To get around this, you should
add your <code>EXTRA_DIST</code> files to Confix's internal list, by using
the <code>EXTRA_DIST()</code> function described below.

     <p>Parameters:

          <ul>
<li><code>line</code>. String; required. A &ldquo;line&rdquo;, though the string may
contain multiple lines. It will appear in the resulting
<samp><span class="file">Makefile.am</span></samp> file with a newline appended.

     </ul>

     <li><a name="index-EXTRA_005fDIST-287"></a><a name="index-EXTRA_005fDIST-288"></a><strong>EXTRA_DIST()</strong>. Add a filename to the <code>EXTRA_DIST</code>
variable of the module's <samp><span class="file">Makefile.am</span></samp>. You do this if you have
files in the module's directory that are not automatically packaged by
<samp><span class="command">make dist</span></samp>. See the Automake documentation for more.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String.

     </ul>

     <!-- @item -->
<!-- @findex MANAGE_H -->
<!-- @code{@strong{MANAGE_H()}}. Add a buildable of type ``C/C++ header -->
<!-- file'' to the list of managed buildables. -->
<!-- Parameters: -->
<!-- @itemize @bullet -->
<!-- @item -->
<!-- @code{filename}. String; required. The name of the header file. -->
<!-- @item -->
<!-- @code{require_includes}. String list; optional; defaults to empty -->
<!-- list. List of files as if they were seen in a C preprocessor -->
<!-- @code{#include} directive (with the quotes stripped). These will be -->
<!-- added to the module as requires. -->
<!-- @item -->
<!-- @code{guess_require_includes}. String; values are either 'yes' or -->
<!-- 'no'; optional; defaults to 'yes'. A flag that indicates whether the -->
<!-- file should be parsed for further requires. -->
<!-- @item -->
<!-- @code{provide_mode}. String; values are either 'public', 'package', or -->
<!-- 'guess'; optional; defaults to 'guess'. Determines the provide's -->
<!-- visibility: 'public' means it will be visible (after installation) to -->
<!-- modules of other packages, 'private' means that it is only visible -->
<!-- during build to modules of the same package, and 'guess' means that -->
<!-- visibility will be guessed based on its filename. -->
<!-- @end itemize -->
<!-- @item -->
<!-- @findex MANAGE_CXX -->
<!-- @code{@strong{MANAGE_CXX()}}. Add a buildable of type ``C++ file'' to -->
<!-- the list of managed buildables. -->
<!-- Parameters: -->
<!-- @itemize @bullet -->
<!-- @item -->
<!-- @code{filename}. String; required. The name of the C++ file. -->
<!-- @item -->
<!-- @code{main}. String; values are either 'yes', 'no', or 'guess'; -->
<!-- optional; defaults to 'guess'. A value of 'yes' indicates that this -->
<!-- file contains the @code{main()} function, and that an executable -->
<!-- should be built. -->
<!-- @c jjj FIXME: elaborate on this further, once guessing *and* -->
<!-- @c explicitness is supported -->
<!-- @item -->
<!-- @code{guess_require_includes}. See @code{MANAGE_H()}. -->
<!-- @end itemize -->
<!-- @item -->
<!-- @findex MANAGE_C -->
<!-- @code{@strong{MANAGE_C()}}. Add a buildable of type ``C file'' to the -->
<!-- list of managed buildables. -->
<!-- Parameters: as @code{MANAGE_CXX()}. -->
<!-- @item -->
<!-- @findex MANAGE_ARCHIVE -->
<!-- @code{@strong{MANAGE_ARCHIVE()}}. Add a buildable of type ``archive'' -->
<!-- (a library consisting of C/C++ files) to the list of managed -->
<!-- buildables. -->
<!-- Parameters: -->
<!-- @itemize @bullet -->
<!-- @item -->
<!-- @code{name}. String; optional; defaults to the empty string. The base -->
<!-- name of the archive, which is likely to end up being called -->
<!-- @code{lib<name>.a}. If the name parameter is left empty, then its -->
<!-- value is a mangled version of the module's name. The preferred way is -->
<!-- to leave it empty, unless you have a good reason@footnote{For example, -->
<!-- if the library is subject to be used by code that is not managed by -->
<!-- Confix}. If you don't care, you will never be bothered by library -->
<!-- names because your link lines will be generated by Confix. -->
<!-- @item -->
<!-- @code{members}. String list; required. A list of source file names -->
<!-- that participate in the library. Each of these files must have been -->
<!-- added to the module's list of buildables. At least one filename must -->
<!-- be given. @emph{Note} that header files must be added to the archive -->
<!-- as well. -->
<!-- @end itemize -->
<!-- @item -->
<!-- @findex MANAGE_EXECUTABLE -->
<!-- @code{@strong{MANAGE_EXECUTABLE()}}. Add a buildable of type -->
<!-- ``executable'' to the list of managed buildables. -->
<!-- Parameters: -->
<!-- @itemize @bullet -->
<!-- @item -->
<!-- @code{main}. String; optional. The name of the participating source -->
<!-- file that contains the @code{main()} function. -->
<!-- @item -->
<!-- @code{name}. String; optional. The name of the resulting executable. -->
<!-- @item -->
<!-- @code{members}. String list; required. The list of source files which -->
<!-- result in compiled object code, and which should appear on the link -->
<!-- line. At least one source file should be specified; although it might -->
<!-- seem obvious that this list contains the file which defines the -->
<!-- @code{main()} function, this is by no means required. -->
<!-- @item -->
<!-- @code{what}. String; values are either 'bin', 'check', or 'noinst'; -->
<!-- optional; defaults to 'bin'. According to Automake's rules@footnote{In -->
<!-- the Automake manual they call these rules ``Uniform Naming Scheme''.}, -->
<!-- a value of 'bin' makes the executable a regular program which will be -->
<!-- installed to the regular place; a value of 'check' make it a test -->
<!-- program which added to the automatic test suite (see also -->
<!-- @ref{Performing Automatic Tests}) and does not get installed; and a -->
<!-- value of 'noinst' makes it a normal program which is not installed. -->
<!-- @end itemize -->
<!-- One and only one of @code{main} and @code{name} must be specified. If -->
<!-- @email{main} is specified, the executable's name is a mangled -->
<!-- incarnation of the concatenation of the module name and the main -->
<!-- file. If @code{name} is specified, this is the executable's name. -->
</ul>

<div class="node">
<p><hr>
<a name="The-Buildable-Interface"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">B.2 The Buildable Interface</h3>

<p><a name="index-interface-functions_002c-buildable-289"></a><a name="index-buildable_002c-interface-functions-290"></a>We have heard about Confix's concept of <em>buildables</em>. A buildable
can be a single source file which is cooked by a compiler to produce an
object file. It can also be a collection of buildable objects which is
itself a buildable, such as a library or an executable. While it does
not make sense to specify build instructions in an executable though
(which has not even been built yet), it does make sense to specify them
in source files. Consider the example in <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a>,
where we wrote an Autoconf check for the C++ class <code>stringstream</code>
in the same source file where we used its result, the macro
<code>HAVE_SSTREAM</code>.

   <p>Before we present a list of all interface functions you can use from a
buildable's source, let us say a few words about how the calls to the
functions are embedded in the various buildable types (well, the only
buildable types that implement embedded Confix code are C and C++, so
talking about a great variety of them is somewhat academic).

   <p>All Confix code in a buildable has to be written inside comment blocks
which are specially shaped. For C++, the comments have to be of the
form,

<pre class="example">     // CONFIX:FILE_PROPERTIES({'MAIN': 0})
</pre>
   <p>These blocks can be multiline,

<pre class="example">     // CONFIX:FILE_PROPERTIES(
     // CONFIX:     {'MAIN': 0}
     // CONFIX:)
</pre>
   <p>They need not necessarily contain Confix interface functions. Rather,
you can write arbitrary Python code there. For example (rather useless
though),

<pre class="example">     // CONFIX:import dircache
     // CONFIX:for f in dircache.listdir('.'):
     // CONFIX:    print f
</pre>
   <p>When Confix parses the source file, it collects all lines that have
that pattern, concatenates them, and executes them in the same
context. This means that the Python code can be spread all over the
source file. You can allocate variables in one place, and refer to
them in another place (provided that &ldquo;another place&rdquo; comes after
&ldquo;one place&rdquo; in the file).

   <p>Please note that the Python parser is very particular about indentation
&mdash; indentation in Python is syntactically equivalent to putting braces
in C. It is important to understand that everything <em>immediately</em>
after the initial <code>// CONFIX:</code> is passed to the Python interpreter
literally, and the interpreter will bail out if you get it wrong.

   <p>The <samp><span class="file">wx-utils</span></samp> package accompanying the Confix distribution
contains a few invocation of the buildable interface, see for example
the file <samp><span class="file">error/error.cc</span></samp>.

   <p>So, concluding the story, here's the list of interface functions you can
use inside source files.

     <ul>
<li><a name="index-CONFIGURE_005fIN_002c-buildable-interface-291"></a><a name="index-CONFIGURE_005fIN-292"></a><strong>CONFIGURE_IN()</strong>. Perhaps the most central part in maintaining a package is crafting M4
and Bourne shell code in <samp><span class="file">configure.in</span></samp>. Confix tries to relieve
you as much as possible from this job. However, at the point where you
are using third party code, you have to dive into it (there are other
situations, but this is the most common). See <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a> for usage examples.

     <p>The buildable
interface offers an interface function, <code>CONFIGURE_IN()</code>, which you
can use to hook arbitrary code fragments into the package's
<samp><span class="file">configure.in</span></samp> file. Its parameters are explained below.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">configure.in</span></samp>.

          <li><code>order</code>.

          <p>Depending on what <code>lines</code> contains, it is important that the lines
do not interfere with other invocations of <code>CONFIGURE_IN()</code>. For
example, it might be important to check for the presence of a particular
program <em>before</em> another check applies that program. That's what
the <code>order</code> parameter is for. There are predefined constants for
<code>order</code> values which you should use for <code>CONFIGURE_IN()</code>, and
which are named according to the &ldquo;Ordering Tests&rdquo; section in the
<a href="http://sources.redhat.com/autobook/">Autotools book</a>. Following is
a description of the meaning of each value, taken literally from the
book.

          <p><a name="index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-293"></a>
               <ol type=1 start=1>

               <li><code>AC_BOILERPLATE</code>. This section should include standard boilerplate
code, such as the call to <code>AC_INIT</code> (which must be first),
<code>AM_INIT_AUTOMAKE</code>, <code>AC_CONFIG_HEADER</code>, and perhaps
<code>AC_REVISION</code><a rel="footnote" href="#fn-40" name="fnd-40"><sup>40</sup></a>.

               <li><code>AC_OPTIONS</code>. The next section should include macros which add
command-line options to configure, such as <code>AC_ARG_ENABLE</code>. It is
typical to put support code for the option in this section as well, if
it is short enough, like this example from libgcj:

               <pre class="example">                    AC_ARG_ENABLE(getenv-properties,
                    [  --disable-getenv-properties
                    don't set system properties from GCJ_PROPERTIES])
                    
                    dnl Whether GCJ_PROPERTIES is used depends on the target.
                    if test -n $enable_getenv_properties; then
                    enable_getenv_properties=${enable_getenv_properties_default-yes}
                    fi
                    if test $enable_getenv_properties = no; then
                    AC_DEFINE(DISABLE_GETENV_PROPERTIES)
                    fi
               </pre>
               <li><code>AC_PROGRAMS</code>. Next it is traditional to check for programs that
are either needed by the configure process, the build process, or by
one of the programs being built. This usually involves calls to macros
like <code>AC_CHECK_PROG</code> and <code>AC_PATH_TOOL</code>.

               <li><code>AC_LIBRARIES</code>. Checks for libraries come before checks for other
objects visible to C (or C++, or anything else). This is necessary
because some other checks work by trying to link or run a program; by
checking for libraries first you ensure that the resulting programs
can be linked.

               <li><code>AC_HEADERS</code>. Next come checks for existence of headers.

               <li><code>AC_TYPEDEFS_AND_STRUCTURES</code>. We do checks for typedefs after
checking for headers for the simple reason that typedefs appear in
headers, and we need to know which headers we can use before we look
inside them.

               <li><code>AC_FUNCTIONS</code>. Finally we check for functions. These come last
because functions have dependencies on the preceding items: when
searching for functions, libraries are needed in order to correctly
link, headers are needed in order to find prototypes (this is
especially important for C++, which has stricter prototyping rules
than C), and typedefs are needed for those functions which use or
return types which are not built in.

               <li><code>AC_OUTPUT</code>. This is done by invoking AC_OUTPUT<a rel="footnote" href="#fn-41" name="fnd-41"><sup>41</sup></a>.

               </ol>

     </ul>

     <li><a name="index-ACINCLUDE_005fM4_002c-buildable-interface-294"></a><a name="index-ACINCLUDE_005fM4-295"></a><strong>ACINCLUDE_M4()</strong>. The file <samp><span class="file">acinclude.m4</span></samp> can be thought of as a kind of "library"
where one can place macro definitions that are used from code in
<samp><span class="file">configure.in</span></samp>. Just like the <code>CONFIGUE_IN()</code> interface
function adds code to the <samp><span class="file">configure.in</span></samp> file,
<code>ACINCLUDE_M4()</code> can be used to add code to <samp><span class="file">acinclude.m4</span></samp>.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">acinclude.m4</span></samp>.

          <li><code>id</code>. String; the unique identifier of the code fragment. When Confix
instruments a package, each module contributes its <samp><span class="file">acinclude.m4</span></samp>
fragments to every module that uses it. At the end of the process, each
module contributes its fragments to the enclosing package which finally
writes <samp><span class="file">acinclude.m4</span></samp>. This way it is possible that the fragments
reach the package multiple times. The package sorts these out based on
their unique identifiers.

     </ul>

     <li><a name="index-FILE_005fPROPERTIES_002c-buildable-interface-296"></a><a name="index-file-properties_002c-buildable-interface-297"></a><a name="index-properties_002c-of-source-files-298"></a><a name="index-source-file-properties-299"></a><strong>FILE_PROPERTIES()</strong>. Set properties of the source
file. When this function is called multiple times in a source file, if a
property had already been set, each successive call overrides that
property if the same property is given again. Note that not every
property is valid for every source file type.

     <p>Parameters:

          <ul>
<li><code>properties</code>. Dictionary; required. Keys must be strings, the
<em>properties</em>. The values depend on the semantics of the
particular property. Currently, valid properties are,

               <ul>
<li><a name="index-MAIN_002c-source-file-property-300"></a><code>'MAIN'</code>. Value is boolean, and can be one of <code>'yes', 'no',
'y', 'n', 'true', 'false', 't', 'f', '1', '0', 1, 0</code>. This property
keeps Confix from searching the source file for occurences of the word
<code>main</code>, and from guessing from it that the file contains the
definition of the <code>main()</code> function. See <a href="#Library-or-Executables_003f">Library or Executables?</a> for an explanation of the effects of this property on
the build process.

               <p>Valid only for C and C++ source files (not valid for C/C++ header
files).

               <li><a name="index-EXENAME_002c-source-file-property-301"></a><code>'EXENAME'</code>. Value is a string which must not be empty. You use
this file property to control the name of an executable. Without this
property the executable name is automatically generated by Confix; see
also <a href="#Library-or-Executables_003f">Library or Executables?</a>.

               <p>Valid only for C and C++ source files (not valid for C/C++ header
files), and only if that file has the <code>'MAIN'</code> property (either
explicit or implicit).

               <li><a name="index-PROVIDE_005fMODE_002c-source-file-property-302"></a><code>'PROVIDE_MODE'</code>. Value is a string, namely one of
<code>'public'</code>, <code>'private'</code>, <code>'guess'</code> (the default). If
the file is recognized by Confix as a C header file, the behavior is
as follows. <code>'private'</code> means that the file will not be
installed, and is only visible to member files of the same
package. <code>'public'</code> means that the file will be
installed. <code>'guess'</code> resorts to the default behavior &mdash; make the
file private if its name starts with an underscore, else public.

          </ul>

     </ul>

     <p>Example:

     <pre class="example">          FILE_PROPERTIES({'MAIN': 'false'})
     </pre>
     <li><a name="index-MAIN-303"></a><strong>MAIN()</strong>. Receives a parameter, <code>main</code>, which is boolean the
same way as the <code>'MAIN'</code> property of <code>FILE_PROPERTIES()</code>. In
fact, for example, calling

     <pre class="example">          MAIN('false')
     </pre>
     <p>is just a shorthand for calling

     <pre class="example">          FILE_PROPERTIES({'MAIN': 'false'})
     </pre>
     <li><a name="index-EXENAME-304"></a><strong>EXENAME()</strong>. Receives a string parameter,
<code>name</code>. Calling

     <pre class="example">          EXENAME('foobar')
     </pre>
     <p>is exactly the same as calling

     <pre class="example">          FILE_PROPERTIES({'EXENAME': 'foobar'})
     </pre>
     <li><a name="index-REQUIRE_005fH-305"></a><a name="index-resolving_002c-dependencies-306"></a><strong>REQUIRE_H()</strong>. Add a require object of type &ldquo;C/C++
<code>#include</code> directive&rdquo;. To the resolving process, writing

     <pre class="example">          <code>REQUIRE_H('a_file.h')</code>
     </pre>
     <p>has the same effect as writing <code>#include &lt;a_file.h&gt;</code> into the
source file directly, it's just that the preprocessor is passed by.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String; required; A file name as if it were seen in a
C preprocessor <code>#include</code> directive, with the quotes stripped.

     </ul>

     <li><a name="index-require-object_002c-symbolic-307"></a><a name="index-symbolic-require-object-308"></a><a name="index-REQUIRE_005fSYMBOL-309"></a><strong>REQUIRE_SYMBOL()</strong>. Add a require object of type
&ldquo;symbol&rdquo;. Conceptually, this is nothing different from
<code>REQUIRE_H()</code> in that it influences module dependency
calculation. It's just that it's a cleaner way of hand-crafting the
dependency graph. It is likely to be used in conjunction with provide
objects of type &ldquo;symbol&rdquo; that were introduced by a call to
<code>PROVIDE_SYMBOL()</code> or <code>EXTERNAL_LIBRARY()</code>.

     <p>Parameters:

          <ul>
<li><code>symbol</code>. String; required; Roughly, a C like symbol, but can
actually be anything you want.

     </ul>

   </ul>

<div class="node">
<p><hr>
<a name="The-Toplevel-Makefile.py-Interface"></a>
<a name="The-Toplevel-Makefile_002epy-Interface"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Buildable-Interface">The Buildable Interface</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">B.3 The Toplevel (Package) <samp><span class="file">Makefile.py</span></samp> Interface</h3>

<p><a name="index-package_002c-interface-functions-310"></a><a name="index-interface-functions_002c-package-311"></a><a name="index-toplevel_002c-interface-functions-312"></a><a name="index-interface-functions_002c-toplevel-313"></a><a name="index-package-version-314"></a>Optionally, you can place a <samp><span class="file">Makefile.py</span></samp> in the package's root
directory as well. This file has a syntax similar to the module's
interface file (see <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a>), in that it
is all Python code. Unlike the module's <samp><span class="file">Makefile.py</span></samp> you use this
file to manipulate package properties, such as the package name
(remember, that one is derived from the package root directory's base
name if you don't explicitly specify one), or the package's version
('0.0.0' by default, which is not overly informative).

     <ul>
<li><a name="index-CONFIGURE_005fIN_002c-package-interface-315"></a><a name="index-CONFIGURE_005fIN-316"></a><strong>CONFIGURE_IN()</strong>. Perhaps the most central part in maintaining a package is crafting M4
and Bourne shell code in <samp><span class="file">configure.in</span></samp>. Confix tries to relieve
you as much as possible from this job. However, at the point where you
are using third party code, you have to dive into it (there are other
situations, but this is the most common). See <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a> for usage examples.

     <p>The package
interface offers an interface function, <code>CONFIGURE_IN()</code>, which you
can use to hook arbitrary code fragments into the package's
<samp><span class="file">configure.in</span></samp> file. Its parameters are explained below.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">configure.in</span></samp>.

          <li><code>order</code>.

          <p>Depending on what <code>lines</code> contains, it is important that the lines
do not interfere with other invocations of <code>CONFIGURE_IN()</code>. For
example, it might be important to check for the presence of a particular
program <em>before</em> another check applies that program. That's what
the <code>order</code> parameter is for. There are predefined constants for
<code>order</code> values which you should use for <code>CONFIGURE_IN()</code>, and
which are named according to the &ldquo;Ordering Tests&rdquo; section in the
<a href="http://sources.redhat.com/autobook/">Autotools book</a>. Following is
a description of the meaning of each value, taken literally from the
book.

          <p><a name="index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-317"></a>
               <ol type=1 start=1>

               <li><code>AC_BOILERPLATE</code>. This section should include standard boilerplate
code, such as the call to <code>AC_INIT</code> (which must be first),
<code>AM_INIT_AUTOMAKE</code>, <code>AC_CONFIG_HEADER</code>, and perhaps
<code>AC_REVISION</code><a rel="footnote" href="#fn-42" name="fnd-42"><sup>42</sup></a>.

               <li><code>AC_OPTIONS</code>. The next section should include macros which add
command-line options to configure, such as <code>AC_ARG_ENABLE</code>. It is
typical to put support code for the option in this section as well, if
it is short enough, like this example from libgcj:

               <pre class="example">                    AC_ARG_ENABLE(getenv-properties,
                    [  --disable-getenv-properties
                    don't set system properties from GCJ_PROPERTIES])
                    
                    dnl Whether GCJ_PROPERTIES is used depends on the target.
                    if test -n $enable_getenv_properties; then
                    enable_getenv_properties=${enable_getenv_properties_default-yes}
                    fi
                    if test $enable_getenv_properties = no; then
                    AC_DEFINE(DISABLE_GETENV_PROPERTIES)
                    fi
               </pre>
               <li><code>AC_PROGRAMS</code>. Next it is traditional to check for programs that
are either needed by the configure process, the build process, or by
one of the programs being built. This usually involves calls to macros
like <code>AC_CHECK_PROG</code> and <code>AC_PATH_TOOL</code>.

               <li><code>AC_LIBRARIES</code>. Checks for libraries come before checks for other
objects visible to C (or C++, or anything else). This is necessary
because some other checks work by trying to link or run a program; by
checking for libraries first you ensure that the resulting programs
can be linked.

               <li><code>AC_HEADERS</code>. Next come checks for existence of headers.

               <li><code>AC_TYPEDEFS_AND_STRUCTURES</code>. We do checks for typedefs after
checking for headers for the simple reason that typedefs appear in
headers, and we need to know which headers we can use before we look
inside them.

               <li><code>AC_FUNCTIONS</code>. Finally we check for functions. These come last
because functions have dependencies on the preceding items: when
searching for functions, libraries are needed in order to correctly
link, headers are needed in order to find prototypes (this is
especially important for C++, which has stricter prototyping rules
than C), and typedefs are needed for those functions which use or
return types which are not built in.

               <li><code>AC_OUTPUT</code>. This is done by invoking AC_OUTPUT<a rel="footnote" href="#fn-43" name="fnd-43"><sup>43</sup></a>.

               </ol>

     </ul>

     <li><a name="index-ACINCLUDE_005fM4_002c-package-interface-318"></a><a name="index-ACINCLUDE_005fM4-319"></a><strong>ACINCLUDE_M4()</strong>. The file <samp><span class="file">acinclude.m4</span></samp> can be thought of as a kind of "library"
where one can place macro definitions that are used from code in
<samp><span class="file">configure.in</span></samp>. Just like the <code>CONFIGUE_IN()</code> interface
function adds code to the <samp><span class="file">configure.in</span></samp> file,
<code>ACINCLUDE_M4()</code> can be used to add code to <samp><span class="file">acinclude.m4</span></samp>.

          <ul>
<li><code>lines</code>. A list of strings, the lines which will appear in <samp><span class="file">acinclude.m4</span></samp>.

          <li><code>id</code>. String; the unique identifier of the code fragment. When Confix
instruments a package, each module contributes its <samp><span class="file">acinclude.m4</span></samp>
fragments to every module that uses it. At the end of the process, each
module contributes its fragments to the enclosing package which finally
writes <samp><span class="file">acinclude.m4</span></samp>. This way it is possible that the fragments
reach the package multiple times. The package sorts these out based on
their unique identifiers.

     </ul>

     <li><a name="index-package-name-320"></a><a name="index-NAME-321"></a><strong>NAME()</strong>. Set the package name.

     <p>Parameters:

          <ul>
<li><code>name</code>. String; the package name.

     </ul>

     <li><a name="index-package-version-322"></a><a name="index-VERSION-323"></a><strong>VERSION()</strong>. Set the package version.

     <p>Parameters:

          <ul>
<li><code>version</code>. String; the package version. Should be something like
'1.2.3'.

     </ul>

     <li><a name="index-EXTRA_005fDIST-324"></a><a name="index-EXTRA_005fDIST-325"></a><strong>EXTRA_DIST()</strong>. Add a filename to the <code>EXTRA_DIST</code>
variable of the package's <samp><span class="file">Makefile.am</span></samp>. You do this if you have
files in the package's toplevel directory that are not automatically
packaged by <samp><span class="command">make dist</span></samp>. See the Automake documentation for
more.

     <p>Parameters:

          <ul>
<li><code>filename</code>. String.

     </ul>

   </ul>

<div class="node">
<p><hr>
<a name="The-Configuration-File"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix C The Configuration File</h2>

<p>The configuration file (by default <samp><span class="file">~/.confix</span></samp>, though switchable
through the <samp><span class="option">--configfile=</span></samp> option) is a snippet of Python code
which is executed by Confix to determine parameters.

   <p>Confix supports the notion of so-called <em>profiles</em>. A profile is
a set of parameters you choose to be valid for one Confix run. We saw
an ad-hoc introduction of it in <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a>, where we only used one profile which contained the
<var>PREFIX</var> and <var>BUILDROOT</var> parameters. This saved us from having
to specify the options <samp><span class="option">--prefix</span></samp> and <samp><span class="option">--builddir</span></samp> every
time we called Confix.

   <p>There is a bit more to it:

     <ul>
<li>The file can arbitrary Python code. You can even format your harddrive
if you want.

     <li>The <var>PROFILES</var> dictionary can contain an arbitrary number of
profiles.

   </ul>

   <p>Confix's entry point into the configuration is the <var>PROFILES</var>
dictionary. This dictionary contains entries of the form,

<pre class="example">     profile-name: profile
</pre>
   <p>where <var>profile-name</var> is a string, and <var>profile</var> is a reference
to a dictionary which contains the parameter set for that profile. You
should define a profile whose name is <code>'default'</code> in case you
intend to call Confix without the <samp><span class="option">--profile</span></samp> option. In this
case the <code>'default'</code> profile is selected; otherwise, if there is
no <code>'default'</code> profile, Confix flags an error.

   <p>A profile dictionary can contain the following entries. Whenever there
is a corresponding commandline option, the profile entry is overridden
by that option's value. Tilde and environment variable expansion is
performed on every value which is a path name.

     <ul>
<li><code>'PREFIX'</code>: a string containing the path name of the directory
where installation takes place. Same as the <samp><span class="option">--prefix</span></samp> option.

     <li><code>'BUILDROOT'</code>: a string containing the path name of the directory
where we use to compile our packages. Same as the <samp><span class="option">--buildroot</span></samp>
option.

     <li><a name="index-Libtool-326"></a><a name="index-shared-libraries_002c-and-Libtool-327"></a><a name="index-libraries_002c-shared_002c-Libtool-328"></a><code>'USE_LIBTOOL</code>: a boolean flag, can be 0 or 1 (or left
unspecified, of course). If you specify this flag, output will be
generated that makes use of Libtool. This means that building
libraries is done by Libtool, and, depending on the support of Libtool
for the target architecture, either shared or static libraries, or
both, will be built. By default this is switched off, and output is
generated that builds plain archives, without Libtool. This parameter
is overridden by the <samp><span class="option">--use-libtool</span></samp> option.

     <li><code>'CONFIGURE'</code>: a dictionary containing the commandline arguments
and environment variables which are passed to <samp><span class="command">configure</span></samp>
invocations.

          <ul>
<li><code>'ENV'</code>: a dictionary with string-to-string mappings which define
the environment. Confix executes <samp><span class="command">configure</span></samp> with an
environment which is as clean as possible, and which is fills with the
contents of this environment dictionary. A common application of a
custom environment is passing the <var>CC</var>, <var>CFLAGS</var>, <var>CXX</var>
and <var>CXXFLAGS</var> to set a custom compiler and associated flags, for
example.

          <p><code>'ARGS'</code>: a list of strings which are passed to
<samp><span class="command">configure</span></samp> as command line parameters. Confix arranges to add
the <samp><span class="option">--prefix</span></samp> to the command line, from its own <var>prefix</var>
setting.

     </ul>

     <li><code>'MAKE'</code>: a dictionary containing the commandline arguments and
environment variables which are passed to <samp><span class="command">configure</span></samp>
invocations. Its contents and their handling are exactly the same as
with the <code>'CONFIGURE'</code> profile entry.

   </ul>

   <p>What follows is a sample <samp><span class="file">.confix</span></samp> file containing two different
profiles which are hooked into the global <var>PROFILES</var>
dictionary. The purpose of the profiles is to define two sets of
parameters for compilation of two different branches of the same
source code base. Note that this is only an example; you could use
custom profiles to compile the same source code into two different
location with two different compilers, for example, if you want to try
out if your Autoconf checks work ok. Whatever comes to mind is valid.

<pre class="example">     main_conf = {
     
         'PREFIX': '~/wxpackages/main',
         'BUILDROOT': '~/compile/main',
     
         'CONFIGURE': {
     
            'ENV': {
               'CC': '/usr/local/gcc-2.95.2.1/bin/gcc',
               'CXX': '/usr/local/gcc-2.95.2.1/bin/g++',
               'CFLAGS': "-g -O0 -Wall -DWXDEBUG",
               'CXXFLAGS': "-g -O0 -Wall -DWXDEBUG",
               },
     
            'ARGS':
              ['--with-ext-XERCESC=/usr/local/xercesc-1.7.0-gcc-2.95.2.1',
               '--with-ext-MICO=/usr/local/mico-ccm-020124.gcc-2.95.2.1']
     
            },
     
         'MAKE': {
     
            }
         }
</pre>
   <pre class="example">     read_conf = {
     
         'PREFIX': '~/wxpackages/read',
         'BUILDROOT': '~/compile/read',
     
         'CONFIGURE': {
     
            'ENV': {
               'CC': '/usr/local/gcc-2.95.2.1/bin/gcc',
               'CXX': '/usr/local/gcc-2.95.2.1/bin/g++',
               'CFLAGS': "-g -O0 -Wall -DWXDEBUG",
               'CXXFLAGS': "-g -O0 -Wall -DWXDEBUG",
               },
     
            },
     
         'MAKE': {
     
            }
         }
</pre>
   <pre class="example">     PROFILES = {
         'default': main_conf,
         'main': main_conf,
         'read': read_conf
         }
</pre>
   <div class="node">
<p><hr>
<a name="Frequently-Asked-Questions"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#The-Sample-Utilities-Package">The Sample Utilities Package</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Configuration-File">The Configuration File</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix D Frequently Asked Questions</h2>

<ul class="menu">
<li><a accesskey="1" href="#When-should-I-bootstrap-my-package_003f">When should I bootstrap my package?</a>
<li><a accesskey="2" href="#What-should-I-do-when-the-Autotools-bail-out_003f">What should I do when the Autotools bail out?</a>
</ul>

<div class="node">
<p><hr>
<a name="When-should-I-bootstrap-my-package%3f"></a>
<a name="When-should-I-bootstrap-my-package_003f"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-should-I-do-when-the-Autotools-bail-out_003f">What should I do when the Autotools bail out?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">D.1 When should I bootstrap my package?</h3>

<p>You need to bootstrap your package if one or more of the following is
true.

     <ul>
<li>You never bootstrapped your package before.

     <li>You modified any of the <samp><span class="file">Makefile.py</span></samp> files in the package

     <li>You introduced a new dependency in a module of the package. Commonly
this is the case when you added a <code>#include</code> line which includes
a header file from another module. You only need to re-bootstrap if
this is a new dependency &mdash; that is, if no file of the module
included a file of the other module before.

     <li>You added a source file.

     <li>You removed a source file.

     <li>You are unclear if you should re-bootstrap your package.

   </ul>

<div class="node">
<p><hr>
<a name="What-should-I-do-when-the-Autotools-bail-out%3f"></a>
<a name="What-should-I-do-when-the-Autotools-bail-out_003f"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#When-should-I-bootstrap-my-package_003f">When should I bootstrap my package?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h3 class="appendixsec">D.2 What should I do when the Autotools bail out?</h3>

<p>It's hard to say what to do when you see an error that comes from one
of the Autotools. I suggest you take the error message, launch your
pattern matching engine now, and skim through the following list.

     <ul>
<li><a name="index-AM_005fCONFIG_005fHEADER-329"></a><a name="index-AC_005fCONFIG_005fHEADER-330"></a><a name="index-WANT_005fAUTOMAKE-331"></a><code>configure.in: 20: `automake requires `AM_CONFIG_HEADER', not
`AC_CONFIG_HEADER'</code>

     <p>You are using an old automake version, probably 1.5 or even
earlier. Upgrade automake to at least 1.7.

     <p>Some Linux distribution come with two different versions
installed. These are named, for example, <code>automake-1.5</code> and
<code>automake-1.8</code> A wrapper script named <code>automake</code> examines
the package that is being bootstrapped and dispatches the call to
either of the real programs, based on what it sees in the
packages. Ugly, ugly, but it appears to work most of the time. When it
does not work &mdash; which is why you see the error &mdash; you have to
explicitly demand a particular version. You do this by setting an
environment variable,

     <pre class="example">          $ export WANT_AUTOMAKE=1.8
     </pre>
     </ul>

<div class="node">
<p><hr>
<a name="The-Sample-Utilities-Package"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Concept-Index">Concept Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix E The Sample Utilities Package</h2>

<p>The <code>wx-utils</code> package contains a few helpful things that my
co-workers and me use in daily work. Although it is maintained
independently, it serves as a pool of examples that we can refer to
from this manual. Here's a brief explanation of what's in there,
module by module.

     <ul>
<li><samp><span class="file">code</span></samp>. A loose collection of small coding utilities, such as

          <ul>
<li>A smart-pointer template class.

          <li>A debug macro, with configurable debug levels.

          <li>Link time assertion macros. See <samp><span class="file">wx-utils/code/linkassert.h</span></samp> for
more.

          <li>Macros for alignment calculation, <code>extern "C"</code> declarations, etc.

     </ul>

     <li><samp><span class="file">error</span></samp>. An error class, ready to be thrown as exception. Errors
can be nested: you catch an exception that is of type <code>Error</code> or
some derived type, wrap it into your own <code>Error</code> type or even an
object of the base class, and throw that object to your caller. This
way you get a trace of errors. There are also macros available which
make throwing and wrapping more comfortable.

     <li><samp><span class="file">threads</span></samp>. Several threading utilities, such as mutex and
condition variable classes. They are only thin wrappers around
threading primitives of the operating system, and are supposed to use
external library definitions in other modules. The
<samp><span class="file">wx-utils/ext-pthread</span></samp> module is an example.

     <li><samp><span class="file">txn</span></samp>. Classes that help coordinate database transactions in a
clean way. The design is stolen from the Object Transaction Service
(OTS) of the Object Management Group (OMG). We do not coordinate
distributed transactions however, but only transactions in the same
address space as the objects that use them (which is hard enough
though).

     <li><samp><span class="file">types</span></samp>. A framework that makes it possible to have polymorphical
value objects which have a type associated with them. The framework
looks like (a small subset of) CORBA's Dynamic Any suite, in that the
struct and enumeration types can be used just like CORBA's typecodes
for <code>DynStruct</code> and <code>DynEnum</code>.

   </ul>

<div class="node">
<p><hr>
<a name="Concept-Index"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-Index">Function Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#The-Sample-Utilities-Package">The Sample Utilities Package</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="unnumbered">Concept Index</h2>

<ul class="index-cp" compact>
<li><a href="#index-g_t_0040option_007b_002d_002dadvanced_007d-226"><samp><span class="option">--advanced</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dbootstrap_007d-222"><samp><span class="option">--bootstrap</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dbootstrap_007d-212"><samp><span class="option">--bootstrap</span></samp></a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dbuilddir_007d-236"><samp><span class="option">--builddir</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dbuildroot_007d-235"><samp><span class="option">--buildroot</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dconfigfile_007d-227"><samp><span class="option">--configfile</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dconfigure_007d-223"><samp><span class="option">--configure</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002ddebug_007d-242"><samp><span class="option">--debug</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dhelp_007d-213"><samp><span class="option">--help</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dmake_007d-224"><samp><span class="option">--make</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002doutput_007d-221"><samp><span class="option">--output</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002doutput_007d-211"><samp><span class="option">--output</span></samp></a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dpackagename_007d-231"><samp><span class="option">--packagename</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dpackageroot_007d-230"><samp><span class="option">--packageroot</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dpackageroot_007d-219"><samp><span class="option">--packageroot</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dpackageversion_007d-233"><samp><span class="option">--packageversion</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dprefix_007d-229"><samp><span class="option">--prefix</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dprefix_007d-53"><samp><span class="option">--prefix</span></samp></a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dprefix_007d-9"><samp><span class="option">--prefix</span></samp></a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dprofile_007d-228"><samp><span class="option">--profile</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002drepository_007d-234"><samp><span class="option">--repository</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002drepository_007d-220"><samp><span class="option">--repository</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dresolve_007d-214"><samp><span class="option">--resolve</span></samp></a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dtargets_007d-240"><samp><span class="option">--targets</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dtargets_007d-58"><samp><span class="option">--targets</span></samp></a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-g_t_0040option_007b_002d_002dtrace_007d-241"><samp><span class="option">--trace</span></samp></a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-g_t_0040file_007b_002econfix_007d-42"><samp><span class="file">.confix</span></samp></a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-g_t_0040emph_007bbuildable_007d-interface-166"><em>buildable</em> interface</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-g_t_0040code_007bAC_005fDEFINE_007d-261"><code>AC_DEFINE</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-action-names-208">action names</a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-action_002c-dependency-209">action, dependency</a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-archive-104">archive</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-g_t_0040code_007bautoconf_007d-1"><code>autoconf</code></a>: <a href="#Prerequisites">Prerequisites</a></li>
<li><a href="#index-Autoconf-checks-187">Autoconf checks</a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-Autoconf-checks-161">Autoconf checks</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-Autoconf-checks-91">Autoconf checks</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-Autoconf-checks-74">Autoconf checks</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-Autoconf_002c-and-third-party-code-188">Autoconf, and third party code</a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-g_t_0040code_007bautomake_007d-2"><code>automake</code></a>: <a href="#Prerequisites">Prerequisites</a></li>
<li><a href="#index-automatic-testing_002c-with-Confix-170">automatic testing, with Confix</a>: <a href="#Performing-Automatic-Tests">Performing Automatic Tests</a></li>
<li><a href="#index-automatisms_002c-and-flexibility-96">automatisms, and flexibility</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-availability_002c-of-modules-263">availability, of modules</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-bootstrapping-31">bootstrapping</a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-Bourne-shell-38">Bourne shell</a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-build-order-157">build order</a>: <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a></li>
<li><a href="#index-build-order-101">build order</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-build-order-90">build order</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-build-order_002c-and-depth-first-traversal-201">build order, and depth first traversal</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-build-order_002c-restriction-160">build order, restriction</a>: <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a></li>
<li><a href="#index-build-process-12">build process</a>: <a href="#What-Confix-Adds-to-the-Autotools">What Confix Adds to the Autotools</a></li>
<li><a href="#index-buildable-70">buildable</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-buildable_002c-interface-functions-290">buildable, interface functions</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-building-a-package-49">building a package</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-g_t_0040var_007bBUILDROOT_007d_002c-_0040file_007b_002econfix_007d-57"><var>BUILDROOT</var>, <samp><span class="file">.confix</span></samp></a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-g_t_0040var_007bBUILDROOT_007d_002c-_0040file_007b_002econfix_007d-47"><var>BUILDROOT</var>, <samp><span class="file">.confix</span></samp></a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-C-114">C</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-C_002b_002b-115">C++</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-C_002b_002b_002c-and-Libtool-205">C++, and Libtool</a>: <a href="#Using-GNU-Libtool">Using GNU Libtool</a></li>
<li><a href="#index-C_002b_002b_002c-GCC_002c-and-Libtool-206">C++, GCC, and Libtool</a>: <a href="#Using-GNU-Libtool">Using GNU Libtool</a></li>
<li><a href="#index-calling-convention_002c-of-interface-functions-243">calling convention, of interface functions</a>: <a href="#Interfaces-for-Coder-and-Maintainer">Interfaces for Coder and Maintainer</a></li>
<li><a href="#index-checks_002c-and-Confix-164">checks, and Confix</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-checks_002c-and-source-code-167">checks, and source code</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-checks_002c-Autoconf-186">checks, Autoconf</a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-checks_002c-Autoconf-162">checks, Autoconf</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-checks_002c-Autoconf-92">checks, Autoconf</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-checks_002c-Autoconf-73">checks, Autoconf</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-checks_002c-ordering-of-84">checks, ordering of</a>: <a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks --- The Autoconf Way of Portability</a></li>
<li><a href="#index-checks_002c-programming-with-163">checks, programming with</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-commandline-arguments-207">commandline arguments</a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-g_t_0040var_007bcompile_002dcommand_007d_002c-in-Emacs-60"><var>compile-command</var>, in Emacs</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-compiling-source-files-103">compiling source files</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-configuration-file-41">configuration file</a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-configuration-profile-45">configuration profile</a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-g_t_0040command_007bconfigure_007d-52"><samp><span class="command">configure</span></samp></a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-g_t_0040command_007bconfigure_007d-33"><samp><span class="command">configure</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040code_007bconfigure_007d-7"><code>configure</code></a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d-32"><samp><span class="file">configure.in</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d-22"><samp><span class="file">configure.in</span></samp></a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-317"><samp><span class="file">configure.in</span></samp>, ordering of code</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-293"><samp><span class="file">configure.in</span></samp>, ordering of code</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-248"><samp><span class="file">configure.in</span></samp>, ordering of code</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-g_t_0040file_007bconfigure_002ein_007d_002c-ordering-of-code-194"><samp><span class="file">configure.in</span></samp>, ordering of code</a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-contributing-checks-76">contributing checks</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-contributing_002c-to-a-module_0027s-properties-75">contributing, to a module's properties</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-dependencies_002c-inter_002dpackage-29">dependencies, inter-package</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-dependency-graph-77">dependency graph</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-dependency-resolving-78">dependency resolving</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-dependent-actions-210">dependent actions</a>: <a href="#Options-and-Parameters">Options and Parameters</a></li>
<li><a href="#index-depth-first-traversal_002c-build-order-200">depth first traversal, build order</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-description-file_002c-module-176">description file, module</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-description-file_002c-module-86">description file, module</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-description-file_002c-module-81">description file, module</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-description-file_002c-module-65">description file, module</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-description-file_002c-module-55">description file, module</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-description-file_002c-of-a-module-25">description file, of a module</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-directory_002c-instrumenting-15">directory, instrumenting</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-distribution_002c-source-5">distribution, source</a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-Emacs_002c-_0040var_007bcompile_002dcommand_007d-59">Emacs, <var>compile-command</var></a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-executable-109">executable</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-executable-name-129">executable name</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-extension_002c-of-filenames-113">extension, of filenames</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-external-libraries-173">external libraries</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-file-properties_002c-buildable-interface-297">file properties, buildable interface</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-file-suffixes-111">file suffixes</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-filenames-110">filenames</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-guessing_002c-installation-directories-from-namespaces-154">guessing, installation directories from namespaces</a>: <a href="#Namespaces">Namespaces</a></li>
<li><a href="#index-header-files-63">header files</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-header-files_002c-installing-284">header files, installing</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-header-files_002c-installing-147">header files, installing</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-header-files_002c-private-150">header files, private</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-header-files_002c-public-149">header files, public</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-include-path-88">include path</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-install-directory-146">install directory</a>: <a href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a></li>
<li><a href="#index-install-directory-100">install directory</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-installation-directory_002c-and-header-files-285">installation directory, and header files</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-installation-location-145">installation location</a>: <a href="#Installation-_002d_002d_002d-Going-Public">Installation --- Going Public</a></li>
<li><a href="#index-installation-location-99">installation location</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-installation_002c-of-header-files-61">installation, of header files</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-installation_002c-of-libraries-62">installation, of libraries</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-installing-header-files-148">installing header files</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-instrumented-package-21">instrumented package</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-instrumenting-16">instrumenting</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-inter_002dpackage-dependencies-30">inter-package dependencies</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-interface-functions_002c-buildable-289">interface functions, buildable</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-interface-functions_002c-module-244">interface functions, module</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-interface-functions_002c-package-311">interface functions, package</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-interface-functions_002c-toplevel-313">interface functions, toplevel</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-interface_002c-_0040emph_007bbuildable_007d-165">interface, <em>buildable</em></a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-Lex-116">Lex</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-Lex_002c-and-C_002b_002b-117">Lex, and C++</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-libraries_002c-external-174">libraries, external</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-libraries_002c-shared_002c-Libtool-328">libraries, shared, Libtool</a>: <a href="#The-Configuration-File">The Configuration File</a></li>
<li><a href="#index-libraries_002c-shared_002c-Libtool-239">libraries, shared, Libtool</a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-libraries_002c-third-party-172">libraries, third party</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-library-name-271">library name</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-library-name-134">library name</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-library_002c-shared-108">library, shared</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-library_002c-static-107">library, static</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-Libtool-326">Libtool</a>: <a href="#The-Configuration-File">The Configuration File</a></li>
<li><a href="#index-Libtool-237">Libtool</a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-Libtool-203">Libtool</a>: <a href="#Using-GNU-Libtool">Using GNU Libtool</a></li>
<li><a href="#index-Libtool-124">Libtool</a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-link-line-89">link line</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-M4-8">M4</a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-maintainer_002c-of-a-package-10">maintainer, of a package</a>: <a href="#What-Confix-Adds-to-the-Autotools">What Confix Adds to the Autotools</a></li>
<li><a href="#index-g_t_0040command_007bmake_007d-39"><samp><span class="command">make</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040code_007bmake_007d-4"><code>make</code></a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-g_t_0040command_007bmake-dist_007d-202"><samp><span class="command">make dist</span></samp></a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-g_t_0040command_007bmake-dist_007d-68"><samp><span class="command">make dist</span></samp></a>: <a href="#Distributing-the-Package">Distributing the Package</a></li>
<li><a href="#index-g_t_0040file_007bMakefile_002eam_007d-34"><samp><span class="file">Makefile.am</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040file_007bMakefile_002eam_007d-23"><samp><span class="file">Makefile.am</span></samp></a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-g_t_0040file_007bMakefile_002ein_007d-35"><samp><span class="file">Makefile.in</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040file_007bMakefile_002epy_007d-14"><samp><span class="file">Makefile.py</span></samp></a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-module-20">module</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-module-availability-262">module availability</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-module-description-218">module description</a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-module-description-file-175">module description file</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-module-description-file-85">module description file</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-module-description-file-80">module description file</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-module-description-file-64">module description file</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-module-description-file-54">module description file</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-module-description-file-24">module description file</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-module-properties-138">module properties</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-module-properties-27">module properties</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-module_002c-interface-functions-245">module, interface functions</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-name_002c-of-a-library-270">name, of a library</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-name_002c-of-a-library-133">name, of a library</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-name_002c-of-an-executable-128">name, of an executable</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-namespaces_002c-and-_0040code_007b_0023include_007d-153">namespaces, and <code>#include</code></a>: <a href="#Namespaces">Namespaces</a></li>
<li><a href="#index-open-source-67">open source</a>: <a href="#Distributing-the-Package">Distributing the Package</a></li>
<li><a href="#index-order_002c-of-build-158">order, of build</a>: <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a></li>
<li><a href="#index-order_002c-of-build-102">order, of build</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-ordering_002c-of-Autoconf-checks-83">ordering, of Autoconf checks</a>: <a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">Checks --- The Autoconf Way of Portability</a></li>
<li><a href="#index-package-17">package</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-package-depth-199">package depth</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-package-maintainer-50">package maintainer</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-package-maintainer-11">package maintainer</a>: <a href="#What-Confix-Adds-to-the-Autotools">What Confix Adds to the Autotools</a></li>
<li><a href="#index-package-name-320">package name</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-package-name-232">package name</a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-package-name-69">package name</a>: <a href="#Distributing-the-Package">Distributing the Package</a></li>
<li><a href="#index-package-name-19">package name</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-package-root-18">package root</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-package-structure_002c-restriction-197">package structure, restriction</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-package-user-51">package user</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-package-version-314">package version</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-package_002c-interface-functions-310">package, interface functions</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-package_002c-raw-source-13">package, raw source</a>: <a href="#The-Raw-Source">The Raw Source</a></li>
<li><a href="#index-parameters-225">parameters</a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-portability_002c-Bourne-shell-36">portability, Bourne shell</a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-portability_002c-_0040command_007bmake_007d-37">portability, <samp><span class="command">make</span></samp></a>: <a href="#Bootstrapping-the-Package">Bootstrapping the Package</a></li>
<li><a href="#index-g_t_0040var_007bPREFIX_007d_002c-_0040file_007b_002econfix_007d-48"><var>PREFIX</var>, <samp><span class="file">.confix</span></samp></a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-private-header-files-152">private header files</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-profile_002c-configuration-44">profile, configuration</a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-g_t_0040var_007bPROFILES_007d_002c-_0040file_007b_002econfix_007d-46"><var>PROFILES</var>, <samp><span class="file">.confix</span></samp></a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-properties-of-a-module-26">properties of a module</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-properties_002c-of-modules-139">properties, of modules</a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-properties_002c-of-source-files-298">properties, of source files</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-properties_002c-of-source-files-282">properties, of source files</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-properties_002c-of-source-files-120">properties, of source files</a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-provide-215">provide</a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-provide-178">provide</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-provide-72">provide</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-provide-object_002c-symbolic-252">provide object, symbolic</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-provide-object_002c-symbolic-179">provide object, symbolic</a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-public-header-files-151">public header files</a>: <a href="#What-Goes-Public">What Goes Public</a></li>
<li><a href="#index-Python-185">Python</a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-Python-43">Python</a>: <a href="#The-Configuration-File-_0028Short-Introduction_0029">The Configuration File (Short Introduction)</a></li>
<li><a href="#index-Python-28">Python</a>: <a href="#Instrumenting-the-Package">Instrumenting the Package</a></li>
<li><a href="#index-Python-3">Python</a>: <a href="#Prerequisites">Prerequisites</a></li>
<li><a href="#index-repository_002c-of-module-description-files-177">repository, of module description files</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-repository_002c-of-module-description-files-87">repository, of module description files</a>: <a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">Module Repository --- Inter-Package Knowledge Transfer</a></li>
<li><a href="#index-repository_002c-of-module-description-files-82">repository, of module description files</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-repository_002c-of-module-description-files-66">repository, of module description files</a>: <a href="#Installing-the-Package">Installing the Package</a></li>
<li><a href="#index-repository_002c-of-module-description-files-56">repository, of module description files</a>: <a href="#Building-the-Package">Building the Package</a></li>
<li><a href="#index-repository_002c-of-module-descriptions-217">repository, of module descriptions</a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-require-216">require</a>: <a href="#Actions">Actions</a></li>
<li><a href="#index-require-71">require</a>: <a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">Scanning --- Gathering the Pieces</a></li>
<li><a href="#index-require-object_002c-symbolic-307">require object, symbolic</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-require-object_002c-symbolic-256">require object, symbolic</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-require-object_002c-symbolic-183">require object, symbolic</a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-resolving_002c-dependencies-306">resolving, dependencies</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-resolving_002c-dependencies-79">resolving, dependencies</a>: <a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">Resolving --- Determining the Build Order</a></li>
<li><a href="#index-restriction_002c-build-order-159">restriction, build order</a>: <a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">Build Order --- How Things Can Easily Go Wrong</a></li>
<li><a href="#index-restriction_002c-namespace-155">restriction, namespace</a>: <a href="#Restrictions">Restrictions</a></li>
<li><a href="#index-restriction_002c-package-structure-198">restriction, package structure</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-restrictions_002c-imposed-on-the-maintainer-98">restrictions, imposed on the maintainer</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-rule_002c-restrictions_002c-for-the-maintainer-97">rule, restrictions, for the maintainer</a>: <a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a></li>
<li><a href="#index-shared-libraries_002c-and-Libtool-327">shared libraries, and Libtool</a>: <a href="#The-Configuration-File">The Configuration File</a></li>
<li><a href="#index-shared-libraries_002c-and-Libtool-238">shared libraries, and Libtool</a>: <a href="#Parameters">Parameters</a></li>
<li><a href="#index-shared-library-123">shared library</a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-shared-library-106">shared library</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-shared-library_002c-and-Libtool-204">shared library, and Libtool</a>: <a href="#Using-GNU-Libtool">Using GNU Libtool</a></li>
<li><a href="#index-source-code_002c-and-checks-168">source code, and checks</a>: <a href="#Explicitly-Adding-Checks">Explicitly Adding Checks</a></li>
<li><a href="#index-source-distribution-6">source distribution</a>: <a href="#A-Short-Autotools-Introduction">A Short Autotools Introduction</a></li>
<li><a href="#index-source-file-properties-299">source file properties</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-source-file-properties-281">source file properties</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-source-file-properties-121">source file properties</a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-static-library-122">static library</a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-static-library-105">static library</a>: <a href="#What-Will-Be-Built">What Will Be Built</a></li>
<li><a href="#index-structure_002c-of-the-package-196">structure, of the package</a>: <a href="#Restrictions-Imposed-on-the-Package-Structure">Restrictions Imposed on the Package Structure</a></li>
<li><a href="#index-suffixes_002c-of-filenames-112">suffixes, of filenames</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-symbolic-provide-object-253">symbolic provide object</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-symbolic-provide-object-180">symbolic provide object</a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-symbolic-require-object-308">symbolic require object</a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-symbolic-require-object-257">symbolic require object</a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-symbolic-require-object-184">symbolic require object</a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-testing_002c-with-Confix-169">testing, with Confix</a>: <a href="#Performing-Automatic-Tests">Performing Automatic Tests</a></li>
<li><a href="#index-third-party-libraries-171">third party libraries</a>: <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a></li>
<li><a href="#index-toplevel_002c-interface-functions-312">toplevel, interface functions</a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-Yacc-118">Yacc</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
<li><a href="#index-Yacc_002c-and-C_002b_002b-119">Yacc, and C++</a>: <a href="#Building-Source-Files">Building Source Files</a></li>
   </ul><div class="node">
<p><hr>
<a name="Function-Index"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="#Variable-Index">Variable Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concept-Index">Concept Index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="unnumbered">Function Index</h2>



<ul class="index-fn" compact>
<li><a href="#index-AC_005fCONFIG_005fHEADER-330"><code>AC_CONFIG_HEADER</code></a>: <a href="#What-should-I-do-when-the-Autotools-bail-out_003f">What should I do when the Autotools bail out?</a></li>
<li><a href="#index-AC_005fDEFINE-260"><code>AC_DEFINE</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-AC_005fSUBST-192"><code>AC_SUBST</code></a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-ACINCLUDE_005fM4-319"><code>ACINCLUDE_M4</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-ACINCLUDE_005fM4-295"><code>ACINCLUDE_M4</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-ACINCLUDE_005fM4-250"><code>ACINCLUDE_M4</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-ACINCLUDE_005fM4_002c-buildable-interface-294"><code>ACINCLUDE_M4, buildable interface</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-ACINCLUDE_005fM4_002c-module-interface-249"><code>ACINCLUDE_M4, module interface</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-ACINCLUDE_005fM4_002c-package-interface-318"><code>ACINCLUDE_M4, package interface</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-AM_005fCONFIG_005fHEADER-329"><code>AM_CONFIG_HEADER</code></a>: <a href="#What-should-I-do-when-the-Autotools-bail-out_003f">What should I do when the Autotools bail out?</a></li>
<li><a href="#index-AM_005fPATH_005fPYTHON-191"><code>AM_PATH_PYTHON</code></a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-CONFIGURE_005fIN-316"><code>CONFIGURE_IN</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-CONFIGURE_005fIN-292"><code>CONFIGURE_IN</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-CONFIGURE_005fIN-247"><code>CONFIGURE_IN</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-CONFIGURE_005fIN-193"><code>CONFIGURE_IN</code></a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-CONFIGURE_005fIN-182"><code>CONFIGURE_IN</code></a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-CONFIGURE_005fIN_002c-buildable-interface-291"><code>CONFIGURE_IN, buildable interface</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-CONFIGURE_005fIN_002c-module-interface-246"><code>CONFIGURE_IN, module interface</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-CONFIGURE_005fIN_002c-package-interface-315"><code>CONFIGURE_IN, package interface</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-EXENAME-304"><code>EXENAME</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-EXENAME_002c-buildable-interface-131"><code>EXENAME, buildable interface</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-EXTERNAL_005fLIBRARY-264"><code>EXTERNAL_LIBRARY</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-EXTERNAL_005fLIBRARY2-189"><code>EXTERNAL_LIBRARY2</code></a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-EXTRA_005fDIST-324"><code>EXTRA_DIST</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-EXTRA_005fDIST-287"><code>EXTRA_DIST</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-FEATURE_005fMACRO-259"><code>FEATURE_MACRO</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-FILE_005fPROPERTIES-132"><code>FILE_PROPERTIES</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-FILE_005fPROPERTIES-127"><code>FILE_PROPERTIES</code></a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-FILE_005fPROPERTIES_002c-buildable-interface-296"><code>FILE_PROPERTIES, buildable interface</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-FILE_005fPROPERTIES_002c-module-interface-280"><code>FILE_PROPERTIES, module interface</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-IGNORE_005fFILE-269"><code>IGNORE_FILE</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-INSTALLDIR_005fH-283"><code>INSTALLDIR_H</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-INSTALLDIR_005fH-156"><code>INSTALLDIR_H</code></a>: <a href="#Restrictions">Restrictions</a></li>
<li><a href="#index-LIBNAME-142"><code>LIBNAME</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-LIBNAME_002c-module-interface-273"><code>LIBNAME, module interface</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-LIBNAME_002c-module-interface-136"><code>LIBNAME, module interface</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-MAIN-303"><code>MAIN</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-MAIN_002c-buildable-interface-126"><code>MAIN, buildable interface</code></a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-MAKEFILE_005fAM-286"><code>MAKEFILE_AM</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-MODULE_005fPROPERTIES-274"><code>MODULE_PROPERTIES</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-MODULE_005fPROPERTIES-137"><code>MODULE_PROPERTIES</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-NAME-321"><code>NAME</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-PROVIDE_005fH-251"><code>PROVIDE_H</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-PROVIDE_005fH-190"><code>PROVIDE_H</code></a>: <a href="#A-More-Complicated-External-Module">A More Complicated External Module</a></li>
<li><a href="#index-PROVIDE_005fSYMBOL-254"><code>PROVIDE_SYMBOL</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-PROVIDE_005fSYMBOL-181"><code>PROVIDE_SYMBOL</code></a>: <a href="#A-Simple-External-Module">A Simple External Module</a></li>
<li><a href="#index-REQUIRE_005fH-305"><code>REQUIRE_H</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-REQUIRE_005fH-255"><code>REQUIRE_H</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-REQUIRE_005fSYMBOL-309"><code>REQUIRE_SYMBOL</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-REQUIRE_005fSYMBOL-258"><code>REQUIRE_SYMBOL</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-VERSION-323"><code>VERSION</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
   </ul><div class="node">
<p><hr>
<a name="Variable-Index"></a>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-Index">Function Index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="unnumbered">Variable Index</h2>



<ul class="index-vr" compact>
<li><a href="#index-EXENAME_002c-source-file-property-301"><code>EXENAME, source file property</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-EXENAME_002c-source-file-property-130"><code>EXENAME, source file property</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-EXTRA_005fDIST-325"><code>EXTRA_DIST</code></a>: <a href="#The-Toplevel-Makefile_002epy-Interface">The Toplevel Makefile.py Interface</a></li>
<li><a href="#index-EXTRA_005fDIST-288"><code>EXTRA_DIST</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-LIBNAME-143"><code>LIBNAME</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-LIBNAME_002c-module-property-272"><code>LIBNAME, module property</code></a>: <a href="#The-Module-Makefile_002epy-Interface">The Module Makefile.py Interface</a></li>
<li><a href="#index-LIBNAME_002c-module-property-135"><code>LIBNAME, module property</code></a>: <a href="#Generated-and-Explicit-Names">Generated and Explicit Names</a></li>
<li><a href="#index-MAIN_002c-source-file-property-300"><code>MAIN, source file property</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-MAIN_002c-source-file-property-125"><code>MAIN, source file property</code></a>: <a href="#Library-or-Executables_003f">Library or Executables?</a></li>
<li><a href="#index-PROVIDE_005fMODE_002c-source-file-property-302"><code>PROVIDE_MODE, source file property</code></a>: <a href="#The-Buildable-Interface">The Buildable Interface</a></li>
<li><a href="#index-WANT_005fAUTOMAKE-331"><code>WANT_AUTOMAKE</code></a>: <a href="#What-should-I-do-when-the-Autotools-bail-out_003f">What should I do when the Autotools bail out?</a></li>
   </ul>
<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Confix</a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<ul>
<li><a href="#Prerequisites">1.1 Prerequisites</a>
<li><a href="#How-To-Get-It">1.2 How To Get It</a>
<li><a href="#Installation">1.3 Installation</a>
<ul>
<li><a href="#Source-Distribution">1.3.1 Source Distribution</a>
<li><a href="#RPM-distribution">1.3.2 RPM distribution</a>
<li><a href="#Dumb-binary-distribution">1.3.3 Dumb binary distribution</a>
</li></ul>
<li><a href="#A-Short-Autotools-Introduction">1.4 A Short Autotools Introduction</a>
<li><a href="#What-Confix-Adds-to-the-Autotools">1.5 What Confix Adds to the Autotools</a>
</li></ul>
<li><a name="toc_An-Example" href="#An-Example">2 An Example</a>
<ul>
<li><a href="#The-Raw-Source">2.1 The Raw Source</a>
<li><a href="#Instrumenting-the-Package">2.2 Instrumenting the Package</a>
<li><a href="#Bootstrapping-the-Package">2.3 Bootstrapping the Package</a>
<li><a href="#The-Configuration-File-_0028Short-Introduction_0029">2.4 The Configuration File (Short Introduction)</a>
<li><a href="#Building-the-Package">2.5 Building the Package</a>
<li><a href="#Installing-the-Package">2.6 Installing the Package</a>
<li><a href="#Distributing-the-Package">2.7 Distributing the Package</a>
<li><a href="#Summary">2.8 Summary</a>
</li></ul>
<li><a name="toc_How-Confix-Works" href="#How-Confix-Works">3 How Confix Works</a>
<ul>
<li><a href="#Scanning-_002d_002d_002d-Gathering-the-Pieces">3.1 Scanning &mdash; Gathering the Pieces</a>
<li><a href="#Resolving-_002d_002d_002d-Determining-the-Build-Order">3.2 Resolving &mdash; Determining the Build Order</a>
<li><a href="#Checks-_002d_002d_002d-The-Autoconf-Way-of-Portability">3.3 Checks &mdash; The Autoconf Way of Portability</a>
<li><a href="#Module-Repository-_002d_002d_002d-Inter_002dPackage-Knowledge-Transfer">3.4 Module Repository &mdash; Inter-Package Knowledge Transfer</a>
</li></ul>
<li><a name="toc_The-Coders-Role-in-the-Build-Process" href="#The-Coders-Role-in-the-Build-Process">4 The Coder's Role in the Build Process</a>
<ul>
<li><a href="#What-Will-Be-Built">4.1 What Will Be Built, and How</a>
<ul>
<li><a href="#Building-Source-Files">4.1.1 Building Source Files</a>
<li><a href="#Library-or-Executables_003f">4.1.2 Library or Executables?</a>
<li><a href="#Generated-and-Explicit-Names">4.1.3 Generated and Explicit Names</a>
</li></ul>
<li><a href="#Installation-_002d_002d_002d-Going-Public">4.2 Installation &mdash; Going Public</a>
<ul>
<li><a href="#What-Goes-Public">4.2.1 What Goes Public</a>
<li><a href="#Namespaces">4.2.2 Namespaces and <code>#include</code></a>
<li><a href="#Installation-_002d_002d_002d-A-Short-Example">4.2.3 Installation &mdash; A Short Example</a>
<li><a href="#Restrictions">4.2.4 Restrictions</a>
</li></ul>
<li><a href="#Build-Order-_002d_002d_002d-How-Things-Can-Easily-Go-Wrong">4.3 Build Order &mdash; How Things Can Easily Go Wrong</a>
<li><a href="#Explicitly-Adding-Checks">4.4 Explicitly Adding Checks (and Programming with Them)</a>
<li><a href="#Performing-Automatic-Tests">4.5 Performing Automatic Tests</a>
<li><a href="#Using-Third-Party-Libraries">4.6 Using Third Party Libraries</a>
<ul>
<li><a href="#A-Simple-External-Module">4.6.1 A Simple External Module</a>
<li><a href="#A-More-Complicated-External-Module">4.6.2 A More Complicated External Module</a>
</li></ul>
<li><a href="#Restrictions-Imposed-on-the-Package-Structure">4.7 Restrictions Imposed on the Package Structure</a>
<li><a href="#Using-GNU-Libtool">4.8 Using GNU Libtool</a>
<ul>
<li><a href="#Objections-Against-Shared-Libraries">4.8.1 Objections Against Shared Libraries</a>
</li></ul>
<li><a href="#Summary-of-Rules-and-Restrictions">4.9 Summary of Rules and Restrictions</a>
</li></ul>
<li><a name="toc_The-Users-Role-in-the-Build-Process" href="#The-Users-Role-in-the-Build-Process">5 The User's Role in the Build Process</a>
<ul>
<li><a href="#Optionally-Building-and-Using-Modules">5.1 Optionally Building and Using Modules</a>
</li></ul>
<li><a name="toc_Options-and-Parameters" href="#Options-and-Parameters">Appendix A Options and Parameters</a>
<ul>
<li><a href="#Actions">A.1 Actions</a>
<li><a href="#Parameters">A.2 Parameters</a>
</li></ul>
<li><a name="toc_Interfaces-for-Coder-and-Maintainer" href="#Interfaces-for-Coder-and-Maintainer">Appendix B Interfaces for Coder and Maintainer</a>
<ul>
<li><a href="#The-Module-Makefile_002epy-Interface">B.1 The Module <samp><span class="file">Makefile.py</span></samp> Interface</a>
<li><a href="#The-Buildable-Interface">B.2 The Buildable Interface</a>
<li><a href="#The-Toplevel-Makefile_002epy-Interface">B.3 The Toplevel (Package) <samp><span class="file">Makefile.py</span></samp> Interface</a>
</li></ul>
<li><a name="toc_The-Configuration-File" href="#The-Configuration-File">Appendix C The Configuration File</a>
<li><a name="toc_Frequently-Asked-Questions" href="#Frequently-Asked-Questions">Appendix D Frequently Asked Questions</a>
<ul>
<li><a href="#When-should-I-bootstrap-my-package_003f">D.1 When should I bootstrap my package?</a>
<li><a href="#What-should-I-do-when-the-Autotools-bail-out_003f">D.2 What should I do when the Autotools bail out?</a>
</li></ul>
<li><a name="toc_The-Sample-Utilities-Package" href="#The-Sample-Utilities-Package">Appendix E The Sample Utilities Package</a>
<li><a name="toc_Concept-Index" href="#Concept-Index">Concept Index</a>
<li><a name="toc_Function-Index" href="#Function-Index">Function Index</a>
<li><a name="toc_Variable-Index" href="#Variable-Index">Variable Index</a>
</li></ul>
</div>

<div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Clearly this involves certain rules the source
code must adhere to. But read on.</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> Automake in turn
sits on top of another open source tool called Autoconf,
<a href="http://www.gnu.org/software/autoconf/">http://www.gnu.org/software/autoconf/</a>.</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> Downloading the tarball is simpler and faster. However
it will not match the documentation exactly because it contains
generated files. Checking out from source is what the documentation is
about because Confix is a maintainer tool. But the differences are
minor, and we will try to place hints wherever the tarball doesn't
match the documentation.</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> One reason for this obscurity is that Python 2 break
startup scripts such as <samp><span class="command">lpd</span></samp> which rely on Python (1.5)
scripts.</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> If you downloaded the tarball rather than checked it out
from CVS, then the directory structure is more cluttered. This is
because the tarball is fully instrumented by Confix and Automake, and
thus contains all the generated files that make up the
&ldquo;bootstrapped&rdquo; stage of the package.</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> That is, marshalled by the standard Python
<code>pickle</code> module.</p>

   <p class="footnote"><small>[<a name="fn-7" href="#fnd-7">7</a>]</small> You can specify a different file using the
<samp><span class="option">--configfile=</span></samp> option.</p>

   <p class="footnote"><small>[<a name="fn-8" href="#fnd-8">8</a>]</small> Remember, the primary goal of Confix is to
build most code automatically, without the package maintainer having
to write any build instructions, so that's the default behavior.</p>

   <p class="footnote"><small>[<a name="fn-9" href="#fnd-9">9</a>]</small> By default the repository is <samp><span class="file">$(prefix)/repo</span></samp>,
see also the description of <samp><span class="option">--repository</span></samp> in <a href="#Options-and-Parameters">Options and Parameters</a></p>

   <p class="footnote"><small>[<a name="fn-10" href="#fnd-10">10</a>]</small> Confix implements
a relationship between C++ namespaces and include directories, see
<a href="#The-Coders-Role-in-the-Build-Process">The Coders Role in the Build Process</a> for further explanation.</p>

   <p class="footnote"><small>[<a name="fn-11" href="#fnd-11">11</a>]</small> The process of flattening a
directed acyclic graph (DAG) this way is commonly called
<em>topological sort</em>.</p>

   <p class="footnote"><small>[<a name="fn-12" href="#fnd-12">12</a>]</small> If you consider
eliminating duplicate checks a feature: yes, this is done. Else we
would check for a C++ compiler as many times as there are C++ files in
a package, for example.</p>

   <p class="footnote"><small>[<a name="fn-13" href="#fnd-13">13</a>]</small> An example can be found in the <samp><span class="file">wx-utils</span></samp> package,
file <samp><span class="file">error/error.cc</span></samp>.</p>

   <p class="footnote"><small>[<a name="fn-14" href="#fnd-14">14</a>]</small> You can use the
<code>MAKEFILE_AM()</code> function in a module's <samp><span class="file">Makefile.py</span></samp> to pass
arbitrary code through to the generated <samp><span class="file">Makefile.am</span></samp>, but this
should be used with care.</p>

   <p class="footnote"><small>[<a name="fn-15" href="#fnd-15">15</a>]</small> This is Nov, 2002.</p>

   <p class="footnote"><small>[<a name="fn-16" href="#fnd-16">16</a>]</small> When we talk about C, we do not only mean plain C,
but also related languages like C++, or even Lex and Yacc which are
built by Automake just like C.</p>

   <p class="footnote"><small>[<a name="fn-17" href="#fnd-17">17</a>]</small> See <a href="#Using-GNU-Libtool">Using GNU Libtool</a> for
a more thorough explanation of what shared libraries are and how to
build them with Confix.</p>

   <p class="footnote"><small>[<a name="fn-18" href="#fnd-18">18</a>]</small> A third
choice is to complain to the author by filing a bug report (which you
should do even if you take one of the two former choices).</p>

   <p class="footnote"><small>[<a name="fn-19" href="#fnd-19">19</a>]</small> It is
even more likely that software which is built by Confix will use
software that is not built by Confix &mdash; see <a href="#Using-Third-Party-Libraries">Using Third Party Libraries</a> for more.</p>

   <p class="footnote"><small>[<a name="fn-20" href="#fnd-20">20</a>]</small> For the curious: we utilize Automake's
<code>all-local</code> hook target to create the namespace hierarchy of
include directories inside the build directory, and point the other
module's include path there. Look for directories named <samp><span class="file">include</span></samp>
under the package's build directory, after the package was compiled.</p>

   <p class="footnote"><small>[<a name="fn-21" href="#fnd-21">21</a>]</small> <code>HAVE_CONFIG_H</code> is
always defined and <code>1</code> when you use Confix, but it is good style
this way, I think.</p>

   <p class="footnote"><small>[<a name="fn-22" href="#fnd-22">22</a>]</small> A check can have more side effects
than just defining one simple macro.</p>

   <p class="footnote"><small>[<a name="fn-23" href="#fnd-23">23</a>]</small> Implementation note: actually, the check
is added to the <em>buildable</em> object which resembles the source
file. The <em>buildable</em> object is managed by the enclosing
module. Confix arranges that all the necessary information arrives in
<samp><span class="file">configure.in</span></samp>. In the end, our check makes its way from the
buildable object over the module object into the package object, which
then writes it into <samp><span class="file">configure.in</span></samp>.</p>

   <p class="footnote"><small>[<a name="fn-24" href="#fnd-24">24</a>]</small> The module need not be
named <samp><span class="file">check</span></samp>; you can give it any name you want.</p>

   <p class="footnote"><small>[<a name="fn-25" href="#fnd-25">25</a>]</small> I am quite confident that the feature set of Confix
had to be significantly enriched for this.</p>

   <p class="footnote"><small>[<a name="fn-26" href="#fnd-26">26</a>]</small> If the
<code>crypt</code> library provided a header file of its own, say
<samp><span class="file">crypt.h</span></samp>, we'd just have to add a provide object for a header
file &mdash; <code>PROVIDE_H(filematch='crypt.h')</code> &mdash; that matched the
corresponding <code>#include &lt;crypt.h&gt;</code> of any using modules
automatically.</p>

   <p class="footnote"><small>[<a name="fn-27" href="#fnd-27">27</a>]</small> Yes, I agree with you: M4 is a pain.</p>

   <p class="footnote"><small>[<a name="fn-28" href="#fnd-28">28</a>]</small> The Python
interpreter which is used to run Confix, not the one we are
integrating here :-)</p>

   <p class="footnote"><small>[<a name="fn-29" href="#fnd-29">29</a>]</small> I have to admit that I don't know how and why Libtool
works, but I gladly accept it <em>does</em> work.</p>

   <p class="footnote"><small>[<a name="fn-30" href="#fnd-30">30</a>]</small> In the past, they used to call the linker,
<samp><span class="command">ld</span></samp>, directly to produce the shared library. Of course the
linker has no idea of C++, so initializers weren't generated at
all. Meanwhile the C++ linker frontend is called, so these
initializers are generated (and called by the dynamic loader)
properly.</p>

   <p class="footnote"><small>[<a name="fn-31" href="#fnd-31">31</a>]</small> This restriction is not specific to shared
libraries, but applies to linking C++ code in general.</p>

   <p class="footnote"><small>[<a name="fn-32" href="#fnd-32">32</a>]</small> I suspect this is due to the fact that every
library uses its own frame list internally. This way, the effective
stack is not reflected by any frame list in the program's address
space.</p>

   <p class="footnote"><small>[<a name="fn-33" href="#fnd-33">33</a>]</small> I fearfully remember Redhat's GCC
2.96.</p>

   <p class="footnote"><small>[<a name="fn-34" href="#fnd-34">34</a>]</small> In fact, shared library imlementations are not
generally implemented by the kernel. Rather, a user space program,
called the <em>loader</em>, is responsible for setting up the process's
memory layout, and to load all involved shared libraries. In doing so,
it uses advanced kernel features such as memory mapped files.</p>

   <p class="footnote"><small>[<a name="fn-35" href="#fnd-35">35</a>]</small> We do not document the order of the parameters, but
only their names; so there is no way to call the functions without
using keyword arguments anyway.</p>

   <p class="footnote"><small>[<a name="fn-36" href="#fnd-36">36</a>]</small> Confix inserts these by itself, so you don't
have to care of them. I just copied the text from the book for
correctness.</p>

   <p class="footnote"><small>[<a name="fn-37" href="#fnd-37">37</a>]</small> Again,
<code>AC_OUTPUT</code> invocation is Confix's responsibility, though you are
free to call AC_OUTPUT by yourself as well.</p>

   <p class="footnote"><small>[<a name="fn-38" href="#fnd-38">38</a>]</small> If
you don't understand what I'm talking about here drop me a note, or
better yet, file a bug report. I won't be surprised.</p>

   <p class="footnote"><small>[<a name="fn-39" href="#fnd-39">39</a>]</small> Symbolic
provides were introduced after I hacked dependencies between external
modules. At that time I used &ldquo;artificial&rdquo; header files, added with
<code>PROVIDE_H()</code> and <code>REQUIRE_H()</code>, as provides and requires,
to get the link order of the external libraries right. I thought that
symbolic counterparts were more appropriate for this.</p>

   <p class="footnote"><small>[<a name="fn-40" href="#fnd-40">40</a>]</small> Confix inserts these by itself, so you don't
have to care of them. I just copied the text from the book for
correctness.</p>

   <p class="footnote"><small>[<a name="fn-41" href="#fnd-41">41</a>]</small> Again,
<code>AC_OUTPUT</code> invocation is Confix's responsibility, though you are
free to call AC_OUTPUT by yourself as well.</p>

   <p class="footnote"><small>[<a name="fn-42" href="#fnd-42">42</a>]</small> Confix inserts these by itself, so you don't
have to care of them. I just copied the text from the book for
correctness.</p>

   <p class="footnote"><small>[<a name="fn-43" href="#fnd-43">43</a>]</small> Again,
<code>AC_OUTPUT</code> invocation is Confix's responsibility, though you are
free to call AC_OUTPUT by yourself as well.</p>

   <p><hr></div>

</body></html>

